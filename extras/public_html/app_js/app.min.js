!function(T,S){"function"==typeof define&&define.amd?define([],function(){return T.Swipe=S(),T.Swipe}):"object"==typeof module&&module.exports?module.exports=S():T.Swipe=S()}(this,function(){function T(_,U){"use strict";function X(){Le.addEventListener?(Oe.removeEventListener("touchstart",Ne,!1),Oe.removeEventListener("mousedown",Ne,!1),Oe.removeEventListener("webkitTransitionEnd",Ne,!1),Oe.removeEventListener("msTransitionEnd",Ne,!1),Oe.removeEventListener("oTransitionEnd",Ne,!1),Oe.removeEventListener("otransitionend",Ne,!1),Oe.removeEventListener("transitionend",Ne,!1),S.removeEventListener("resize",Ne,!1)):S.onresize=null}function Y(){Le.addEventListener?(Le.touch&&Oe.addEventListener("touchstart",Ne,!1),U.draggable&&Oe.addEventListener("mousedown",Ne,!1),Le.transitions&&(Oe.addEventListener("webkitTransitionEnd",Ne,!1),Oe.addEventListener("msTransitionEnd",Ne,!1),Oe.addEventListener("oTransitionEnd",Ne,!1),Oe.addEventListener("otransitionend",Ne,!1),Oe.addEventListener("transitionend",Ne,!1)),S.addEventListener("resize",Ne,!1)):S.onresize=We}function Z(Qe){var Ke=Qe.cloneNode(!0);Oe.appendChild(Ke),Ke.setAttribute("data-cloned",!0),Ke.removeAttribute("id")}function V(Qe){if(null!=Qe)for(var Ke in Qe)U[Ke]=Qe[Ke];Pe=Oe.children,Me=Pe.length;for(var qe=0;qe<Pe.length;qe++)Pe[qe].getAttribute("data-cloned")&&Me--;2>Pe.length&&(U.continuous=!1),Le.transitions&&U.continuous&&3>Pe.length&&(Z(Pe[0]),Z(Pe[1]),Pe=Oe.children),De=Array(Pe.length),Re=_.getBoundingClientRect().width||_.offsetWidth,Oe.style.width=2*(Pe.length*Re)+"px";for(var Ae,_e=Pe.length;_e--;)Ae=Pe[_e],Ae.style.width=Re+"px",Ae.setAttribute("data-index",_e),Le.transitions&&(Ae.style.left=_e*-Re+"px",le(_e,we>_e?-Re:we<_e?Re:0,0));U.continuous&&Le.transitions&&(le(se(we-1),-Re,0),le(se(we+1),Re,0)),Le.transitions||(Oe.style.left=we*-Re+"px"),_.style.visibility="visible",X(),Y()}function ee(){Ce||(U.continuous?ie(we-1):we&&ie(we-1))}function te(){Ce||(U.continuous?ie(we+1):we<Pe.length-1&&ie(we+1))}function re(Qe,Ke,qe){U.callback&&U.callback(Qe,Ke,qe)}function ne(Qe,Ke){U.transitionEnd&&U.transitionEnd(Qe,Ke)}function se(Qe){return(Pe.length+Qe%Pe.length)%Pe.length}function ae(){var Qe=we;return Qe>=Me&&(Qe-=Me),Qe}function ie(Qe,Ke){if(Qe="number"==typeof Qe?Qe:parseInt(Qe,10),we!==Qe){if(Le.transitions){var qe=Math.abs(we-Qe)/(we-Qe);if(U.continuous){var _e=qe;qe=-De[se(Qe)]/Re,qe!=_e&&(Qe=-qe*Pe.length+Qe)}for(var Ae=Math.abs(we-Qe)-1;Ae--;)le(se((Qe>we?Qe:we)-Ae-1),Re*qe,0);Qe=se(Qe),le(we,Re*qe,Ke||Ie),le(Qe,0,Ke||Ie),U.continuous&&le(se(Qe-qe),-Re*qe,0)}else Qe=se(Qe),de(we*-Re,Qe*-Re,Ke||Ie);we=Qe,Ee(function(){re(ae(),Pe[we],qe)})}}function le(Qe,Ke,qe){oe(Qe,Ke,qe),De[Qe]=Ke}function oe(Qe,Ke,qe){var _e=Pe[Qe],Ae=_e&&_e.style;Ae&&(Ae.webkitTransitionDuration=Ae.MozTransitionDuration=Ae.msTransitionDuration=Ae.OTransitionDuration=Ae.transitionDuration=qe+"ms",Ae.webkitTransform="translate("+Ke+"px,0)translateZ(0)",Ae.msTransform=Ae.MozTransform=Ae.OTransform="translateX("+Ke+"px)")}function de(Qe,Ke,qe){if(!qe)return void(Oe.style.left=Ke+"px");var _e=+new Date,Ae=setInterval(function(){var He=+new Date-_e;return He>qe?(Oe.style.left=Ke+"px",(xe||U.autoRestart)&&fe(),ne(ae(),Pe[we]),void clearInterval(Ae)):void(Oe.style.left=(Ke-Qe)*(Math.floor(100*(He/qe))/100)+Qe+"px")},4)}function ce(){(xe=U.auto||0)&&(ve=setTimeout(te,xe))}function pe(){xe=0,clearTimeout(ve)}function fe(){pe(),ce()}function me(){pe(),Ce=!0}function ue(){Ce=!1,fe()}function he(Qe){return /^mouse/.test(Qe.type)}function ge(){pe(),_.style.visibility="",Oe.style.width="",Oe.style.left="";for(var Qe=Pe.length;Qe--;){Le.transitions&&oe(Qe,0,0);var Ke=Pe[Qe];Ke.getAttribute("data-cloned")&&Ke.parentElement.removeChild(Ke),Ke.style.width="",Ke.style.left="",Ke.style.webkitTransitionDuration=Ke.style.MozTransitionDuration=Ke.style.msTransitionDuration=Ke.style.OTransitionDuration=Ke.style.transitionDuration="",Ke.style.webkitTransform=Ke.style.msTransform=Ke.style.MozTransform=Ke.style.OTransform=""}X(),We.cancel()}U=U||{};var be,ve,ke={},ye={},xe=U.auto||0,Ce=!1,Te=function(){},Ee=function(Qe){setTimeout(Qe||Te,0)},Se=function(Qe,Ke){function qe(){Ae&&clearTimeout(Ae)}function _e(){var He=this,Be=arguments;qe(),Ae=setTimeout(function(){Ae=null,Qe.apply(He,Be)},Ke)}Ke=Ke||100;var Ae=null;return _e.cancel=qe,_e},Le={addEventListener:!!S.addEventListener,touch:"ontouchstart"in S||S.DocumentTouch&&W instanceof DocumentTouch,transitions:function(Qe){var Ke=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var qe in Ke)if(void 0!==Qe.style[Ke[qe]])return!0;return!1}(W.createElement("swipe"))};if(_){var Pe,De,Re,Me,Oe=_.children[0],we=parseInt(U.startSlide,10)||0,Ie=U.speed||300;U.continuous=void 0===U.continuous||U.continuous,U.autoRestart=void 0!==U.autoRestart&&U.autoRestart;var We=Se(V),Ne={handleEvent:function(Qe){if(!Ce){switch(Qe.type){case"mousedown":case"touchstart":this.start(Qe);break;case"mousemove":case"touchmove":this.move(Qe);break;case"mouseup":case"mouseleave":case"touchend":this.end(Qe);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":this.transitionEnd(Qe);break;case"resize":We();}U.stopPropagation&&Qe.stopPropagation()}},start:function(Qe){var Ke;he(Qe)?(Ke=Qe,Qe.preventDefault()):Ke=Qe.touches[0],ke={x:Ke.pageX,y:Ke.pageY,time:+new Date},be=void 0,ye={},he(Qe)?(Oe.addEventListener("mousemove",this,!1),Oe.addEventListener("mouseup",this,!1),Oe.addEventListener("mouseleave",this,!1)):(Oe.addEventListener("touchmove",this,!1),Oe.addEventListener("touchend",this,!1))},move:function(Qe){var Ke;if(he(Qe))Ke=Qe;else{if(1<Qe.touches.length||Qe.scale&&1!==Qe.scale)return;U.disableScroll&&Qe.preventDefault(),Ke=Qe.touches[0]}ye={x:Ke.pageX-ke.x,y:Ke.pageY-ke.y},void 0==be&&(be=!!(be||Math.abs(ye.x)<Math.abs(ye.y))),be||(Qe.preventDefault(),pe(),U.continuous?(oe(se(we-1),ye.x+De[se(we-1)],0),oe(we,ye.x+De[we],0),oe(se(we+1),ye.x+De[se(we+1)],0)):(ye.x/=!we&&0<ye.x||we===Pe.length-1&&0>ye.x?Math.abs(ye.x)/Re+1:1,oe(we-1,ye.x+De[we-1],0),oe(we,ye.x+De[we],0),oe(we+1,ye.x+De[we+1],0)))},end:function(Qe){var Ke=+new Date-ke.time,qe=250>+Ke&&20<Math.abs(ye.x)||Math.abs(ye.x)>Re/2,_e=!we&&0<ye.x||we===Pe.length-1&&0>ye.x;U.continuous&&(_e=!1);var Ae=Math.abs(ye.x)/ye.x;be||(qe&&!_e?(0>Ae?(U.continuous?(le(se(we-1),-Re,0),le(se(we+2),Re,0)):le(we-1,-Re,0),le(we,De[we]-Re,Ie),le(se(we+1),De[se(we+1)]-Re,Ie),we=se(we+1)):(U.continuous?(le(se(we+1),Re,0),le(se(we-2),-Re,0)):le(we+1,Re,0),le(we,De[we]+Re,Ie),le(se(we-1),De[se(we-1)]+Re,Ie),we=se(we-1)),re(ae(),Pe[we],Ae)):U.continuous?(le(se(we-1),-Re,Ie),le(we,0,Ie),le(se(we+1),Re,Ie)):(le(we-1,-Re,Ie),le(we,0,Ie),le(we+1,Re,Ie))),he(Qe)?(Oe.removeEventListener("mousemove",Ne,!1),Oe.removeEventListener("mouseup",Ne,!1),Oe.removeEventListener("mouseleave",Ne,!1)):(Oe.removeEventListener("touchmove",Ne,!1),Oe.removeEventListener("touchend",Ne,!1))},transitionEnd:function(Qe){parseInt(Qe.target.getAttribute("data-index"),10)===we&&((xe||U.autoRestart)&&fe(),ne(ae(),Pe[we]))}};return V(),ce(),{setup:V,slide:function(Qe,Ke){pe(),ie(Qe,Ke)},prev:function(){pe(),ee()},next:function(){pe(),te()},restart:fe,stop:pe,getPos:ae,disable:me,enable:ue,getNumSlides:function(){return Me},kill:ge}}}var S="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,W=S.document;return(S.jQuery||S.Zepto)&&function(_){_.fn.Swipe=function(U){return this.each(function(){_(this).data("Swipe",new T(_(this)[0],U))})}}(S.jQuery||S.Zepto),T}),function(){let T=screen.width,S=screen.height;setInterval(()=>{(screen.width!==T||screen.height!==S)&&(T=screen.width,S=screen.height,$(window).trigger("resolutionchange"))},250)}();function showLogin(){$("#confirmLogin").removeClass("hide"),centerLoginForm(),$(window).trigger("loggedout")}function reloadPage(){location.reload()}function disableApp(){let T=document.querySelector("header"),S=document.querySelector(".menu__header");return void 0===T||void 0===S||T.classList.contains("loggedout")?!1:void(T.classList.add("loggedout"),S.classList.add("loggedoutHeader"),$("#appContainer").find("button").each(function(){$(this).prop("disabled",!0)}))}$(window).bind("resolutionchange",function(){setTimeout(()=>{fixDeadRunButton(),centerLoginForm()},500)}),$(window).bind("loggedout",function(){setTimeout(disableApp,500)}),$(window).bind("loggedin",function(){setTimeout(enableApp,500)});function debug(T){"undefined"==typeof T?console.log(typeof T):console.log(typeof T,T.length,T)}(function(){"use strict";function S(){_.style.transform="translateX(-110%)",_.classList.remove("menu--show"),U.classList.remove("menu__overlay--show")}let W=document.querySelector(".header__icon"),_=document.querySelector(".menu"),U=document.querySelector(".menu__overlay"),X=document.querySelectorAll("a.nav"),Y=document.querySelector(".fab__push");W.addEventListener("click",function(){let Z=document.getElementById("signature-pad");if(null!==Z)return!1;let V=document.getElementById("newUpdate");null===V||V.classList.contains("hide")||V.classList.add("hide"),_.style.transform="translateX(0)",_.classList.add("menu--show"),U.classList.add("menu__overlay--show")},!1),U.addEventListener("click",S,!1);for(let Z=0;Z<X.length;Z++)X[Z].addEventListener("click",S,!1);null!==Y&&Y.addEventListener("click",S,!1)})(),function(T){"use strict";let W=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];T.toast=function(U,X){if(U){let Y=document.querySelector(".toast__container");X=X||{},X.title=X.title||"",X.time=X.time||4e3,X.eleClass=X.eleClass||"toast__msg",X.datatime=X.datatime||new Date().getTime();let Z=document.createElement("div");Z.className=X.eleClass,Z.title=X.title;let V=new Date(+X.datatime),ee=V.getMinutes();if(ee=10>ee?"0"+ee.toString():ee.toString(),Z.innerHTML=U+"<p>"+_[V.getDay()]+" "+W[V.getMonth()]+" "+V.getDate()+"</p><p>"+V.getHours()+":"+ee+"</p>",Z.setAttribute("data-time",X.datatime),"toast__msg"!==X.eleClass){for(let te=0;te<Y.children.length;te++)if(Y.children[te].classList.contains(X.eleClass)){let re=Y.children[te];re.parentNode.removeChild(re)}Y.appendChild(Z)}else Y.appendChild(Z);setTimeout(()=>{Z.classList.contains("toast__msg")&&Z.classList.add("toast__msg--hide")},X.time),setTimeout(()=>{for(let re,te=0;te<Y.children.length;te++)re=Y.children[te],re.classList.contains("toast__msg")&&re.parentNode.removeChild(re)},X.time+1e3)}}}("undefined"==typeof window?module.exports:window),window.mySwipe=new Swipe(document.getElementById("slider"),{startSlide:0,speed:300,draggable:!1,continuous:!0,autoRestart:!1,disablescroll:!1,stopPropagation:!1,callback:function(){},transitionEnd:function(T,S){$(".menu__list li").each(function(){$(this).removeClass("menu__list__active")});let W;$(".page").each(function(){if($(this).prop("id")===S.id){W=S.id,"timeCard"===W?$(window).trigger("timeCardVisible"):scroll(0,0);let _,X=$("a.nav[data-id='"+$(this).prop("id")+"'").html().split("<");-1===["Route","On Call","Dispatch","Transfers"].indexOf(X[0])?_=$("a.nav[data-id='"+$(this).prop("id")+"'").html():(_="<button type=\"button\" id=\"refresh"+X[0].replace(/\s/g,"")+"\">"+X[0]+"</button>",_+="Route"===X[0]?"":"<"+X[1]+"<"+X[2]),$(".pageTitle").html(_),$("a.nav[data-id='"+$(this).prop("id")+"'").parents("li").addClass("menu__list__active")}})}});function assignLinkValues(){let T=document.getElementsByClassName("nav");for(let S=0;S<T.length;S++)T[S].setAttribute("data-value",S)}(function(){"use strict";function T(){navigator.onLine?(S.classList.remove("app__offline"),W.style.background="#1E88E5"):(toast("You are now offline.."),S.classList.add("app__offline"),W.style.background="#9E9E9E")}const S=document.querySelector("header"),W=document.querySelector(".menu__header");document.addEventListener("DOMContentLoaded",function(){navigator.onLine||T(),window.addEventListener("online",T,!1),window.addEventListener("offline",T,!1)})})();function isTarget(T){let S=["billTo","dispatchedTo","dispatchedByUser","shippingCountry","billingCountry","pCountry","dCountry"];for(let W=0;W<S.length;W++)if(T.hasClass(S[W]))return!0;return!1}function disableButtonsInvoices(){let T=0;$("#orgInvoices .orgMember").each(function(){$(this).is(":checked")&&T++}),$("#compareMembers").prop("disabled",2>T),$("#compareMembers").is(":disabled")&&$("#compareMembers").prop("checked",!1),0==T?($("#range, #submitSingle").prop("disabled",!0).prop("title","Select a member to continue"),$("#orgInvoices").find(".noticeRow").show()):($("#orgInvoices").find(".noticeRow").hide(),$("#range, #submitSingle").prop("title",""),$("#single").is(":checked")?$("#submitSingle").prop("disabled",!1):$("#multi").is(":checked")&&$("#range").prop("disabled",!1))}function disableButtonsTickets(){let T=0;$("#orgTickets .orgMember").each(function(){$(this).is(":checked")&&T++}),$("#compareMembersTickets").prop("disabled",!(1<T&&"chart"===$("#display").val())),$("#compareMembersTickets").is(":disabled")&&$("#compareMembersTickets").prop("checked",!1),0==T&&""===$("#ticketNumber").val()?$("#orgTickets").find(".noticeRow").show():$("#orgTickets").find(".noticeRow").hide()}String.prototype.convert12to24||(String.prototype.convert12to24=function(){let U,X,S=+this.match(/^(\d+)/)[1],W=+this.match(/:(\d+)/)[1],_=this.match(/\s(.*)$/)[1];return"PM"==_.toUpperCase()&&12>S&&(S+=12),"AM"==_.toUpperCase()&&12==S&&(S-=12),U=10>S?`0${S.toString()}`:S.toString(),X=10>W?`0${W.toString()}`:W.toString(),U+":"+X}),String.prototype.convert24to12||(String.prototype.convert24to12=function(){let U,X,S=+this.match(/^(\d+)/)[1],W=+this.match(/:(\d+)/)[1],_="am";return 12<S&&(S-=12,_="pm"),0==S&&(S=12),U=S.toString(),X=10>W?`0${W.toString()}`:W.toString(),U+":"+X+" "+_});function disable_scroll(){$("body").bind("touchmove",function(T){T.preventDefault()})}function enable_scroll(){$("body").unbind("touchmove")}function findPos(T){let S=0;if(T.offsetParent){do S+=T.offsetTop;while(T=T.offsetParent);return S-document.getElementsByTagName("header")[0].offsetHeight}}function fixDeadRunButton(){let T=$(".cancelRun:first").height();$(".deadRun").each(function(){$(this).text("Dead Run");let S=$(this).height();S>T&&$(this).text("D. Run")})}function centerLoginForm(){let T=$(document).width(),S=$("#confirmLogin").width();$("#confirmLogin").css("left",(T-S)/2+"px")}function sortRoute(){let T=$("#route"),S=T.children(".sortable").get();S.sort((W,_)=>{return $(W).find(".timing").text().convert12to24()>$(_).find(".timing").text().convert12to24()?1:-1}),$.each(S,(W,_)=>{T.append(_)})}function refreshRoute(){$("#route").html("<div class=\"showbox\"><!-- New spinner from http://codepen.io/collection/HtAne/ --><div class=\"loader\"><svg class=\"circular\" viewBox=\"25 25 50 50\"><circle class=\"path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-width=\"2\" stroke-miterlimit=\"10\"/></svg></div></div>"),scrollTo(0,0);ajax_template("POST","./refreshRoute.php","html",{formKey:$("#formKey").val()}).done(S=>{return-1===S.indexOf("Session Error")?void setTimeout(()=>{$("#route").html(S),fixDeadRunButton(),sortRoute()},2e3):($("#confirmLogin").find("#function").val("refreshRoute"),showLogin(),!1)}).fail((S,W,_)=>{$("#route").html("<p class=\"center error\">"+_+"</p>")})}function countOnCallTickets(T){let S=$("#onCall .tickets").length;S>T&&($(".alert").addClass("onCallAlert").text("!"),$("#newUpdate").removeClass("hide")),0===S&&$(".alert").removeClass("onCallAlert");let W=$(".alert").attr("class").split(/\s+/);1===W.length&&$(".alert").text(""),$(".ticketCount").text(S)}function sortOnCall(){let T=$("#onCall"),S=T.children(".sortable").get();S.sort((W,_)=>{return $(W).find(".timing").text().convert12to24()>$(_).find(".timing").text().convert12to24()?1:-1}),$.each(S,(W,_)=>{T.append(_)})}function refreshOnCall(T=$(".ticketCount:first").text()){$("#onCall").html("<div class=\"showbox\"><!-- New spinner from http://codepen.io/collection/HtAne/ --><div class=\"loader\"><svg class=\"circular\" viewBox=\"25 25 50 50\"><circle class=\"path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-width=\"2\" stroke-miterlimit=\"10\"/></svg></div></div>"),scrollTo(0,0);ajax_template("POST","./refreshOnCall.php","html",{formKey:$("#formKey").val()}).done(W=>{return-1===W.indexOf("Session Error")?void setTimeout(()=>{$("#onCall").html(W),fixDeadRunButton(),sortOnCall(),countOnCallTickets(T)},2e3):($("#confirmLogin").find("#function").val("refreshOnCall"),showLogin(),!1)}).fail((W,_,U)=>{$("#onCall").html("<p class=\"center error\">"+U+"</p>")})}function countInitOnCall(){let T=$("#onCall .tickets").length;$(".ticketCount").text(T),0<T&&$(".alert").addClass("onCallAlert").text("!")}function countDispatch(T){let S=$("#dispatch .tickets").length;S>T&&$(".alert").addClass("dispatchAlert").text("!"),0===S&&$(".alert").removeClass("dispatchAlert");let W=$(".alert").attr("class").split(/\s+/);1===W.length&&$(".alert").text(""),$(".dispatchCount").text(S)}function refreshDispatch(){let T=+$(".dispatchCount").text()-1;$("#dispatch").html("<div class=\"showbox\"><!-- New spinner from http://codepen.io/collection/HtAne/ --><div class=\"loader\"><svg class=\"circular\" viewBox=\"25 25 50 50\"><circle class=\"path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-width=\"2\" stroke-miterlimit=\"10\"/></svg></div></div>"),scrollTo(0,0);ajax_template("POST","./refreshDispatch.php","html",{formKey:$("#formKey").val()}).done(W=>{return-1===W.indexOf("Session Error")?void setTimeout(()=>{$("#dispatch").html(W),countDispatch(T)},2e3):($("#confirmLogin").find("#function").val("refreshDispatch"),showLogin(),!1)}).fail((W,_,U)=>{$("#dispatch").html("<p class=\"center error\">"+U+"</p>")})}function countInitDispatch(){let T=$("#dispatch .tickets").length;$(".dispatchCount").text(T),0<T&&$(".alert").addClass("dispatchAlert").text("!")}function countTransferTickets(T){let S=$("#transfers .sortable").length;S>T&&($(".alert").addClass("transfersAlert").text("!"),$("#newUpdate").removeClass("hide")),0===S&&$(".alert").removeClass("transfersAlert");let W=$(".alert").attr("class").split(/\s+/);1===W.length&&$(".alert").text(""),$(".transferCount").text(S)}function refreshTransfers(T=$(".transferCount:first").text()){$("#transfers").html("<div class=\"showbox\"><!-- New spinner from http://codepen.io/collection/HtAne/ --><div class=\"loader\"><svg class=\"circular\" viewBox=\"25 25 50 50\"><circle class=\"path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-width=\"2\" stroke-miterlimit=\"10\"/></svg></div></div>"),scrollTo(0,0);ajax_template("POST","./refreshTransfers.php","html",{formKey:$("#formKey").val()}).done(W=>{return-1===W.indexOf("Session Error")?void setTimeout(()=>{$("#transfers").html(W),countTransferTickets(T)},2e3):($("#confirmLogin").find("#function").val("refreshTransfers"),showLogin(),!1)}).fail((W,_,U)=>{$("#transfers").html("<p class=\"center error\">"+U+"</p>")})}function countInitTransfers(){let T=$("#transfers .sortable").length;$(".transferCount").text(T),0<T&&$(".alert").addClass("transfersAlert").text("!")}function populatePage(){let T=[];$(".page").each(function(){$(this).attr("data-function")!==void 0&&""!==$(this).attr("data-function")&&(console.log($(this).attr("data-function")),T.push($(this).attr("data-function")))});ajax_template("POST","initApp.php","html",{functions:T,formKey:$("#formKey").val()}).done(_=>{let U,X=!1;try{U=JSON.parse(_)}catch(Y){$(".page:first").html("<p class=\"center\">"+Y+"</p>"),console.log(_),X=!0}if(!0==X)return!1;for(let Y=0;Y<U.length;Y++)$(".page").each(function(){+$(this).attr("data-index")===Y&&("ticketQuery"===$(this).prop("id")?$("#ticketQueryResults").append(U[Y]):!1!==U[Y]&&$(this).html(U[Y]))});scrollTo(0,0),0<$("#route").length&&sortRoute(),0<$("#onCall").length&&(sortOnCall(),countInitOnCall()),0<$(".deadRun").length&&fixDeadRunButton(),0<$("#dispatch").length&&countInitDispatch(),0<$("#transfers").length&&countInitTransfers(),0===$("#map").length?0!==$(".orgMember").lenth&&0!==$("#map2").length&&$("body").append("<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyCA3eWNJANuoLXUrov6sfxaokxp16GTLHQ&callback=initPriceMap\" async defer></script>"):$("body").append("<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyCA3eWNJANuoLXUrov6sfxaokxp16GTLHQ&callback=initMap\" async defer></script>"),resetPushUI()}).fail((_,U,X)=>{return $(".page:first").html("<p class=\"center\"><span class=\"error\">Error "+U+"</span>:"+X+"</p>"),!1})}function enableApp(){$("header").removeClass("loggedout"),$(".menu__header").removeClass("loggedoutHeader"),$("#appContainer").find("button").each(function(){$(this).prop("disabled",!1)})}function drawCircle(T,S,W,_){let V,ee,U=Math.PI/180,X=180/Math.PI,Z=32,te=S/3963*X,re=te/Math.cos(T.lat()*U),ne=[];1==W?(V=0,ee=Z+1):(V=Z+1,ee=0);for(let se=V;1==W?se<ee:se>ee;se+=W){let ae=Math.PI*(se/(Z/2)),ie=T.lng()+re*Math.cos(ae),le=T.lat()+te*Math.sin(ae);ne.push(new google.maps.LatLng(le,ie)),_.extend(ne[ne.length-1])}return ne}function initMap(T="map",S,W,_,U,X){let Y={lat:41.2522201,lng:-95.9822628};X=X||Y;let Z,V,ee,te,re,ne,se,ae,ie,le,oe,de,ce=new google.maps.LatLngBounds,pe=document.getElementById(T);if(ae={home:{center:new google.maps.LatLng(Y)}},pe.style.height=pe.offsetWidth+"px",ie=new google.maps.Map(document.getElementById(T),{center:X,zoom:10}),V=new google.maps.Marker({position:X,map:ie,title:"Home"}),"undefined"!=typeof S&&"undefined"!=typeof _){V.setMap(null),ee=new google.maps.Marker({position:S,map:ie,title:W,label:"P"}),te=new google.maps.Marker({position:_,map:ie,title:U,label:"D"}),re=[ee,te];for(let fe=0;fe<re.length;fe++)ce.extend(re[fe].getPosition());ie.fitBounds(ce)}ne=[new google.maps.LatLng(85,180),new google.maps.LatLng(85,90),new google.maps.LatLng(85,0),new google.maps.LatLng(85,-90),new google.maps.LatLng(85,-180),new google.maps.LatLng(0,-180),new google.maps.LatLng(-85,-180),new google.maps.LatLng(-85,-90),new google.maps.LatLng(-85,0),new google.maps.LatLng(-85,90),new google.maps.LatLng(-85,180),new google.maps.LatLng(0,180),new google.maps.LatLng(85,180)],se={strokeColor:"#696969",strokeOpacity:0,strokeWeight:2,fillColor:"#696969",fillOpacity:0.8,map:ie,paths:[ne,drawCircle(ae.home.center,20,-1,ce)]},Z=new google.maps.Polygon(se),le={maxRange:{center:Y,radius:32187},standardRange:{center:Y,radius:25750}},oe={strokeColor:"#FF0000",strokeOpacity:0.8,strokeWeight:2,fillOpacity:0,map:ie,center:le.maxRange.center,radius:le.maxRange.radius,draggable:!1},de={strokeColor:"#0000FF",strokeOpacity:0.8,strokeWeight:2,fillOpacity:0,map:ie,center:le.standardRange.center,radius:le.standardRange.radius,draggable:!1},maxRange=new google.maps.Circle(oe),standardRange=new google.maps.Circle(de),0<$("#map2").length&&initPriceMap()}function initPriceMap(T="map2",S,W,_,U,X){let Y={lat:41.2522201,lng:-95.9822628};X=X||Y;let Z,V,ee,te,re,ne,se,ae,ie,le,oe,de,ce=new google.maps.LatLngBounds,pe=document.getElementById(T);if(ae={home:{center:new google.maps.LatLng(Y)}},pe.style.height=pe.offsetWidth+"px",ie=new google.maps.Map(document.getElementById(T),{center:X,zoom:10}),V=new google.maps.Marker({position:X,map:ie,title:"Home"}),"undefined"!=typeof S&&"undefined"!=typeof _){V.setMap(null),ee=new google.maps.Marker({position:S,map:ie,title:W,label:"P"}),te=new google.maps.Marker({position:_,map:ie,title:U,label:"D"}),re=[ee,te];for(let fe=0;fe<re.length;fe++)ce.extend(re[fe].getPosition());ie.fitBounds(ce)}ne=[new google.maps.LatLng(85,180),new google.maps.LatLng(85,90),new google.maps.LatLng(85,0),new google.maps.LatLng(85,-90),new google.maps.LatLng(85,-180),new google.maps.LatLng(0,-180),new google.maps.LatLng(-85,-180),new google.maps.LatLng(-85,-90),new google.maps.LatLng(-85,0),new google.maps.LatLng(-85,90),new google.maps.LatLng(-85,180),new google.maps.LatLng(0,180),new google.maps.LatLng(85,180)],se={strokeColor:"#696969",strokeOpacity:0,strokeWeight:2,fillColor:"#696969",fillOpacity:0.8,map:ie,paths:[ne,drawCircle(ae.home.center,20,-1,ce)]},Z=new google.maps.Polygon(se),le={maxRange:{center:Y,radius:32187},standardRange:{center:Y,radius:25750}},oe={strokeColor:"#FF0000",strokeOpacity:0.8,strokeWeight:2,fillOpacity:0,map:ie,center:le.maxRange.center,radius:le.maxRange.radius,draggable:!1},de={strokeColor:"#0000FF",strokeOpacity:0.8,strokeWeight:2,fillOpacity:0,map:ie,center:le.standardRange.center,radius:le.standardRange.radius,draggable:!1},maxRange=new google.maps.Circle(oe),standardRange=new google.maps.Circle(de)}$(document).ready(function(){let T=!1;assignLinkValues(),0<$("#confirmLogin").length&&populatePage(),$("a.nav").click(function(){mySwipe.slide($(this).attr("data-value"),300)}),$(document).on("click",".header__icon",function(){if($("#sig").is(":visible"))return!1}),$(document).on("click",".refresh",function(){reloadPage()}),$(document).on("keydown","input[type='number']",function(){"0"===$(this).val()&&$(this).val("")}),$(document).on("click","button",function(){let S=$(this).addClass("red");setTimeout(()=>{S.removeClass("red")},3e3)}),$(document).on("click","#refreshRoute, #refreshOnCall, #refreshDispatch, #refreshTransfers",function(S){S.preventDefault(),window[$(this).prop("id")]()}),$("#confirm").click(function(S){S.preventDefault();let W=!1;if($("#login").find("input").each(function(){"function"!==$(this).prop("id")&&""===$(this).val()&&(W=!0,$tempError=$(this).addClass("elementError"),setTimeout(()=>{$tempError.removeClass("elementError")},3e3))}),!0==W)return!1;$("#confirmMessage").html("<span class=\"ellipsis\">.</span>");let _=$("#confirmMessage").find(".ellipsis"),U=!0,X=setInterval(()=>{!0===U&&(_.append(".."),U=21>_.text().length&&1!=_.text().length),!1===U&&(_.text(_.text().substr(0,_.text().length-2)),U=1===_.text().length)},500),Y={};Y.clientID=$("#uid").val(),Y.upw=$("#upw").val(),Y.mobile=$("#mobile").val(),Y.noSession=1;ajax_template("POST","./refreshFormKey.php","text",{noSession:1}).done(V=>{if(-1!==V.indexOf("error"))return $("#confirmMessage").html(V),!1;Y.formKey=V;ajax_template("POST","../login.php","html",Y).done(te=>{return clearInterval(X),-1===te.indexOf("error")&&"Invalid Credentials"!==te?void($("#confirmMessage").html("User Confirmed"),$(".formKey, #formKey").each(function(){$(this).val(V)}),setTimeout(()=>{if($("#confirmMessage").html(""),$("#confirmLogin").addClass("hide"),""!==$("#confirmLogin").find("#function").val()){let re=$("#confirmLogin").find("#function").val();$("#confirmLogin").find("#function").val(""),window[re]()}$(window).trigger("loggedin")},1e3)):($("#confirmMessage").html(te),setTimeout(()=>{$("#confirmMessage").html("")},4e3),!1)}).fail((te,re,ne)=>{return clearInterval(X),$("#confirmMessage").html("<span class=\"error\">Error</span>: "+ne),setTimeout(()=>{$("#confirmMessage").html("")},4e3),!1})}).fail((V,ee,te)=>{return clearInterval(X),$("#confirmMessage").html(te),!1})}),$("#cancel").click(function(){window.location="./logout"}),$(document).on("click",".pGetSig, .dGetSig, .d2GetSig",function(){let W,_,U,X,Y,Z,V,ee;$("input, button, textarea").prop("disabled",!0),$(".signature-pad").each(function(){$(this).addClass("sigField").removeClass("field").html("")}),W=$(this).parents(".sortable").find(".signature-pad"),W.hasClass("sigField")&&(U=$(this).parents(".sortable").innerWidth(),X=0===$(this).closest(".sortable").find(".tickets").length?.65*$(this).parents(".sortable").innerHeight():$(this).closest(".sortable").find(".tickets").innerHeight(),W.removeClass("sigField").addClass("field").attr("id","signature-pad").html("<canvas id=\"sig\" style=\"height:"+X+"px;width:"+U+"px;\"></canvas><button style=\"float:left;\" type=\"button\" data-action=\"clear\">Clear</button><button style=\"float:right;\" type=\"button\" data-action=\"save\">OK</button>"),_=document.getElementById("sig"),Y=new SignaturePad(_),Z=document.getElementById("signature-pad"),clearButton=Z.querySelector("[data-action='clear']"),saveButton=Z.querySelector("[data-action='save']"),_=Z.querySelector("#sig"),Y,Y.minWidth=.5,Y.maxWidth=2,Y.penColor="red",Y.backgroundColor="black");(function(){let te=Math.max(window.devicePixelRatio||1,1);_.width=_.offsetWidth*te,_.height=_.offsetHeight*te,_.getContext("2d").scale(te,te)})(),window.scroll(0,findPos(document.getElementById("sig"))),saveButton.addEventListener("click",function(){V=$(this).parents(".sortable").find(".printName"),Y.isEmpty()?($(this).parents(".sortable").find("input[name='sigImage']").val(""),toast("Signature Cleared.")):$(this).parents(".sortable").find("input[name='sigImage']").val(Y.toDataURL()),ee=""!==V.parents(".sortable").find("input[name='sigImage']").val()&&typeof V.parents(".sortable").find("input[name='sigImage']").val()!==void 0&&null!==V.parents(".sortable").find("input[name='sigImage']").val()||V.hasClass("pulse"),W.removeClass("field").addClass("sigField").html("").attr("id",""),W.parents("body").find("input, button, textarea").prop("disabled",!1),V.prop("required",ee)}),clearButton.addEventListener("click",function(){Y.clear()}),Y.clear()}),$(document).on("touchstart","#sig",function(){disable_scroll(),mySwipe.disable()}),$(document).on("touchend","#sig",function(){enable_scroll(),mySwipe.enable()}),$("#ticketEditorSubmit").click(function(S){S.preventDefault(),$("#ticketEditor .container").html("<span class=\"ellipsis\">.</span>");let W=$("#ticketEditor .ellipsis"),_=!0,U=setInterval(()=>{!0==_?(W.append(".."),_=21>W.text().length&&1!=W.text().length):(W.text(W.text().substr(0,W.text().length-2)),_=1===W.text().length)},500),X=$(this).parents("form").find(".driverID").val(),Y=$(this).parents("form").find(".contract").val(),Z=$("#formKey").val();if(""===X||null===X||"undefined"===X)return!1;ajax_template("POST","./activeTickets.php","html",{dispatchedTo:X,contract:Y,formKey:Z}).done(ee=>{return clearInterval(U),$("#ticketEditor").find(".ellipsis").remove(),-1===ee.indexOf("Session Error")?void $("#ticketEditor .container").html(ee):showLogin()}).fail((ee,te,re)=>{clearInterval(U),$("#ticketEditor").find(".ellipsis").remove(),$("#ticketEditor .message").find("#message").html("<p class=\"center ajaxError\"><span class=\"error\">Error</span>: "+re+"</p>"),setTimeout(()=>{$("#ticketEditor").find(".ajaxError").remove()},4e3)})}),$(document).on("click",".cancelTicketEditor",function(){$(this).parents(".tickets").find("table:first, button.ticketEditor").show(),$(this).parents(".removableByEditor").remove()}),$(document).on("click",".ticketEditor",function(){ajax_template("POST","./enterTicket.php","html",{ticket_index:$(this).attr("data-index"),ticketEditor:1,formKey:$("#formKey").val()}).done(W=>{return-1===W.indexOf("Session Error")?void($(this).parent(".tickets").find("table:first, button.ticketEditor").hide(),$(this).parent(".tickets").append(W)):showLogin()}).fail((W,_,U)=>{$(this).parent(".tickets").html("<p class=\"center\">"+U+"</p>")})}),$(document).on("click","#ticketEditor .submitForm",function(S){S.preventDefault(),$(this).prop("disable",!0);let W=!1,_=["repeatClient","fromMe","toMe","dryIce","pSigReq","dSigReq","d2SigReq"],U=["pClient","pAddress1","pAddress2","dClient","dAddress1","dAddress2","dispatchedTo"],X={};if($(this).parents("form").find("input[name], select, textarea").each(function(){if(-1===_.indexOf($(this).attr("name"))&&!1===$(this).prop("disabled")){if((!0===$(this).prop("required")&&"requestedBy"!==$(this).attr("name")||-1!==U.indexOf($(this).attr("name")))&&""===$(this).val()){let Z=$(this).addClass("elementError");setTimeout(()=>{Z.removeClass("elementError")},3e3),W=!0}else $(this).removeClass("elementError");X[$(this).attr("name")]=$(this).val()}else"checkbox"===$(this).prop("type")&&(X[$(this).attr("name")]="repeatClient"===$(this).attr("name")?1-$(this).is(":checked"):0+$(this).is(":checked"));X.formKey=$("#formKey").val()}),1===X.dryIce)if(0!=X.diWeight%5){let Z=$(this).parents("form").find(".ticketError").text("Dry Ice in increments of 5 only."),V=$(this).parents("form").find(".diWeight").addClass("elementError");W=!0,setTimeout(()=>{Z.text(""),V.removeClass("elementError")},3e3)}else if("0"===X.diWeight){let Z=$(this).parents("form").find(".ticketError").text("Dry Ice must be non-zero."),V=$(this).parents("form").find(".diWeight").addClass("elementError");W=!0,setTimeout(()=>{Z.text(""),V.removeClass("elementError")},3e3)}if(null!==X.transfers&&""!==X.transfers&&(X.transfers=$.parseJSON(X.transfers.replace(/&quot;/g,"\""))),X.dispatchedTo.substr(X.dispatchedTo.lastIndexOf(" ")+1)!==X.holder&&("object"==typeof X.transfers?X.transfers.push({holder:+X.holder,receiver:+X.dispatchedTo.substr(X.dispatchedTo.lastIndexOf(" ")+1),transferredBy:X.transferredBy,timestamp:null}):X.transfers=[{holder:+X.holder,receiver:+X.dispatchedTo.substr(X.dispatchedTo.lastIndexOf(" ")+1),transferredBy:X.transferredBy,timestamp:null}]),!0==W)return $(this).prop("disabled",!1),!1;ajax_template("POST","./enterTicket.php","html",X).done(Z=>{return-1===Z.indexOf("Session Error")?void(-1===Z.indexOf("data-error")?$(this).parents(".tickets").html(Z):$(this).parents(".tickets").find(".ticketError").html(Z)):showLogin()}).fail((Z,V,ee)=>{$(this).parents(".tickets").find(".ticketError").html("<span class=\"center\">"+ee+"</span>")})}),$(document).on("click","#ticketEditor .editForm, #ticketEditor .confirmed",function(S){S.preventDefault();let W=$(this),_=W.parents(".tickets");W.prop("disabled",!0),setTimeout(()=>{W.prop("disabled",!1)},5e3);let X,U="#"+$(this).attr("form"),Y={};if($(this).parents(".tickets").find(U+" input").each(function(){Y[$(this).attr("name")]="checkbox"===$(this).attr("type")?$(this).is(":checked")?1:0:$(this).val()}),Y.formKey=$("#formKey").val(),W.hasClass("editForm")){let Z=W.attr("form").match(/\d+/)[0];(""===Z||null===Z)&&(X="<p class=\"center\">Invalid Ticket Index</p>",_.find(".ticketError").html(X),setTimeout(()=>{_.find(".ticketError").html("")},3e3));ajax_template("POST","./enterTicket.php","html",{ticket_index:Z,ticketEditor:1,formKey:$("#formKey").val()}).done(ee=>{return-1===ee.indexOf("Session Error")?void _.html(ee):showLogin()}).fail((ee,te,re)=>{X="<p class=\"center\">Error: "+re+"</p>",_.find(".ticketError").html(X),setTimeout(()=>{_.find(".ticketError").html("")},3e3)})}else if(W.hasClass("confirmed")){Y.updateTicket=1;ajax_template("POST","./enterTicket.php","html",Y).done(V=>{return-1===V.indexOf("Session Error")?void("remove"===V?(_.prepend("<p class=\"center\">Update Successful</p>").scrollTop($("header").outerHeight()+5),setTimeout(()=>{_.remove()},3e3)):(_.before(V),_.prev(".tickets").prepend("<p class=\"center removable\">Update Successful</p>").scrollTop($("header").outerHeight()+5),_.remove(),setTimeout(()=>{$(".removable").remove()},3e3))):showLogin()}).fail((V,ee,te)=>{_.prepend("<span class=\"center\">"+te+"</span>")})}else return X="<p class=\"center\">Error: Invalid action</p>",_.find(".ticketError").html(X),setTimeout(()=>{_.find(".ticketError").html("")},3e3),!1}),$(document).on("click","#clearTicketEditorResults",function(){$("#ticketEditor .container").html("<p class=\"center\">Select Driver &amp; Ticket Type</p>")}),$(document).on("click",".PWsubmit",function(S){S.preventDefault();let W=$(this);W.prop("disabled",!0),$(this).closest(".PWform").find(".message").html("");let _={};$(this).parents(".PWform").find("input").each(function(){_[$(this).attr("name")]=$(this).val()}),_.formKey=$("#formKey").val();ajax_template("POST","./changePW.php","html",_).done(X=>{return-1===X.indexOf("Session Error")?void setTimeout(()=>{W.closest(".PWform").find(".message").html("").end().find(".currentPw, .newPw1, .newPw2").val("").end().find(".currentPw").focus(),W.prop("disabled",!1);let Y,Z=!1;switch(_.flag){case"daily":Y=$("a[data-id='changePassword']"),Z="!Delivery1"===_.newPw1;break;case"admin":Y=$("a[data-id='changeAdminPassword']"),Z="!Delivery2"===_.newPw1;break;case"org":Y=$("a[data-id='changeOrgPW']"),Z="3Delivery!"===_.newPw1;}-1!==X.search("Password Updated")&&(!0==Z?(W.closest(".page").find(".defaultWarning").removeClass("hide"),Y.find(".alert").text("!"),$(".pageTitle .alert").text("!")):(W.closest(".page").find(".defaultWarning").addClass("hide"),Y.find(".alert").text(""),$(".pageTitle .alert").text("")))},4e3):showLogin()}).fail((X,Y,Z)=>{W.prop("disabled",!1),W.closest(".PWform").find(".message").text(Z)})}),$(document).on("change","input[list]",function(){if(isTarget($(this))){let S=[];if($("body").find("datalist#"+$(this).attr("list")+" option").each(function(){S.push($(this).val())}),""!==$(this).val()&&-1===S.indexOf($(this).val())){let W=$(this).attr("placeholder")||"",_=$(this).val("").addClass("elementError").attr("placeholder","Selection Not On File").trigger("change").trigger("blur");setTimeout(()=>{_.removeClass("elementError").attr("placeholder",W)},3e3)}}}).change(),$(document).on("click","#dispatch .dTicket",function(S){S.preventDefault();let W=$(this);W.prop("disabled",!0);let _=W.attr("form"),U=W.parents(".tickets"),X={};if(X.ticket_index=$(".ticket_index[form='"+_+"']").val(),X.step=$(".step[form='"+_+"']").val(),X.dispatchedTo=$(".dispatchedTo[form='"+_+"']").val(),X.notes=$(".notes[form='"+_+"']").val(),X.formKey=$("#formKey").val(),""===X.dispatchedTo)return U.prepend("<p class=\"center warning\">Please Select Driver</p>"),setTimeout(()=>{U.find(".warning").remove(),W.prop("disabled",!1)},3e3),!1;ajax_template("POST","./updateStep.php","html",X).done(Z=>{return-1===Z.indexOf("Session Error")?void(U.prepend(Z),-1===Z.indexOf("error")&&setTimeout(refreshDispatch,3e3)):showLogin()}).fail(()=>{U.prev(".spacer").text(errorThrown)})}),$(document).on("click",".question",function(){$(this).next(".answer").slideToggle()}),$(document).on("touchstart",".invoiceGraphContainer, .invoiceTable",function(){mySwipe.disable()}),$(document).on("touchend",".invoiceGraphContainer, .invoiceTable",function(){mySwipe.enable()}),0===$("#invoices input[type='month']").length&&(T=!0,$("#useInvoice").prop("disabled",!0)),0<$("#orgInvoices .orgMember").length&&$("#orgInvoices .orgMember:first").parents("tfoot").append("<tr class=\"noticeRow\"><td colspan=\"2\">Select member to query</td></tr>"),$(document).on("click","#single, #multi",function(){return $(this).is(":checked")}),$(document).on("change","#single, #multi",function(){disableButtonsInvoices();let S=[];$("#orgInvoices .orgMember").each(function(){$(this).is(":checked")&&S.push($(this))}),$("#orgInvoices .orgMember").prop("checked",!1).trigger("change");let W="single"===$(this).prop("id")?"multi":"single";$(this).is(":checked")&&$("#"+W).prop("checked",!1),0<S.length&&S[0].prop("checked",!0).trigger("change")}).change(),$(document).on("change","#orgInvoices .orgMember",function(){disableButtonsInvoices();let S=$(this).attr("data-value");$(this).is(":checked")?$("#single").is(":checked")?($("#orgInvoices .orgMember").each(function(){$(this).prop("checked",$(this).attr("data-value")===S)}),$("#singleInvoiceQuery").find($(".removable")).remove(),$("#submitSingle").before("<input type=\"hidden\" class=\"removable\" name=\"clientID[]\" value=\""+S+"\" />")):$("#multi").is(":checked")&&$("#range").before("<input type=\"hidden\" class=\"removable\" name=\"clientID[]\" value=\""+S+"\" />"):$("#queryForms").find("input.removable[value='"+S+"']").remove()}).change(),$(document).on("change","#useInvoice",function(){$(this).parents("#singleInvoiceQuery").find("#invoiceNumber").prop("disabled",!$(this).is(":checked")).end().find(".dateIssuedMonth").prop("disabled",$(this).is(":checked")).prop("required",!$(this).is(":checked")).val("")}).change(),$(document).on("change","#compareInvoices",function(){$(this).is(":checked")||"1"===$(this).val()?$(this).parent("td").attr("title",""):$(this).parent("td").attr("title","Range limited to 6 months")}).change(),$(document).on("click","#singleInvoice, #rangeInvoice, #submitSingle, #range",function(S){S.preventDefault();let W=!1,_=$(this);_.prop("disabled",!0);let U="singleInvoice"===$(this).attr("id")||"rangeInvoice"===$(this).attr("id")?$(this).parents("#invoices"):$(this).parents("#orgInvoices");if("invoices"===U.attr("id")&&!0==T)return!1;let X={};if($(this).parents("form").find("input, select").each(function(){if((!0===$(this).prop("required")||"startDate"===$(this).attr("name")||"endDate"===$(this).attr("name"))&&""===$(this).val()){let ee=$(this).addClass("elementError");setTimeout(()=>{ee.removeClass("elementError")},3e3),W=!0}else $(this).removeClass("elementError");"checkbox"===$(this).attr("type")?$(this).is(":checked")&&(X[$(this).attr("name")]=$(this).val()):!1===$(this).prop("disabled")&&("[]"===$(this).attr("name").slice(-2)?"undefined"==typeof X[$(this).attr("name").slice(0,$(this).attr("name").length-2)]?X[$(this).attr("name").slice(0,$(this).attr("name").length-2)]=[$(this).val()]:("object"==typeof X[$(this).attr("name").slice(0,$(this).attr("name").length-2)]||"array"==typeof X[$(this).attr("name").slice(0,$(this).attr("name").length-2)])&&X[$(this).attr("name").slice(0,$(this).attr("name").length-2)].push($(this).val()):X[$(this).attr("name")]=$(this).val())}),!0==W)return _.prop("disabled",!1),!1;$("#invoiceQueryResults").html(""),X.formKey=$("#formKey").val(),$("#invoiceQueryResults").html("<p id=\"working\" class=\"center\"><span id=\"ellipsis\">.</span></p>");let Y=!0,Z=setInterval(()=>{let ee=document.getElementById("ellipsis");!0==Y?(ee.innerHTML+="..",Y=21>ee.innerHTML.length&&1!=ee.innerHTML.length):(ee.innerHTML=ee.innerHTML.substr(0,ee.innerHTML.length-2),Y=1===ee.innerHTML.length)},250),V=ajax_template("POST","./buildQuery.php","html",X).done(ee=>{if(-1!==ee.indexOf("Session Error"))return showLogin();switch(_.prop("disabled",!1),_.prop("id")){case"singleInvoice":_.parents("#singleInvoiceQuery").find("#dateIssuedMonth").val("").end().find("#useInvoice").each(()=>{$(this).is(":checked")&&$(this).prop("checked",!1).trigger("change")});break;case"rangeInvoice":_.parents("#multiInvoiceQuery").find("#startDateMonth, #endDateMonth").val("").end().find("#compareInvoices").val("0").trigger("change");break;case"submitSingle":_.parents("#singleInvoiceQuery").find("#dateIssuedMonth").val("");break;case"range":_.parents("#multiInvoiceQuery").find("#invoiceStartDateMonth, #invoiceEndDateMonth").val("").end().find("#compareInvoices, #compareMembers").each(function(){$(this).is(":checked")&&$(this).prop("checked",!1).trigger("change")});}$("#working").fadeOut(1e3,function(){$(this).remove()}),clearInterval(Z),U.find("#invoiceQueryResults").html(ee),$("#dateIssued, #startDate, #endDate").val("")}).fail((ee,te,re)=>{clearInterval(Z),_.prop("disabled",!1),U.find("#invoiceQueryResults").html("<p class=\"center\">"+re+"</p>")})}),$(document).on("click","button.invoiceQuery",function(S){S.preventDefault();let W={};$(this).parents("form").find("input").each(function(){"[]"===$(this).attr("name").slice(-2)?"undefined"==typeof W[$(this).attr("name").slice(0,$(this).attr("name").length-2)]?W[$(this).attr("name").slice(0,$(this).attr("name").length-2)]=[$(this).val()]:("object"==typeof W[$(this).attr("name").slice(0,$(this).attr("name").length-2)]||"array"==typeof W[$(this).attr("name").slice(0,$(this).attr("name").length-2)])&&W[$(this).attr("name").slice(0,$(this).attr("name").length-2)].push($(this).val()):W[$(this).attr("name")]=$(this).val()}),W.formKey=$("#formKey").val(),$("#invoiceQueryResults").html(""),$("#invoiceQueryResults").html("<p id=\"working\" class=\"center\"><span id=\"ellipsis\">.</span></p>");let _=!0,U=setInterval(()=>{let Y=document.getElementById("ellipsis");!0==_?(Y.innerHTML+="..",_=21>Y.innerHTML.length&&1!=Y.innerHTML.length):(Y.innerHTML=Y.innerHTML.substr(0,Y.innerHTML.length-2),_=1===Y.innerHTML.length)},250),X=ajax_template("POST","./buildQuery.php","html",W).done(Y=>{return-1===Y.indexOf("Session Error")?void($("#working").fadeOut(1e3,function(){$(this).remove()}),clearInterval(U),$("#invoiceQueryResults").html(Y)):showLogin()}).fail((Y,Z,V)=>{clearInterval(U),$("#invoiceQueryResults").html("<p class=\"center\">"+V+"</p>")})}),$(document).on("click","#mulitInvoiceButton",function(S){S.preventDefault();let W={};$(this).parents("form").find("input, select").each(function(){W[$(this).prop("name")]=$(this).val()}),$("#invoiceQueryResults").html(""),$("#invoiceQueryResults").html("<p id=\"working\" class=\"center\"><span id=\"ellipsis\">.</span></p>");let _=!0,U=setInterval(()=>{let Y=document.getElementById("ellipsis");!0==_?(Y.innerHTML+="..",_=21>Y.innerHTML.length&&1!=Y.innerHTML.length):(Y.innerHTML=Y.innerHTML.substr(0,Y.innerHTML.length-2),_=1===Y.innerHTML.length)},250),X=ajax_template("POST","./buildQuery.php","html",W).done(Y=>{return-1===Y.indexOf("Session Error")?void($("#working").fadeOut(1e3,function(){$(this).remove()}),clearInterval(U),$("#invoiceQueryResults").html(Y)):showLogin()}).fail((Y,Z,V)=>{clearInterval(U),$("#invoiceQueryResults").html("<p class=\"center\">"+V+"</p>")})}),"No Data On File"===$("#options").find(".ticketDate:first").text()&&$("#options").find("input[type='submit']").prop("disabled",!0),0<$("#orgTickets .orgMember").length&&$("#ticketQueryResults").before("<p class=\"center noticeRow\">Select member or ticket number to query</p>"),$(document).on("touchstart",".ticketGraphContainer",function(){mySwipe.disable()}),$(document).on("touchend",".ticketGraphContainer",function(){mySwipe.enable()}),$(document).on("change","#display",function(){switch($(this).val()){case"tickets":0<$(this).parents("#queryForms").find("#charge").length&&$(this).parents("#queryForms").find("#charge").prop("disabled",!1),$(this).parents("#deliveryQuery").find(".ticketDate").show(),$(this).parents("#deliveryQuery").find(".chartDate, .compare").hide(),$(this).parents("#deliveryQuery").find("#compareBox").prop("disabled",!0),$(this).parents("#deliveryQuery").find("#ticketNumber").prop("readonly",!1),$(this).parents("#deliveryQuery").find("#allTime, #chargeHistory, #type").prop("disabled",!1),$(this).parents("#deliveryQuery").find(".startDateDate, .endDateDate").prop("required",!0).prop("disabled",!1),$(this).parents("#deliveryQuery").find(".startDateMonth, .endDateMonth").prop("required",!1).prop("disabled",!0),$(this).parents("#deliveryQuery").find("#compareBox").prop("checked",!1).prop("disabled",!0);break;case"chart":0<$(this).parents("#queryForms").find("#charge").length&&$(this).parents("#queryForms").find("#charge").prop("disabled",!0),$(this).parents("#deliveryQuery").find(".chartDate, .compare").show(),$(this).parents("#deliveryQuery").find("#compareBox").prop("disabled",!1),$(this).parents("#deliveryQuery").find(".ticketDate").hide(),$(this).parents("#deliveryQuery").find("#ticketNumber").prop("readonly",!0).val(""),$(this).parents("#deliveryQuery").find("#allTime").prop("checked",!1).prop("disabled",!0),$(this).parents("#deliveryQuery").find("#chargeHistory").val("10").prop("disabled",!0),$(this).parents("#deliveryQuery").find("#type").val("2").prop("disabled",!0),$(this).parents("#deliveryQuery").find(".startDateDate, .endDateDate").prop("required",!1).prop("disabled",!0),$(this).parents("#deliveryQuery").find(".startDateMonth, .endDateMonth").prop("required",!0).prop("disabled",!1),$(this).parents("#deliveryQuery").find("#compareBox").prop("disabled",!1);}$("#orgTickets .orgMember").each(function(){$(this).prop("checked",!1)})}),$(document).on("change","#orgTickets .orgMember",function(){disableButtonsTickets(),$(this).is(":checked")?$("#orgTickets #ticketNumber").val("").prop("readonly",!0).trigger("change"):$("#orgTickets #ticketNumber").prop("readonly","chart"===$("#display").val())}).change(),$(document).on("change","#compareBox",function(){$(this).is(":checked")?$(this).parents("fieldset").find("#allTime").each(function(){$(this).is(":checked")&&$(this).prop("checked",!1).trigger("change")}).end().find(".chartDate").attr("title",""):$(this).parents("fieldset").find(".chartDate").attr("title","Query Range Limited To 6 Month Periods")}).change(),$(document).on("change",".allTime3",function(){$(this).is(":checked")?$(this).parents("fieldset").find("#startDateMonth, #endDateMonth").prop("disabled",!0).end().find(".startDateMarker, .endDateMarker").prop("disabled",!1).end().find("#compareBox").prop("checked",!1):$(this).parents("fieldset").find("#startDateMonth, #endDateMonth").prop("disabled",!1).end().find(".startDateMarker, .endDateMarker").prop("disabled",!0)}).change(),$(document).on("change",".allTime2",function(){$(this).is(":checked")?$(this).parents("fieldset").find(".startDateDate, .endDateDate").prop("disabled",!0).end().find(".startDateMarker, .endDateMarker").prop("disabled",!1):$(this).parents("fieldset").find(".startDateDate, .endDateDate").prop("disabled",!1).end().find(".startDateMarker, .endDateMarker").prop("disabled",!0)}).change(),$(document).on("change","#allTime",function(){$(this).is(":checked")?($(this).parents("form").find(".startDateDate, .endDateDate").prop("disabled",!0).end().find("#ticketNumber").val("").prop("readonly",!0),$(this).parents("form").find(".startDateMarker, .endDateMarker, .ticketNumberMarker").prop("disabled",!1)):($(this).parents("form").find(".startDateDate, .endDateDate").prop("disabled",!1).end().find("#ticketNumber").prop("readonly",!1),$(this).parents("form").find(".startDateMarker, .endDateMarker, .ticketNumberMarker").prop("disabled",!0))}).change(),$(document).on("change","#deliveryQuery #ticketNumber",function(){if(""!==$(this).val())0<$("#orgTickets .noticeRow").length&&$("#orgTickets .noticeRow").hide(),$(this).parents("form").find("#startDate, #endDate, #chargeHistory, #type, #allTime, #display, #compareBox, #compareMembersTickets").prop("disabled",!0).prop("checked",!1).prop("required",!1).end().find(".startDateMarker, .endDateMarker, .chargeMarker, .typeMarker, #displayMarker").prop("disabled",!1),0<$(".submitOrgTickets").length&&$(".submitOrgTickets").prop("disabled",!1);else{if(0<$("#orgTickets .noticeRow").length){let S=!1;$("#orgTickets .orgMember").each(function(){$(this).is(":checked")&&(S=!0)}),!1==S&&$("#orgTickets .noticeRow").show()}!1===$(this).prop("readonly")&&($("#deliveryQuery #startDate, #deliveryQuery #endDate").prop("required",!0),$(this).parents("form").find("#startDate, #endDate, #allTime, #display, #compareBox, #compareMembersTickets").prop("disabled",!1).end().find(".startDateMarker, .endDateMarker, .chargeMarker, .typeMarker, #displayMarker").prop("disabled",!0),$(this).parents("form").find("#chargeHistory, #type").prop("disabled","chart"===$("#display").val()))}}).change(),$(document).on("change","#deliveryQuery #startDate, #deliveryQuery #endDate",function(){let S=""===$("#deliveryQuery #endDate").val()&&""===$("#deliveryQuery #startDate").val();$(this).parents("fieldset").find("#ticketNumber").prop("readonly",!S),S||$(this).parents("fieldset").find("#ticketNumber").val("")}).change(),$(document).on("click",".sigPrint",function(){$(this).next("tr.sigImage").toggle(900)}),$(document).on("click",".submitTicketQuery",function(S){S.preventDefault(),$(this).prop("disabled",!0),$(this).parents("#deliveryQuery").find("#startDate, #endDate").each(function(){$(this).is(":visible")&&$(this).prop("required",!0)});let W=!1,_=$(this).closest(".page"),U={};if($(this).closest("form").find("input, select").each(function(){if(!1===$(this).prop("disabled")){if((!0===$(this).prop("required")||"startDate"===$(this).prop("id")||"endDate"===$(this).prop("id"))&&""===$(this).val()){let V=$(this).addClass("elementError");setTimeout(()=>{V.removeClass("elementError")},3e3),W=!0}else $(this).removeClass("elementError");"checkbox"===$(this).attr("type")?$(this).is(":checked")&&(U[$(this).attr("name")]=$(this).val()):U[$(this).attr("name")]=$(this).val()}}),U.formKey=$("#formKey").val(),!0==W)return!1;$("#ticketQueryResults").html(""),$("#ticketQueryResults").html("<p id=\"working\" class=\"center\"><span id=\"ellipsis\">.</span></p>");let X=!0,Y=setInterval(()=>{let V=document.getElementById("ellipsis");!0==X?(V.innerHTML+="..",X=21>V.innerHTML.length&&1!=V.innerHTML.length):(V.innerHTML=V.innerHTML.substr(0,V.innerHTML.length-2),X=1===V.innerHTML.length)},250),Z=ajax_template("POST","./buildQuery.php","html",U).done(V=>{return $(this).prop("disabled",!1),$("#working").fadeOut(1e3,function(){$(this).remove()}),clearInterval(Y),-1===V.indexOf("Session Error")?void _.find("#ticketQueryResults").html(V):showLogin()}).fail((V,ee,te)=>{$(this).prop("disabled",!1),clearInterval(Y),_.find("#ticketQueryResults").html("<p class=\"center\">"+te+"</p>")})}),$(document).on("click",".resetTicketQuery",function(){$("#display").val("tickets").trigger("change"),$(this).parents("#deliveryQuery").find(".elementError").each(function(){$(this).removeClass("elementError")})}),$(document).on("click",".clearTicketResults",function(){$("#ticketQueryResults").html("")}),$(document).on("click",".submitOrgTickets",function(S){S.preventDefault();let W=$(this).closest(".page");$(this).prop("disabled",!0),W.find("#deliveryQuery").find("#startDate, #endDate").each(function(){$(this).parent("span").is(":visible")&&$(this).prop("required",!0)});let _=!1,U={};if($(this).closest("form").find("input, select").each(function(){if(!1===$(this).prop("disabled")){if(!0===$(this).prop("required")&&""===$(this).val()){let V=$(this).addClass("elementError");setTimeout(()=>{V.removeClass("elementError")},3e3),_=!0}else $(this).removeClass("elementError");"[]"===$(this).attr("name").slice(-2)?("checkbox"===$(this).attr("type")&&$(this).is(":checked")||"checkbox"!==$(this).attr("type"))&&("undefined"==typeof U[$(this).attr("name").slice(0,$(this).attr("name").length-2)]?U[$(this).attr("name").slice(0,$(this).attr("name").length-2)]=[$(this).val()]:("object"==typeof U[$(this).attr("name").slice(0,$(this).attr("name").length-2)]||"array"==typeof U[$(this).attr("name").slice(0,$(this).attr("name").length-2)])&&U[$(this).attr("name").slice(0,$(this).attr("name").length-2)].push($(this).val())):"checkbox"===$(this).attr("type")?$(this).is(":checked")&&(U[$(this).attr("name")]=$(this).val()):U[$(this).attr("name")]=$(this).val()}}),""===U.ticketNumber&&"undefined"===U.clientID)return $("#ticketQueryResults").html("<p class=\"queryError center\">Please enter a ticket number or select a member to query</p>"),setTimeout(()=>{$(".queryError").remove()},2e3),!1;if(""!==U.ticketNumber){let V=[];$("#orgTickets .orgMember").each(function(){V.push($(this).val())}),U.clientID=V}if(U.formKey=$("#formKey").val(),$("#startDate, #endDate, #startDateMonth, #endDateMonth, #ticketNumber").val(""),$("#compareBox, #compareMembersTickets").prop("checked",!1).trigger("change"),$("#orgTickets #display").val("tickets").trigger("change"),disableButtonsTickets(),!0==_)return!1;$("#ticketQueryResults").html(""),$("#ticketQueryResults").html("<p id=\"working\" class=\"center\"><span id=\"ellipsis\">.</span></p>");let X=!0,Y=setInterval(()=>{let V=document.getElementById("ellipsis");!0==X?(V.innerHTML+="..",X=21>V.innerHTML.length&&1!=V.innerHTML.length):(V.innerHTML=V.innerHTML.substr(0,V.innerHTML.length-2),X=1===V.innerHTML.length)},250),Z=ajax_template("POST","./buildQuery.php","html",U).done(V=>{return $(this).prop("disabled",!1),$("#working").fadeOut(1e3,function(){$(this).remove()}),clearInterval(Y),-1===V.indexOf("Session Error")?void W.find("#ticketQueryResults").html(V):showLogin()}).fail((V,ee,te)=>{$(this).prop("disabled",!1),clearInterval(Y),W.find("#ticketQueryResults").html("<p class=\"center\">"+te+"</p>")})}),$(document).on("click","#ticketQueryResults button.invoiceQuery",function(){mySwipe.slide($("a.nav:contains('Invoice')").attr("data-value"),300)}),$(document).on("click","#onCall .transferTicket",function(){$(this).parents(".tickets").find(".message2").html(""),$(this).closest(".tickets").find(".message2").html("Confirm Transfer:<br><input list=\"receivers\" class=\"pendingReceiver\" name=\"pendingReceiver\" id=\"pendingReceiver"+$(this).parents(".tickets").find(".tNum").text()+"\" /><br><button type='button' class='confirmTransfer'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>"),$(this).closest(".tickets").find(".transferTicket, .cancelRun, .deadRun, .dTicket, .declined, input[type='text'], .pGetSig, .dGetSig, .d2GetSig").prop("disabled",!0)}),$(document).on("click","#onCall .confirmTransfer",function(){let S=$(this);S.parents(".message2").find("button").prop("disabled",!0);let W=$(this).closest(".message2").find(".pendingReceiver").val();if(null===W||""===W){let ne=$(this).closest(".message2").find(".pendingReceiver").addClass("elementError");return setTimeout(()=>{ne.removeClass("elementError"),S.parents(".message2").find("button").prop("disabled",!1)},3e3),!1}let _=$(this).parents(".tickets").find(".tNum").text(),U=$(this).parents(".tickets").find(".notes").val(),Y=$("#formKey").val(),Z=$(this).parents(".message2");Z.html("<span class=\"ellipsis\">.</span>");let V=Z.find(".ellipsis"),ee=!0,te=setInterval(()=>{!0===ee?(V.append(".."),ee=21>V.text().length&&1!=V.text().length):(V.text(V.text().substr(0,V.text().length-2)),ee=1===V.text().length)},500),re=ajax_template("POST","./deleteContractTicket.php","html",{ticket_index:_,action:"transfer",TransferState:1,PendingReceiver:W,notes:U,formKey:Y}).done(ne=>{return clearInterval(te),$(".ellipsis").remove(),-1===ne.indexOf("Session Error")?void(-1===ne.indexOf("error")?(Z.html(ne),setTimeout(()=>{refreshOnCall(+$(".ticketCount:first").text()-1),refreshTransfers()},3e3)):(Z.html("<span class=\"center\">"+ne+"</span>"),setTimeout(()=>{Z.html(""),Z.closest(".tickets").find("button").prop("disabled",!1)},5e3))):showLogin()}).fail((ne,se,ae)=>{clearInterval(te),Z.html("<span>"+ae+"</span>"),setTimeout(()=>{Z.html(""),Z.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click","#onCall .declined",function(){$(this).parents(".tickets").find(".message2").html(""),$(this).closest(".tickets").find(".message2").html("Confirm Decline:<br><button type=\"button\" class=\"confirmDecline\">Confirm</button>  <button type=\"button\" class=\"cancelThis\">Go Back</button>"),$(this).closest(".tickets").find(".transferTicket, .cancelRun, .deadRun, .dTicket, .declined, input[type='text'], .pGetSig, .dGetSig, .d2GetSig").prop("disabled",!0)}),$(document).on("click","#onCall .cancelRun",function(){$(this).parents(".tickets").find(".message2").html(""),$(this).closest(".tickets").find(".message2").html("Confirm Cancel:<br><button type='button' class='confirmCancel'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>"),$(this).closest(".tickets").find(".transferTicket, .cancelRun, .deadRun, .dTicket, .declined, input[type='text'], .pGetSig, .dGetSig, .d2GetSig").prop("disabled",!0)}),$(document).on("click","#onCall .deadRun",function(){$(this).parents(".tickets").find(".message2").html(""),$(this).closest(".tickets").find(".message2").html("Confirm Dead Run:<br><button type='button' class='confirmDeadRun'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>"),$(this).closest(".tickets").find(".transferTicket, .cancelRun, .deadRun, .dTicket, .declined, input[type='text'], .pGetSig, .dGetSig, .d2GetSig").prop("disabled",!0)}),$(document).on("click","#onCall .cancelThis",function(){$(this).parents(".tickets").find("button, .dTicket, input[type='text'], textarea").prop("disabled",!1),$(this).parent("p").html("")}),$(document).on("click","#onCall .confirmCancel",function(){let S=$(this).parents(".tickets").find(".ticket_index").val(),W=$(this).parents(".tickets").find(".notes").val(),U=$("#formKey").val(),X=$(this).parents(".message2");X.html("<span class=\"ellipsis\">.</span>");let Y=X.find(".ellipsis"),Z=!0,V=setInterval(()=>{!0===Z?(Y.append(".."),Z=21>Y.text().length&&1!=Y.text().length):(Y.text(Y.text().substr(0,Y.text().length-2)),Z=1===Y.text().length)},500),ee=ajax_template("POST","./deleteContractTicket.php","html",{ticket_index:S,action:"cancel",notes:W,formKey:U}).done(te=>{return clearInterval(V),$(".ellipsis").remove(),-1===te.indexOf("Session Error")?void(-1===te.indexOf("error")?(X.html(te),setTimeout(()=>{refreshOnCall(+$(".ticketCount:first").text()-1)},3e3)):(X.html("<span class=\"center\">"+te+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3))):showLogin()}).fail((te,re,ne)=>{clearInterval(V),X.html("<span>"+ne+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click","#onCall .confirmDeadRun",function(){let S=$(this).parents(".tickets").find(".ticket_index").val(),W=$(this).parents(".tickets").find(".notes").val(),U=$("#formKey").val(),X=$(this).parents(".message2");X.html("<span class=\"ellipsis\">.</span>");let Y=X.find(".ellipsis"),Z=!0,V=setInterval(()=>{!0===Z?(Y.append(".."),Z=21>Y.text().length&&1!=Y.text().length):(Y.text(Y.text().substr(0,Y.text().length-2)),Z=1===Y.text().length)},500),ee=ajax_template("POST","./deleteContractTicket.php","html",{ticket_index:S,action:"deadRun",notes:W,formKey:U}).done(te=>{return clearInterval(V),$(".ellipsis").remove(),-1===te.indexOf("Session Error")?void(-1===te.indexOf("error")?(X.html(te),setTimeout(()=>{refreshOnCall(+$(".ticketCount:first").text()-1)},3e3)):(X.html("<span class=\"center\">"+te+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3))):showLogin()}).fail((te,re,ne)=>{clearInterval(V),X.html("<span>"+ne+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click","#onCall .confirmDecline",function(){let S=$(this).parents(".tickets").find(".ticket_index").val(),W=$(this).parents(".tickets").find(".notes").val(),U=$("#formKey").val(),X=$(this).parents(".message2");X.html("<span class=\"ellipsis\">.</span>");let Y=X.find(".ellipsis"),Z=!0,V=setInterval(()=>{!0===Z?(Y.append(".."),Z=21>Y.text().length&&1!=Y.text().length):(Y.text(Y.text().substr(0,Y.text().length-2)),Z=1===Y.text().length)},500),ee=ajax_template("POST","./deleteContractTicket.php","html",{ticket_index:S,action:"declined",notes:W,formKey:U}).done(te=>{return clearInterval(V),$(".ellipsis").remove(),-1===te.indexOf("Session Error")?void(-1===te.indexOf("error")?(X.html(te),setTimeout(()=>{refreshOnCall(+$(".ticketCount:first").text()-1)},3e3)):(X.html("<span class=\"center\">"+te+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3))):showLogin()}).fail((te,re,ne)=>{clearInterval(V),X.html("<span>"+ne+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click","#onCall .dTicket",function(S){S.preventDefault(),$(this).parents("#onCall").find(".message2").html(""),$(this).closest(".tickets").find("button").prop("disabled",!0),$(this).closest(".tickets").find(".message2").html("Confirm "+$(this).text()+":<br><button type='button' class='stepTicket' form='"+$(this).attr("form")+"'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>")}),$(document).on("click","#onCall .stepTicket",function(S){S.preventDefault();let W=$(this);W.parents(".message2").find("button").prop("disabled",!0);let _={};if($(this).parents(".tickets").find("input[form='"+$(this).attr("form")+"'], textarea[form='"+$(this).attr("form")+"']").each(function(){_[$(this).prop("name")]=$(this).val()}),$(this).parents(".tickets").find(".printName").is(":required")&&""===$(this).parents(".tickets").find(".printName").val())return $temp=$(this).parents(".tickets").find(".printName").addClass("elementError"),setTimeout(()=>{$temp.removeClass("elementError")},3e3),W.parents(".message2").find("button").prop("disabled",!1),!1;let U=$(this).parents(".message2");U.html("<span class=\"ellipsis\">.</span>");let X=U.find(".ellipsis"),Y=!0,Z=setInterval(()=>{!0===Y?(X.append(".."),Y=21>X.text().length&&1!=X.text().length):(X.text(X.text().substr(0,X.text().length-2)),Y=1===X.text().length)},500);_.formKey=$("#formKey").val(),_.hasOwnProperty("pSigPrint")&&(_.printName=_.pSigPrint,delete _.pSigPrint),_.hasOwnProperty("dSigPrint")&&(_.printName=_.dSigPrint,delete _.dSigPrint),_.hasOwnProperty("d2SigPrint")&&(_.printName=_.d2SigPrint,delete _.d2SigPrint);ajax_template("POST","./updateStep.php","text",_).done(ee=>{if(clearInterval(Z),$(".ellipsis").remove(),-1!==ee.indexOf("Session Error"))return showLogin();if(-1===ee.indexOf("error")){U.html(ee);let te=$(".ticketCount:first").text();te-="returned"===_.step||"delivered"===_.step&&6>charge||"7"===charge&&-1!==W.parents(".tickets").find(".timing").parent("td").text().indexOf("Return")?1:0,setTimeout(()=>{refreshOnCall(te)},3e3)}else U.html("<span class=\"center\">"+ee+"</span>"),setTimeout(()=>{U.html(""),U.closest(".tickets").find("button").prop("disabled",!1)},5e3)}).fail((ee,te,re)=>{clearInterval(Z),U.html("<span class=\"center\">"+re+"</span>"),setTimeout(()=>{U.html(""),U.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("change",".newPw1, .newPw2, .currentPw",function(){let S=$(this).closest(".PWform").find(".currentPw").val(),W="",_="",U="";if($(this).hasClass("newPw1")?(W=$(this).closest(".PWform").find(".newPw1").val(),U=".newPw2",_=$(this).closest(".PWform").find(U).val()):(_=$(this).closest(".PWform").find(".newPw2").val(),U=".newPw1",W=$(this).closest(".PWform").find(U).val()),""!=W){if(!!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^\&*\)\(\{\}\[\]\-_.=+\?\:;,])(?=.{8,}).*$/.test(W))$(this).closest(".PWform").find(".error1").remove(),0===$(this).closest(".PWform").find(".message p").length&&$(this).closest(".PWform").find(".PWsubmit").prop("disabled",!1);else if(0===$(this).closest(".PWform").find(".error1").length)return $(this).closest(".PWform").find(".message").append("<p class=\"error1\"> <span class=\"error\">Error:</span> Password does not meet criteria.</p>"),$(this).closest(".PWform").find(".PWsubmit").prop("disabled",!0),!1;""!==S&&W===S?0===$(this).closest(".PWform").find(".error3").length&&($(this).closest(".PWform").find(".message").append("<p class=\"error3\"> <span class=\"error\">Error:</span> Password should be changed.</p>"),$(this).closest(".PWform").find(".PWsubmit").prop("disabled",!0)):($(this).closest(".PWform").find(".error3").remove(),0===$(this).closest(".PWform").find(".message p").length&&$(this).closest(".PWform").find(".PWsubmit").prop("disabled",!1))}else $(this).closest(".PWform").find(".error1").remove(),0===$(this).closest(".PWform").find(".message p").length&&$(this).closest(".PWform").find(".PWsubmit").prop("disabled",!1);if(""==_)$(this).closest(".PWform").find(".error2").remove(),0===$(this).closest(".PWform").find(".message p").length&&$(this).closest(".PWform").find(".PWsubmit").prop("disabled",!1);else if(W==_)$(this).closest(".PWform").find(".error2").remove(),0===$(this).closest(".PWform").find(".message p").length&&$(this).closest(".PWform").find(".PWsubmit").prop("disabled",!1);else if(0===$(this).closest(".PWform").find(".error2").length)return $(this).closest(".PWform").find(".message").append("<p class=\"error2\"> <span class=\"error\">Error:</span> Password missmatch.</p>"),$(this).closest(".PWform").find(".PWsubmit").prop("disabled",!0),!1}).change(),$(document).on("click",".clearPWform",function(){$(this).closest(".PWform").find(".message").html("").end().find(".PWsubmit").prop("disabled",!1)}),$(document).on("change",".showText",function(){$(this).is(":checked")?$(this).parents("form").find("input[type='password']").each(function(){$(this).attr("type","text")}):$(this).parents("form").find("input[type='text']").each(function(){$(this).attr("type","password")})}).change(),$(document).on("click","#route .transferTicket",function(){$(this).parents("#route").find(".message2").html(""),$(this).closest(".tickets").find("button").prop("disabled",!0),$(this).closest(".tickets").find(".message2").html("Confirm Transfer:<br><input list=\"receivers\" class=\"pendingReceiver\" name=\"pendingReceiver\" id=\"pendingReceiver"+$(this).parents(".tickets").find(".tNum").text()+"\" /><br><button type='button' class='confirmTransfer'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>")}),$(document).on("click","#route .confirmTransfer",function(){$(this).parents(".message2").find("button").prop("disabled",!0);let S=$(this).closest(".message2").find(".pendingReceiver").val();if(null===S||""===S){let re=$(this).closest(".message2").find(".pendingReceiver").addClass("elementError");return setTimeout(()=>{re.removeClass("elementError"),re.closest(".message2").find("button").prop("disabled",!1)},3e3),!1}let W=$(this).parents(".tickets").find(".tNum").text(),_=$(this).parents(".tickets").find(".notes").val(),X=$("#formKey").val(),Y=$(this).parents(".message2");Y.html("<span class=\"ellipsis\">.</span>");let Z=Y.find(".ellipsis"),V=!0,ee=setInterval(()=>{!0===V?(Z.append(".."),V=21>Z.text().length&&1!=Z.text().length):(Z.text(Z.text().substr(0,Z.text().length-2)),V=1===Z.text().length)},500),te=ajax_template("POST","./deleteContractTicket.php","html",{ticket_index:W,action:"transfer",TransferState:1,PendingReceiver:S,notes:_,formKey:X}).done(re=>{if(clearInterval(ee),$(".ellipsis").remove(),-1!==re.indexOf("Session Error"))return showLogin();if(-1===re.indexOf("error"))Y.html(re),setTimeout(()=>{refreshRoute(),refreshTransfers()},3e3);else if(Y.html("<span class=\"center\">"+re+"</span>"),setTimeout(()=>{Y.html(""),Y.closest(".tickets").find("button").prop("disabled",!1)},5e3),-1!==re.indexOf("Session Error"))return showLogin()}).fail((re,ne,se)=>{clearInterval(ee),Y.html("<span>"+se+"</span>"),setTimeout(()=>{Y.html(""),Y.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click","#route .declined",function(){$(this).parents("#route").find(".message2").html(""),$(this).closest(".tickets").find("button").prop("disabled",!0),$(this).closest(".tickets").find(".message2").html("Confirm Decline:<br><button type='button' class='confirmDecline'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>")}),$(document).on("click","#route .confirmDecline",function(){$(this).parents(".message2").find("button").prop("disabled",!0);let S=$(this).parents(".tickets").find(".tNum").text(),W=$(this).parents(".tickets").find(".notes").val(),U=$("#formKey").val(),X=$(this).parents(".message2");X.html("<span class=\"ellipsis\">.</span>");let Y=X.find(".ellipsis"),Z=!0,V=setInterval(()=>{!0===Z&&(Y.append(".."),Z=21>Y.text().length&&1!=Y.text().length),!1===Z&&(Y.text(Y.text().substr(0,Y.text().length-2)),Z=1===Y.text().length)},500),ee=ajax_template("POST","./deleteContractTicket.php","html",{ticket_index:S,action:"declined",notes:W,formKey:U}).done(te=>{if(clearInterval(V),$(".ellipsis").remove(),-1!==te.indexOf("Session Error"))return showLogin();if(-1===te.indexOf("error"))X.html(te),setTimeout(refreshRoute,3e3);else if(X.html("<span class=\"center\">"+te+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3),-1!==te.indexOf("Session Error"))return showLogin()}).fail((te,re,ne)=>{clearInterval(V),X.html("<span>"+ne+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click","#route .cancelRun",function(){$(this).parents("#route").find(".message2").html(""),$(this).closest(".tickets").find("button").prop("disabled",!0),$(this).closest(".tickets").find(".message2").html("Confirm Cancellation:<br><button type='button' class='confirmCancel'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>")}),$(document).on("click","#route .deadRun",function(){$(this).parents("#route").find(".message2").html(""),$(this).closest(".tickets").find("button").prop("disabled",!0),$(this).closest(".tickets").find(".message2").html("Confirm Dead Run:<br><button type='button' class='confirmDeadRun'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>")}),$(document).on("click","#route .cancelThis",function(){$(this).parents(".tickets").find("button, .notes").prop("disabled",!1),$(this).parent(".message2").html("")}),$(document).on("click","#route .confirmCancel",function(){let S=$(this).parents(".tickets").find(".tNum").text(),W=$(this).parents(".tickets").find(".notes").val(),U=$("#formKey").val(),X=$(this).parents(".message2");X.html("<span class=\"ellipsis\">.</span>");let Y=X.find(".ellipsis"),Z=!0,V=setInterval(()=>{!0===Z?(Y.append(".."),Z=21>Y.text().length&&1!=Y.text().length):(Y.text(Y.text().substr(0,Y.text().length-2)),Z=1===Y.text().length)},500),ee=ajax_template("POST","./deleteContractTicket.php","html",{ticket_index:S,action:"cancel",notes:W,formKey:U}).done(te=>{if(clearInterval(V),$(".ellipsis").remove(),-1!==te.indexOf("Session Error"))return showLogin();if(-1===te.indexOf("error"))X.html(te),setTimeout(refreshRoute,3e3);else if(X.html("<span class=\"center\">"+te+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3),-1!==te.indexOf("Session Error"))return showLogin()}).fail((te,re,ne)=>{clearInterval(V),X.html("<span>"+ne+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click","#route .confirmDeadRun",function(){$(this).parents(".message2").find("button").prop("disabled",!0);let S=$(this).parents(".tickets").find(".tNum").html(),W=$(this).parents(".tickets").find(".notes").val(),U=$("#formKey").val(),X=$(this).parents(".message2");X.html("<span class=\"ellipsis\">.</span>");let Y=X.find(".ellipsis"),Z=!0,V=setInterval(()=>{!0===Z?(Y.append(".."),Z=21>Y.text().length&&1!=Y.text().length):(Y.text(Y.text().substr(0,Y.text().length-2)),Z=1===Y.text().length)},500),ee=ajax_template("POST","./deleteContractTicket.php","html",{ticket_index:S,action:"deadRun",notes:W,formKey:U}).done(te=>{if(clearInterval(V),$(".ellipsis").remove(),-1!==te.indexOf("Session Error"))return showLogin();if(-1===te.indexOf("error"))X.html(te),setTimeout(refreshRoute,3e3);else if(X.html("<span class=\"center\">"+te+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3),-1!==te.indexOf("Session Error"))return showLogin()}).fail((te,re,ne)=>{clearInterval(V),X.html("<span class=\"center\">"+ne+"</span>"),setTimeout(()=>{X.html(""),X.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click","#route .dTicket",function(S){S.preventDefault(),$(this).parents("#route").find(".message2").html(""),$(this).closest(".tickets").find("button").prop("disabled",!0),$(this).closest(".tickets").find(".message2").html("Confirm "+$(this).text()+":<br><button type='button' class='stepTicket' form='"+$(this).attr("form")+"'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>")}),$(document).on("click","#route .stepTicket",function(S){S.preventDefault();let W=$(this);W.parents(".message2").find("button").prop("disabled",!0);let _={};if($(this).parents(".tickets").find("input[form='"+$(this).attr("form")+"'], textarea[form='"+$(this).attr("form")+"']").each(function(){_[$(this).prop("name")]=$(this).val()}),!0===$(".printName[form='"+$(this).attr("form")+"']").prop("required")&&""===$(".printName[form='"+$(this).attr("form")+"']").val())return $temp=W.parents(".sortable").find(".printName").addClass("elementError"),setTimeout(()=>{$temp.removeClass("elementError")},3e3),W.parents("message2").find("button").prop("disabled",!1),!1;let U=$(this).parents(".message2");U.html("<span class=\"ellipsis\">.</span>");let X=U.find(".ellipsis"),Y=!0,Z=setInterval(()=>{!0===Y?(X.append(".."),Y=21>X.text().length&&1!=X.text().length):(X.text(X.text().substr(0,X.text().length-2)),Y=1===X.text().length)},500);_.formKey=$("#formKey").val(),_.hasOwnProperty("pSigPrint")&&(_.printName=_.pSigPrint,delete _.pSigPrint),_.hasOwnProperty("dSigPrint")&&(_.printName=_.dSigPrint,delete _.dSigPrint),_.hasOwnProperty("d2SigPrint")&&(_.printName=_.d2SigPrint,delete _.d2SigPrint);ajax_template("POST","./updateStep.php","text",_).done(ee=>{return clearInterval(Z),$(".ellipsis").remove(),-1===ee.indexOf("Session Error")?void(-1===ee.indexOf("error")?(U.html(ee),setTimeout(refreshRoute,3e3)):(U.html("<span class=\"center\">"+ee+"</span>"),setTimeout(()=>{U.html(""),U.closest(".tickets").find("button").prop("disabled",!1)},5e3))):showLogin()}).fail((ee,te,re)=>{clearInterval(Z),U.html("<span class=\"center\">"+re+"</span>"),setTimeout(()=>{U.html(""),U.closest(".tickets").find("button").prop("disabled",!1)},5e3)})}),$(document).on("click",".transferGroup",function(){$(this).parents(".sortable").find("p.message2").html("Confirm Transfer: <input list=\"receivers\" class=\"pendingReceiver\" name=\"pendingReceiver\" id=\"pendingReceiver\" /> <button type=\"button\" class=\"confirmTransferGroup\">Confirm</button>  <button type=\"button\" class=\"cancelThis\">Go Back</button>")}),$(document).on("click","#route .confirmTransferGroup",function(){let S=$(this),W=[],_=$(this).closest(".message2").find(".pendingReceiver").val();$(this).parents(".sortable").find(".tickets").each(function(Y){W[Y]={ticket_index:$(this).find(".tNum").text(),notes:$(this).find(".notes").val(),pendingReceiver:_,action:"transfer",transferState:1}});let U={multiTicket:W,TransferState:1,formKey:$("#formKey").val()},X=ajax_template("POST","./deleteContractTicket.php","text",U).done(Y=>{if(-1!==Y.indexOf("Session Error"))return showLogin();if(-1===Y.indexOf("error"))S.parents(".sortable").find("p.message2").text(Y),setTimeout(refreshTransfers,2990),setTimeout(refreshRoute,3e3);else if(S.after("<p class=\"center\">Processing Error "+Y+"</p>"),-1!==Y.indexOf("Session Error"))return showLogin()}).fail((Y,Z,V)=>{S.parents(".sortable").find(".message2").text("Error: "+V)})}),$(document).on("click",".confirmAll",function(S){S.preventDefault(),$(this).parents("#route").find(".message2").html(""),$(this).closest(".sortable").find("button").prop("disabled",!0),$(this).closest(".sortable").find(".message2:last").html("Confirm Group Update: <br><button type='button' class='stepAll'>Confirm</button>  <button type='button' class='cancelThis'>Go Back</button>")}),$(document).on("click","#route .stepAll",function(){$(this).parents(".message2").find("button").prop("disabled",!0);let S=[];if($(this).parents(".sortable").find(".routeStop").each(function(V){let ee={};$(this).find("input").each(function(){"formKey"!==$(this).prop("name")&&(ee[$(this).prop("name")]=$(this).val())}),ee.notes=$(this).closest("table").find(".notes").val(),S[V]=ee}),!0===$(this).closest(".sortable").find(".printName").prop("required")&&""===$(this).closest(".sortable").find(".printName").val())return $temp=$(this).closest(".sortable").find(".printName").addClass("elementError"),setTimeout(()=>{$temp.removeClass("elementError")},3e3),$(this).closest(".message2").find("button").prop("disabled",!1),!1;let W={multiTicket:S,formKey:$("#formKey").val(),printName:$(this).closest(".sortable").find(".printName").val(),sigImage:$(this).closest(".sortable").find(".sigImage").val()},_=$(this).parents(".message2");_.html("<span class=\"ellipsis\">.</span>");let U=_.find(".ellipsis"),X=!0,Y=setInterval(()=>{!0===X?(U.append(".."),X=21>U.text().length&&1!=U.text().length):(U.text(U.text().substr(0,U.text().length-2)),X=1===U.text().length)},500),Z=ajax_template("POST","./updateStep.php","html",W).done(V=>{return console.log(V),clearInterval(Y),$(".ellipsis").remove(),-1===V.indexOf("Session Error")?void(-1===V.indexOf("error")?(_.html(V),setTimeout(refreshRoute,3e3)):(_.html("<span>"+V+"</span>"),setTimeout(()=>{_.html(""),_.closest(".sortable").find("button").prop("disabled",!1)},3e3))):showLogin()}).fail((V,ee,te)=>{clearInterval(Y),_.html("<span class=\"center\">"+te+"</span>"),setTimeout(()=>{_.html(""),_.closest(".sortable").find("button").prop("disabled",!1)},5e3)})}),$(document).on("change","#priceCalculator .dryIce",function(){$(this).is(":checked")?$(this).parents("form").find(".diWeight").val("0").prop("disabled",!1).focus():$(this).parents("form").find(".diWeight").val("0").prop("disabled",!0)}).change(),$(document).on("change","#priceCalculator #discountMarker",function(){$(this).is(":checked")?$(this).parents("form").find("#discount").val("0").prop("disabled",!1).show():$(this).parents("form").find("#discount").val("0").prop("disabled",!0).hide()}).change(),$(document).on("change","#priceCalculator .address1",function(){let S=$(this),W=S.val(),_="i";$(this).parents("body").find("datalist#addy1 option").each(function(){$(this).val()===W&&(_=$(this).attr("data-value"))}),"i"!==_&&$(this).parents("body").find("datalist#addy2 option").each(function(){$(this).attr("data-value")===_&&S.closest("table").find(".address2").val($(this).val())})}).change(),$(document).on("click","#priceCalculator .submitPriceQuery",function(S){S.preventDefault();let W=$(this);W.prop("disabled",!0),setTimeout(()=>{W.prop("disabled",!1)},3e3);let _=!1,U=!1,X=!1;$("#pickUp input, #dropOff input").each(function(){!1===$(this).prop("disabled")&&!0===$(this).prop("required")&&""===$(this).val()&&(_=!0,$(this).addClass("elementError"),"p"===$(this).attr("id").substr(0,1)&&!1==U?(U=!0,$("#CalcError").append("<p>Pick Up Address Required</p>")):"d"===$(this).attr("id").substr(0,1)&&!1==X&&(X=!0,$("#CalcError").append("<p>Delivery Address Required</p>")))});let Y="",Z="",V=$("#pAddress1Calc").val(),ee=$("#pAddress2Calc").val(),te=""===$("#pCountryCalc").val()?$("#pCountryMarkerCalc").val():$("#pCountryCalc").val(),re=$("#dAddress1Calc").val(),ne=$("#dAddress2Calc").val(),se=""===$("#dCountryCalc").val()?$("#dCountryMarkerCalc").val():$("#dCountryCalc").val(),ae=$("#CalcCharge").val();if($("#CalcDryIce").is(":checked")?(Y="1",Z=$("#CalcWeight").val(),0==Z%5?"0"==Z&&(_=!0,$("#CalcError").append("<p>Dry Ice must be non-zero.</p>"),$("#CalcWeight").addClass("elementError"),setTimeout(()=>{$("#CalcError").text(""),$("#CalcWeight").removeClass("elementError")},4e3)):(_=!0,$("#CalcError").append("<p>Dry Ice in increments of 5 only.</p>"),$("#CalcWeight").addClass("elementError"),setTimeout(()=>{$("#CalcError").text(""),$("#CalcWeight").removeClass("elementError")},4e3))):(Y="0",Z="0"),!0==_)return setTimeout(()=>{$("#CalcError").html(""),$("#pickUp .elementError, #dropOff .elementError").removeClass("elementError")},4e3),!1;ajax_template("POST","../priceCalc.php","text",{pAddress1:V,pAddress2:ee,pCountry:te,dAddress1:re,dAddress2:ne,dCountry:se,charge:ae,dryIce:Y,diWeight:Z,formKey:$("#formKey").val()}).done(le=>{if(-1!==le.indexOf("Session Error"))return showLogin();$("#pNotice, #dNotice, #CalcError").html("");let oe;if("<"===le.substr(0,1))return $("#CalcError").html(le),setTimeout(()=>{$("#CalcError").html("")},4e3),!1;try{oe=jQuery.parseJSON(le)}catch(de){return $("#CalcError").text(de),setTimeout(()=>{$("#CalcError").text("")},4e3),!1}$("#priceResult .currencySymbol, #priceResult .weightMarker").show(),$("#rangeResult").text(oe.rangeDisplay),$("#diWeightResult").html(oe.diWeight),$("#runPriceResult").text(oe.runPrice),$("#diPriceResult").text(oe.diPrice),$("#ticketPriceResult").text(oe.ticketPrice),15<oe.pRangeTest&&20>oe.pRangeTest?$("#pNotice").text("Pick Up address is outside of our standard range. Please call to confirm availability."):20<oe.pRangeTest&&($("#pNotice").text("Pick Up address is outside of our extended range."),$("#runPriceResult, #ticketPriceResult, #diPriceResult, #diWeightResult").text(""),$("#priceResult .currencySymbol, #priceResult .weightMarker").hide()),15<oe.dRangeTest&&20>oe.dRangeTest?$("#dNotice").text("Delivery address is outside of our standard range. Please call to confirm availability."):20<oe.dRangeTest&&($("#dNotice").text("Delivery address is outside of our extended range."),$("#runPriceResult, #ticketPriceResult, #diPriceResult, #diWeightResult").text(""),$("#priceResult .currencySymbol, #priceResult .weightMarker").hide()),initPriceMap("map2",oe.result1,oe.address1,oe.result2,oe.address2,oe.center)}).fail(()=>{$("#CalcError").text(errorThrown),setTimeout(()=>{$("#CalcError").text("")},4e3)})}),$(document).on("click","#priceCalculator .clear",function(){$(this).parents("form").find(".dryIce").prop("checked",!1).trigger("change").end().find("#CalcCharge").val("0"),$("#pNotice, #dNotice, #rangeResult, #diWeightResult, #diPriceResult, #runPriceResult, #ticketPriceResult").text(""),$("#priceResult .currencySymbol, #priceResult .weightMarker").hide(),$("#priceCalculator .elementError").removeClass("elementError"),initPriceMap()}),$(document).on("click","p.switch",function(){$(this).next("p").toggle(900)}),$(document).on("change",".contract",function(){$(this).is(":checked")?($(this).closest("table").find(".multiplier").prop("disabled",!1),$(this).closest("table").find(".multiplierMarker").prop("disabled",!0),$(this).closest("table").find(".repeat").prop("disabled",!0).prop("checked",!1)):($(this).closest("table").find(".multiplierMarker").prop("disabled",!1),$(this).closest("table").find(".multiplier").prop("disabled",!0),$(this).closest("table").find(".repeat").prop("disabled",!1))}).change(),$(document).on("change",".repeat",function(){$(this).is(":checked")?($(this).closest("table").find(".billTo").attr("list","t_clients").val(""),$(this).closest("table").find(".contract").prop("disabled",!0).prop("checked",!1)):($(this).closest("table").find(".billTo").attr("list","clients").val(""),$(this).parents("form").find(".nrEntry").hide(),$(this).parents("form").find(".processNewT_client").prop("disabled",!0).val("0").end().find("input[name^='t_']").prop("disabled",!0).val("").end(),$(this).closest("table").find(".contract").prop("disabled",!1))}).change(),$(document).on("change",".billTo",function(){"new"===$(this).val()?($(this).parents("form").find(".nrEntry").show(),$(this).parents("form").find(".processNewT_client").prop("disabled",!1).val("1").end().find("input[name^='t_']").prop("disabled",!1).end()):($(this).parents("form").find(".nrEntry").hide(),$(this).parents("form").find(".processNewT_client").prop("disabled",!0).val("0").end().find("input[name^='t_']").prop("disabled",!0).val("").end())}).change(),$(document).on("change",".dryIce",function(){$(this).is(":checked")?($(this).parents("fieldset").find(".diWeight").val("0").prop("disabled",!1).focus(),$(this).parents("fieldset").find(".diWeightMarker").val("0").prop("disabled",!0)):($(this).parents("fieldset").find(".diWeightMarker").val("0").prop("disabled",!1),$(this).parents("fieldset").find(".diWeight").val("0").prop("disabled",!0))}).change(),$(document).on("change",".charge",function(){"6"===$(this).val()?$(this).parents("form").find(".rtMarker").show().end().find(".dedicatedNote").hide().end().find("#pSigReq, #dSigReq").removeClass("stayChecked"):"7"===$(this).val()?$(this).parents("form").find(".rtMarker, .dedicatedNote").show().end().find("#pSigReq, #dSigReq").prop("checked",!0).addClass("stayChecked"):$(this).parents("form").find(".rtMarker, .dedicatedNote").hide().prop("checked",!1).end().find("#pSigReq, #dSigReq").prop("checked",!1).removeClass("stayChecked")}).change(),$(document).on("click",".stayChecked",function(S){S.preventDefault()}),$(document).on("change",".emailConfirm",function(){"0"===$(this).val()?($(this).parents("form").find(".emailAddress").prop("required",!1),$(this).parents("form").find(".emailNote").addClass("hide")):($(this).parents("form").find(".emailAddress").prop("required",!0),$(this).parents("form").find(".emailNote").removeClass("hide"))}).change(),$(document).on("blur","input[name='pAddress1'], input[name='dAddress1']",function(){let S=$(this),W="i";$(this).parents("body").find("datalist#addy1 option").each(function(){$(this).val()===S.val()&&(W=$(this).attr("data-value"),S.attr("data-value",W))}),"i"!==W&&$(this).parents("body").find("datalist#addy2 option").each(function(){$(this).attr("data-value")===W&&S.closest("fieldset").find("input[name='"+S.attr("name").substr(0,1)+"Address2']").val($(this).val())})}),$(document).on("change","#ticketEntry #pSigReq, #ticketEntry #dSigReq, #ticketEntry #d2SigReq",function(){let S=$(this).parents("form").find("#pSigReq").prop("checked"),W=$(this).parents("form").find("#dSigReq").prop("checked"),_=$(this).parents("form").find("#d2SigReq").prop("checked");$(this).is(":checked")?$(this).parents("form").find(".sigNote").show():!W&&!S&&!_&&$(this).parents("form").find(".sigNote").hide()}).change(),$(document).on("click","#ticketEntry .submitForm",function(S){S.preventDefault();let W=$(this);W.prop("disabled",!0);let _=!1,U=["repeatClient","fromMe","toMe","dryIce","pSigReq","dSigReq","d2SigReq"],X=["pClient","pAddress1","pAddress2","pCountry","dClient","dAddress1","dAddress2","dCountry"],Y={};if($(this).parents("#request").find("input[name], select, textarea").each(function(){if(-1===U.indexOf($(this).attr("name"))&&!1===$(this).prop("disabled")){if((!0===$(this).prop("required")||-1!==X.indexOf($(this).attr("name"))&&$(this).is(":visible"))&&""===$(this).val()){let ne=$(this).addClass("elementError");setTimeout(()=>{ne.removeClass("elementError"),W.prop("disabled",!1)},3e3),_=!0}else $(this).removeClass("elementError");Y[$(this).attr("name")]=$(this).val()}else"checkbox"===$(this).prop("type")&&(Y[$(this).attr("name")]="repeatClient"===$(this).attr("name")?1-$(this).is(":checked"):0+$(this).is(":checked"));Y.formKey=$("#formKey").val()}),1===Y.dryIce)if(0!=Y.diWeight%5){let ne=$(this).parents("form").find(".ticketError").text("Dry Ice in increments of 5 only."),se=$(this).parents("form").find(".diWeight").addClass("elementError");_=!0,setTimeout(()=>{ne.text(""),se.removeClass("elementError")},3e3)}else if("0"===Y.diWeight){let ne=$(this).parents("form").find(".ticketError").text("Dry Ice must be non-zero."),se=$(this).parents("form").find(".diWeight").addClass("elementError");_=!0,setTimeout(()=>{ne.text(""),se.removeClass("elementError")},3e3)}if(!0==_)return!1;let Z=$(this).parents("#request").find(".ticketError");Z.html("<span class=\"ellipsis\">.</span>");let V=Z.find(".ellipsis"),ee=!0,te=setInterval(()=>{!0===ee?(V.append(".."),ee=21>V.text().length&&1!=V.text().length):(V.text(V.text().substr(0,V.text().length-2)),ee=1===V.text().length)},500),re=ajax_template("POST","./enterTicket.php","html",Y).done(ne=>{return clearInterval(te),-1===ne.indexOf("Session Error")?void(-1===ne.indexOf("data-error")?($("#deliveryRequest").remove(),$("#ticketEntry").prepend(ne),initMap("map",coords1,address1,coords2,address2,center)):(Z.html(ne),setTimeout(()=>{Z.html(""),Z.closest("table").find("button").prop("disabled",!1)},3e3)),scrollTo(0,0)):showLogin()}).fail((ne,se,ae)=>{clearInterval(te),Z.html("<span>Error: "+ae+"</span>"),setTimeout(()=>{Z.html("")},3e3)})}),$(document).on("click","#ticketEntry .editForm, #ticketEntry .confirmed",function(S){S.preventDefault();let W=$(this);W.closest("tr").find("button").prop("disabled",!0);let _=$(".subContainer"),U=$(this).hasClass("editForm")?"#editForm":"#submitTicket",X={};$(this).parents("#ticketEntry").find(U+" input").each(function(){X[$(this).attr("name")]=$(this).val()}),X.formKey=$("#formKey").val();let Y=$(this).parents("#deliveryConfirmation").find(".ticketError");Y.html("<span class=\"ellipsis\">.</span>");let Z=Y.find(".ellipsis"),V=!0,ee=setInterval(()=>{!0===V&&(Z.append(".."),V=21>Z.text().length&&1!=Z.text().length),!1===V&&(Z.text(Z.text().substr(0,Z.text().length-2)),V=1===Z.text().length)},500),te=ajax_template("POST","./enterTicket.php","html",X).done(re=>{if(clearInterval(ee),-1!==re.indexOf("Session Error"))return showLogin();if(-1!==re.indexOf("data-error"))Y.html(re),setTimeout(()=>{Y.html(""),Y.closest("table").find("button").prop("disabled",!1)},3e3);else if($("#ticketEntry").html(""),$("#ticketEntry").prepend(re).append(_),"#editForm"==U)initMap("map");else{ajax_template("POST","./refreshTicketForm.php","html",{formKey:$("#formKey").val(),edit:1}).done(se=>{if(scrollTo(0,0),-1!==re.indexOf("Session Error"))return showLogin();if(setTimeout(()=>{$("#ticketEntry").html(se).append(_),initMap("map")},5e3),1===$("#deliveryQuery").length){let ae=new Date,ie=ae.getMonth()+1,le=9>=ie?"0"+ie.toString():ie,oe=ae.getDate(),de=9>=oe?"0"+oe.toString():oe,ce=ae.getFullYear()+"-"+le+"-"+de;$("#deliveryQuery").find(".startDateDate, .endDateDate").attr("max",ce)}}).fail((se,ae,ie)=>{$("#ticketEntry").prepend("<span class=\"center\">"+ie+"</span>")})}scrollTo(0,0)}).fail((re,ne,se)=>{clearInterval(ee),Y.html("<span>"+se+"</span>"),setTimeout(()=>{Y.html(""),Y.closest("table").find("button").prop("disabled",!1)},3e3)})}),$(document).on("click","#toMe, #fromMe",function(){let S="deliveryField"===$(this).parents("fieldset").prop("id")?"pickupField":"deliveryField",W="";$("#"+S).find(".clientList").each(function(){if(W+=$(this).val());});let _=ClientName+Department+ShippingAddress1+ShippingAddress2;return W!==_}),$(document).on("change","#toMe, #fromMe",function(){let S="deliveryField"===$(this).parents("fieldset").prop("id")?"pickupField":"deliveryField";$(this).is(":checked")?($(this).parents("thead").find(".onFile").prop("checked",!1),$(this).parents("fieldset").find(".clientList").each(function(){$(this).prop("disabled",!1).prop("required",!0).show()}).end().find(".clientSelect").each(function(){$(this).prop("disabled",!0).hide()}),$(this).parents("fieldset").find(".clientList").each(function(){$(this).prop("required",!1).prop("readonly",!0)}),$("#"+S+" .me").prop("disabled",!0),$(this).parents("fieldset").find("[id$='Client']").val(ClientName).end().find("[id$='Department']").val(Department).end().find("[id$='Address1']").val(ShippingAddress1).end().find("[id$='Address2']").val(ShippingAddress2)):($(this).parents("fieldset").find(".clientList").prop("readonly",!1),$("#"+S+" .me").prop("disabled",!1))}).change(),$(document).on("click",".onFile",function(){if(0===$(".clientSelect:first").children().length)return $(this).prop("title","No Locations On File"),!1}),$(document).on("change",".clientSelect",function(){let S=$(this).children("option").filter(":selected").attr("data-value");$(this).parents("fieldset").find(".clientSelect").each(function(){$(this).children().each(function(){$(this).attr("data-value")===S&&$(this).prop("selected",!0)})})}).change(),$(document).on("change",".onFile",function(){$(this).is(":checked")?($(this).parents("thead").find(".me").prop("checked",!1),$(this).parents("fieldset").find(".clientList").each(function(){$(this).prop("disabled",!0).prop("required",!1).prop("readonly",!1).val("").hide()}).end().find(".clientSelect").each(function(){$(this).prop("disabled",!1).show()}),"onFileP"===$(this).attr("id")?$(this).parents("form").find("#toMe").prop("disabled",!1):$(this).parents("form").find("#fromMe").prop("disabled",!1)):$(this).parents("fieldset").find(".clientList").each(function(){$(this).prop("disabled",!1).prop("required",!0).show(),"Department"===$(this).prop("name").substr(1)&&$(this).prop("required",!1)}).end().find(".clientSelect").each(function(){$(this).prop("disabled",!0).hide()})}).change(),$(document).on("click",".cancelTransfer, .declineTransfer, .acceptTransfer",function(){let S=$(this).parents(".sortable"),W=$("#formKey").val(),_=+$(this).parents(".tickets").find(".tNum").text(),U;$(this).hasClass("cancelTransfer")?U=2:$(this).hasClass("declineTransfer")?U=3:$(this).hasClass("acceptTransfer")&&(U=4);ajax_template("POST","./deleteContractTicket.php","html",{formKey:W,ticket_index:_,TransferState:U,pendingReceiver:0,action:"transfer"}).done(Y=>{return-1===Y.indexOf("Session Error")?void(S.find(".message2").html(Y),-1===Y.indexOf("error")?("0"===S.find(".rNum").text()?refreshOnCall():refreshRoute(),setTimeout(refreshTransfers,3e3)):setTimeout(()=>{S.find(".message2").html("")},3e3)):showLogin()}).fail((Y,Z,V)=>{S.find(".message2").text(V)})}),$(document).on("click",".acceptTransferGroup, .declineTransferGroup, .cancelTransferGroup",function(){let S=$(this).parents(".sortable"),W=$("#formKey").val(),_=[],U;$(this).hasClass("cancelTransferGroup")?U=2:$(this).hasClass("declineTransferGroup")?U=3:$(this).hasClass("acceptTransferGroup")&&(U=4),$(this).parents(".sortable").find(".tickets").each(function(Y){_[Y]={ticket_index:+$(this).find(".tNum").text(),transferState:U,pendingReceiver:+$(this).find(".pendingReceiver").text(),notes:$(this).find(".notes").val(),action:"transfer"}});ajax_template("POST","./deleteContractTicket.php","html",{formKey:W,TransferState:U,multiTicket:_}).done(Y=>{return-1===Y.indexOf("Session Error")?void(-1===Y.indexOf("error")?(S.find("p.message2").text(Y),setTimeout(()=>{refreshRoute(),refreshTransfers()},3e3)):S.find("p.message2").html("<p class=\"center\">Processing Error "+Y+".</p>")):showLogin()}).fail(()=>{S.find("p.message2").text(errorThrown)})}),$(document).on("change","#enableInfoUpdate",function(){$(this).is(":checked")?$(this).parent().next("td").find(".submitInfoUpdate").prop("disabled",!1):$(this).parent().next("td").find(".submitInfoUpdate").prop("disabled",!0)}),$(document).on("change","#same",function(){$(this).is(":checked")?$("#billingName, #billingAddress1, #billingAddress2, #billingCountry").val("").prop("disabled",!0).prop("required",!1).next(".error").hide():$("#billingName, #billingAddress1, #billingAddress2, #billingCountry").prop("disabled",!1).prop("required",!0).next(".error").show()}),$(document).on("click","#clientUpdate .submitInfoUpdate",function(S){S.preventDefault();let W=$(this);W.prop("disabled",!0);let _={};$(this).parents("form").find("input").each(function(){!1===$(this).prop("disabled")&&("checkbox"===$(this).attr("type")?$(this).is(":checked")&&(_[$(this).attr("name")]=$(this).val()):_[$(this).attr("name")]=$(this).val())}),_.formKey=$("#formKey").val();ajax_template("POST","./updateClientInfo.php","text",_).done(X=>{return-1===X.indexOf("Session Error")?void($("#clientUpdateResult").html(X),setTimeout(()=>{$("#clientUpdateResult").html(""),W.prop("disabled",!1)},4e3)):showLogin()}).fail((X,Y,Z)=>{$("#clientUpdateResult").html("<span class=\"error\">Error</span>: "+Z),setTimeout(()=>{$("#clientUpdateResult").html(""),W.prop("disabled",!1)},4e3)})})});