(function(e){parser=new DOMParser,e.updateMap=({coords1:e,address1:t,coords2:r,address2:l,center:i,mapDivID:a})=>!1,"undefined"!=typeof Swipe&&(e.Swipe=new Swipe(document.querySelector("#slider"),{startSlide:0,speed:300,draggable:!1,continuous:!0,autoRestart:!1,disablescroll:!1,stopPropagation:!1,callback:function(){},transitionEnd:function(t,r){let l=["Route","On Call","Dispatch","Transfers","Ticket Entry"];document.querySelector(".menu__list__active").classList.remove("menu__list__active"),Array.from(document.querySelectorAll(".page")).forEach(e=>{if(e.id===r.id?e.classList.add("active"):e.classList.remove("active"),e.id===r.id){let t=document.querySelector("a.nav[data-id='"+e.id+"']").innerHTML.split("<");if(-1!==l.indexOf(t[0])){let e=make(["button",{type:"button"},t[0]]),r="refresh"+t[0].replace(/\s/g,"");if(e.addEventListener("click",window.rjdci[r]),clearElement(document.querySelector(".pageTitle")),document.querySelector(".pageTitle").appendChild(e),1<t.length){let e="<"+t[1]+"<"+t[2],r=parser.parseFromString(e,"text/html"),l=r.querySelector("span");l&&document.querySelector(".pageTitle").appendChild(l)}}else{let t=make(["span"]);Array.from(document.querySelector("a.nav[data-id='"+e.id+"']").childNodes).forEach(e=>{t.appendChild(e.cloneNode(!0))}),clearElement(document.querySelector(".pageTitle")),document.querySelector(".pageTitle").appendChild(t)}document.querySelector("a.nav[data-id='"+e.id+"']").parentNode.classList.add("menu__list__active")}}),scroll(0,0),document.dispatchEvent(e.pageChange)}})),e.loggedout=new Event("rjdci_loggedout"),e.loggedin=new Event("rjdci_loggedin"),e.resolutionchange=new Event("rjdci_resolutionchange"),e.loaded=new Event("rjdci_loaded"),e.pageChange=new Event("rjdci_pageChange"),e.refreshedRoute=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"route"}}),e.refreshedOnCall=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"oncall"}}),e.refreshedTransfers=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"transfers"}}),e.refreshedDispatch=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"dispatch"}}),e.refreshedTicketEntry=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"ticketEntry"}}),e.triggerEvent=(e,t)=>{if(document.createEvent){let r=document.createEvent("HTMLEvents");return r.initEvent(t,!0,!0),e.dispatchEvent(r)}return e.fireEvent?e.fireEvent("on"+t):void 0},ucfirst=e=>e.charAt(0).toUpperCase()+e.slice(1),lcfirst=e=>e.charAt(0).toLowerCase()+e.slice(1),isArray=e=>"[object Array]"===Object.prototype.toString.call(e),make=e=>{let t=e[0],r=e[1],l=document.createElement(t),a=1;if("object"==typeof r&&null!==r&&!isArray(r)){for(let e in r)l.setAttribute(e,r[e]);a=2}for(let t=a;t<e.length;t++)isArray(e[t])?l.appendChild(make(e[t])):l.appendChild(document.createTextNode(e[t]));return l},e.getSpinner=()=>make(["div",{class:"loader"},["div",{class:"face"},["div",{class:"circle"}]],["div",{class:"face"},["div",{class:"circle"}]]]),displayErrorMessage=e=>make(["p",{class:"ceneter"},["span",{class:"error"},"Error"],`: ${e.message}`]),clearElement=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},e.logout=t=>{let r=t||0,l=document.querySelector("#uid").value;return l.match(/(driver|dispatch)\d+/)?void e.fetch_template({url:"./logout",postData:{logout:1,formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")?void document.querySelector("#logoutLink").submit():(r++,e.logout(r)))).catch(()=>(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,r++,5<r?document.querySelector("#logoutLink").submit():e.logout(r))):document.querySelector("#logoutLink").submit()},e.toast=(t,r)=>{if(!t)return;isArray(t)||(t=[t]),r=r||{},r.title=r.title||"",r.time=r.time||4e3,r.eleClass=r.eleClass||"toast__msg",r.datatime=r.datatime||new Date().getTime();let l=document.querySelector(".toast__container");toastMsg=document.createElement("div"),d=new Date(+r.datatime),mins=d.getMinutes(),toastMsg.className=r.eleClass,toastMsg.title=r.title,minutes=10>mins?`0${mins.toString()}`:mins.toString(),t.push(...[`${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()]} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()]} ${d.getDate()}`,`${d.getHours()}:${minutes}`]);for(let e=0;e<t.length;e++)toastMsg.appendChild(make(["p",t[e]]));if(toastMsg.setAttribute("data-time",r.datatime),"deliveryLocation"===toastMsg.className&&toastMsg.addEventListener("click",t=>"DIV"===t.target.tagName.toUpperCase()?t.target.parentNode.removeChild(t.target):e.triggerEvent(e.getClosest(t.target,"div"),"click")),"toast__msg"!==r.eleClass){for(let e=0;e<l.children.length;e++)if(l.children[e].classList.contains(r.eleClass)){let t=l.children[e];t.parentNode.removeChild(t)}l.appendChild(toastMsg)}else l.appendChild(toastMsg);setTimeout(()=>{toastMsg.classList.contains("toast__msg")&&toastMsg.classList.add("toast__msg--hide")},r.time),setTimeout(()=>{for(let e,t=0;t<l.children.length;t++)e=l.children[t],e.classList.contains("toast__msg")&&e.parentNode.removeChild(e)},r.time+1e3)},e.getClosest=function(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),r=t.length;0<=--r&&t.item(r)!==this;);return-1<r});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null},pause=e=>new Promise(t=>setTimeout(t,e)),e.fetch_template=async({url:t,method:r="POST",headers:l={},postData:i={},retry:a=0})=>{if(!t)throw new Error("URL not defined");let o={method:r.toUpperCase(),headers:l};0<Object.keys(i).length&&(!l.hasOwnProperty("Content-Type")&&(o.headers["Content-Type"]="application/json"),o.method="POST",o.body=JSON.stringify(i));try{return await fetch(t,o)}catch(l){if(a++,20===a)throw l;return await pause(250*a),await e.fetch_template({url:t,postData:i,method:r,retry:a})}},e.showLogin=()=>{let t=document.getElementById("confirmLogin");0<t.offsetWidth&&0<t.offsetHeight||t.classList.remove("hide"),e.centerForm(t),document.dispatchEvent(e.loggedout)},e.enableApp=()=>{document.querySelector("header").classList.remove("loggedout"),document.querySelector(".menu__header").classList.remove("loggedoutHeader"),Array.from(document.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},e.disableApp=()=>{let e=document.querySelector("header"),t=document.querySelector(".menu__header");return!(void 0===e||void 0===t||e.classList.contains("loggedout"))&&void(e.classList.add("loggedout"),t.classList.add("loggedoutHeader"),Array.from(document.querySelectorAll("button")).forEach(e=>{"confirm"!==e.id&&"cancel"!==e.id&&(e.disabled=!0)}))},e.isTarget=e=>{let t=["billTo","dispatchedTo","dispatchedByUser","shippingCountry","billingCountry","pCountry","dCountry"];for(let r=0;r<t.length;r++)if(e.classList.contains(t[r]))return!0;return!1},e.disableButtonsTickets=()=>{let e=0,t=document.querySelectorAll("#ticket_query .orgMember"),r=document.querySelector("#compareMembersTickets");for(let r=0;r<t.length;r++)!0===t[r].checked&&e++;r.disabled=!(1<e&&"chart"===document.querySelector("#display").value),!0===r.disabled&&(r.checked=!1)},e.disable_scroll=()=>{window.ontouchmove=t=>t.preventDefault()},e.enable_scroll=()=>{window.ontouchmove=()=>!0},e.fixDeadRunButton=()=>{let e=document.querySelector(".cancelRun:not(.hide)");if(!e)return;let t=e.offsetHeight;Array.from(document.querySelectorAll(".deadRun")).forEach(e=>{e.innerHTML="Dead Run",e.offsetHeight>t&&(e.innerHTML="D. Run")})},e.centerForm=e=>{let t=document.body.getBoundingClientRect(),r=t.width,l=e.getBoundingClientRect(),i=l.width;e.style.left=(r-i)/2+"px"},isStopBeforeNoon=e=>{timestamp=1e3*+e.querySelector(".timing").innerText;let t=new Date(timestamp);return 12>t.getHours()},isStopAfterNoon=e=>{timestamp=1e3*+e.querySelector(".timing").innerText;let t=new Date(timestamp);return 12<=t.getHours()},sortRoute=()=>{let e,t=document.querySelector("#route"),r=document.getElementById("overnightFlag")?document.getElementById("overnightFlag").innerText:0,l=Array.from(t.querySelectorAll(".sortable")).filter(isStopBeforeNoon),i=Array.from(t.querySelectorAll(".sortable")).filter(isStopAfterNoon);l.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1),i.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1),e="1"===r?[...i,...l]:[...l,...i];let a=document.createDocumentFragment();e.forEach(e=>{a.appendChild(e)}),t.appendChild(a)},e.refreshRoute=async()=>{let t=e.getSpinner();clearElement(document.querySelector("#route")),document.querySelector("#route").appendChild(t),scrollTo(0,0),await e.fetch_template({url:"./refreshRoute.php",postData:{formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(-1!==r.indexOf("Session Error"))return document.querySelector("#function").value="refreshRoute",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==r.indexOf("error"))throw new Error(r);let l=parser.parseFromString(r,"text/html"),i=document.createDocumentFragment();Array.from(l.querySelectorAll(".sortable, .result, #overnightFlag")).forEach(e=>{i.appendChild(e)}),setTimeout(()=>{document.querySelector("#route").removeChild(t),document.querySelector("#route").appendChild(i),e.assignListeners(),e.fixDeadRunButton(),sortRoute(),document.dispatchEvent(e.refreshedRoute)},2e3)}).catch(e=>{console.error(e.message),t.parentNode.removeChild(t),document.querySelector("#route").appendChild(displayErrorMessage(e))})},countOnCallTickets=e=>{let t=Array.from(document.querySelectorAll("#on_call .tickets")).length;t>e&&(document.querySelector(".alert").classList.add("onCallAlert"),document.querySelector(".alert").innerHTML="!",document.querySelector("#newUpdate").classList.remove("hide")),0===t&&document.querySelector(".alert").classList.remove("onCallAlert");let r=document.querySelector(".alert").getAttribute("class").split(/\s+/);1===r.length&&clearElement(document.querySelector(".alert")),Array.from(document.querySelectorAll(".ticketCount")).forEach(e=>{e.innerHTML=t})},sortOnCall=()=>{let e=document.querySelector("#on_call"),t=Array.from(e.querySelectorAll(".sortable")),r=document.createDocumentFragment();t.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1),t.forEach(e=>{r.appendChild(e)}),e.appendChild(r)},e.refreshOnCall=async()=>{let t=document.querySelector(".ticketCount").innerHTML,r=e.getSpinner();clearElement(document.querySelector("#on_call")),document.querySelector("#on_call").appendChild(r),scrollTo(0,0),await e.fetch_template({url:"./refreshOnCall.php",postData:{formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(l=>{if(-1!==l.indexOf("Session Error"))return document.querySelector("#function").value="rjdci.refreshOnCall",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==l.indexOf("error"))throw new Error(l);let i=parser.parseFromString(l,"text/html"),a=document.createDocumentFragment();Array.from(i.querySelectorAll(".sortable, .result")).forEach(e=>{a.appendChild(e)}),setTimeout(()=>{document.querySelector("#on_call").removeChild(r),document.querySelector("#on_call").appendChild(a),e.assignListeners(),e.fixDeadRunButton(),sortOnCall(),countOnCallTickets(t),document.dispatchEvent(e.refreshedOnCall)},2e3)}).catch(e=>{console.error(e.message),r.parentNode.removeChild(r),document.querySelector("#on_call").appendChild(displayErrorMessage(e))})},countInitOnCall=()=>{let e=Array.from(document.querySelectorAll("#on_call .tickets")).length;Array.from(document.querySelectorAll(".ticketCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("onCallAlert"),document.querySelector(".alert").innerHTML="!")},e.refreshTicketEntry=async()=>{let t=document.querySelector("#deliveryRequest"),r=t.parentNode;target=r.querySelector(".subContainer"),localSpinner=e.getSpinner(),r.removeChild(target),r.removeChild(t),r.appendChild(localSpinner),scrollTo(0,0),await e.fetch_template({url:"./refreshTicketForm.php",postData:{edit:1,formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(-1!==t.indexOf("Session Error"))return document.querySelector("#function").value="refreshTicketForm",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==t.indexOf("error"))throw new Error(t);let l=parser.parseFromString(t,"text/html"),i=document.createDocumentFragment();Array.from(l.querySelectorAll("#deliveryRequest")).forEach(e=>{i.appendChild(e)}),setTimeout(()=>{r.removeChild(localSpinner),r.appendChild(i),r.appendChild(target),e.updateMap({mapDivID:"map"}),e.assignListeners(),document.dispatchEvent(e.refreshedTicketEntry)},2e3)}).catch(e=>{r.removeChild(localSpinner),r.appendChild(displayErrorMessage(e)),target.classList.remove("hide")})},e.countDispatch=e=>{let t=document.querySelector("#dispatch .tickets")?Array.from(document.querySelectorAll("#dispatch .tickets")).length:0,r=document.querySelector(".alert");t>e&&(r.classList.add("dispatchAlert"),r.innerHTML="!"),0===t&&r.classList.remove("dispatchAlert"),1===r.classList.length&&(r.innerHTML=""),Array.from(document.querySelectorAll(".dispatchCount")).forEach(e=>{e.innerHTML=t})},e.refreshDispatch=async()=>{let t=+document.querySelector(".dispatchCount").innerHTML-1,r=e.getSpinner();clearElement(document.querySelector("#dispatch")),document.querySelector("#dispatch").appendChild(r),scrollTo(0,0),await e.fetch_template({url:"../drivers/refreshDispatch.php",postData:{formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(l=>{if(-1!==l.indexOf("Session Error"))return document.querySelector("#function").value="refreshDispatch",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==l.indexOf("error"))throw new Error(l);let i=parser.parseFromString(l,"text/html"),a=document.createDocumentFragment();Array.from(i.querySelectorAll(".sortable, .result")).forEach(e=>{a.appendChild(e)}),setTimeout(()=>{document.querySelector("#dispatch").removeChild(r),document.querySelector("#dispatch").appendChild(a),e.assignListeners(),e.countDispatch(t),Array.from(document.querySelectorAll("#dispatch .dTicket")).forEach(t=>{t.removeEventListener("click",e.stepTicket),t.addEventListener("click",e.stepTicket)}),document.dispatchEvent(e.refreshedDispatch)},2e3)}).catch(e=>{console.error(e.message),r.parentNode.removeChild(r),document.querySelector("#dispatch").appendChild(displayErrorMessage(e))})},countInitDispatch=()=>{let e=Array.from(document.querySelectorAll("#dispatch .tickets")).length;Array.from(document.querySelectorAll(".dispatchCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("dispatchAlert"),document.querySelector(".alert").innerHTML="!")},countTransferTickets=e=>{let t=Array.from(document.querySelectorAll("#transfers .sortable")).length,r=document.querySelector(".alert");t>e&&(r.classList.add("transfersAlert"),r.innerHTML="!",document.querySelector("#newUpdate").classList.remove("hide")),0===t&&r.classList.remove("transfersAlert"),1===r.classList.length&&(r.innerHTML=""),Array.from(document.querySelectorAll(".transfersCount")).forEach(e=>{e.innerHTML=t})},e.refreshTransfers=async()=>{let t=document.querySelector(".transfersCount").innerHTML,r=e.getSpinner();clearElement(document.querySelector("#transfers")),document.querySelector("#transfers").appendChild(r),scrollTo(0,0),await e.fetch_template({url:"./refreshTransfers.php",postData:{formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(l=>{if(-1!==l.indexOf("Session Error"))return document.querySelector("#function").value="refreshTransfers",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==l.indexOf("error"))throw new Error(l);let i=parser.parseFromString(l,"text/html"),a=document.createDocumentFragment();Array.from(i.querySelectorAll(".sortable, .result")).forEach(e=>{a.appendChild(e)}),setTimeout(()=>{document.querySelector("#transfers").removeChild(r),document.querySelector("#transfers").appendChild(a),e.assignListeners(),countTransferTickets(t),document.dispatchEvent(e.refreshedTransfers)},2e3)}).catch(e=>{console.error(e.message),r.parentNode.removeChild(r),document.querySelector("#transfers").appendChild(displayErrorMessage(e))})},countInitTransfers=()=>{let e=Array.from(document.querySelectorAll("#transfers .sortable")).length;Array.from(document.querySelectorAll(".transfersCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("transfersAlert"),document.querySelector(".alert").innerHTML="!")},e.assignLinkValues=()=>{let e=document.getElementsByClassName("nav"),t=["Route","On Call","Dispatch","Transfers","Ticket Entry"];for(let r=0;r<e.length;r++)if(e[r].setAttribute("data-value",r),0==r){let l=e[r].innerHTML.split("<");if(-1!==t.indexOf(l[0])){let e=make(["button",{type:"button"},l[0]]),t="refresh"+l[0].replace(/\s/g,"");if(e.addEventListener("click",window.rjdci[t]),clearElement(document.querySelector(".pageTitle")),document.querySelector(".pageTitle").appendChild(e),1<l.length){let e="<"+l[1]+"<"+l[2],t=parser.parseFromString(e,"text/html"),r=t.querySelector("span");r&&document.querySelector(".pageTitle").appendChild(r)}}else document.querySelector(".pageTitle").innerHTML=e[r].innerHTML}},e.populatePage=async()=>{let t,r=[],l=[".sortable","#ticketEditor","#ticketEditorResultContainer","datalist","#javascriptVars","#deliveryRequest",".subContainer",".PWcontainer","#ticketQueryOptions","#ticketQueryResults","#invoiceQueryOptions","#invoiceQueryResults","#priceContainer","#clientUpdateForm",".result"],a=document.createDocumentFragment();Array.from(document.querySelectorAll(".page")).forEach(e=>{e.getAttribute("data-function")!==void 0&&""!==e.getAttribute("data-function")&&r.push(e.getAttribute("data-function"))}),await e.fetch_template({url:"./initApp.php",postData:{functions:r,formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(-1!==r.indexOf("Session Error"))return document.getElementById("function").value="rjdci.populatePage",e.showLogin();document.getElementById("formKey").value=+document.getElementById("formKey").value+1;let o;try{o=JSON.parse(r)}catch(e){throw e.message=e.message+"\n"+r,e}for(let e=0;e<o.length;e++)document.querySelectorAll(".page").forEach(r=>{if(+r.getAttribute("data-index")===e){clearElement(r),t=parser.parseFromString(o[e],"text/html"),nodeList=t.querySelectorAll(l.toString());for(node of nodeList)a.appendChild(node);r.appendChild(a),clearElement(a)}});scrollTo(0,0),null!==document.getElementById("route")&&sortRoute(),null!==document.getElementById("on_call")&&(sortOnCall(),countInitOnCall()),null!==document.getElementsByClassName("deadRun")&&e.fixDeadRunButton(),null!==document.getElementById("dispatch")&&countInitDispatch(),null!==document.getElementById("transfers")&&countInitTransfers()}).catch(e=>{Array.from(document.querySelectorAll(".page")).forEach(t=>{t.innerHTML="",t.appendChild(displayErrorMessage(e))})})},e.deliveryLocation=({ticket_index:t=[],step:r=[]})=>{if("undefined"==typeof navigator.permissions||"undefined"==typeof navigator.geolocation)return e.toast("Location Not Available");let l=0,i=0,a=5,o=null,n=!1,c={};c.title="Updating Location",c.eleClass="deliveryLocation",e.toast(["Updating Location","Do not","disable screen"],c),navigator.permissions.query({name:"geolocation"}).then(s=>{let u={enableHighAccuracy:!0,timeout:25e3,maximumAge:0},y=e=>{if(l++,n=1<l?n&&n.coords.accuracy<e.coords.accuracy?n:e:e,l>a||2<l&&n.coords.accuracy<10)return navigator.geolocation.clearWatch(o),p(n)},m=t=>{if(i++,e.toast(["Location Not Available",t.message,"Tap to dismiss"],c),l>a||i>a)return navigator.geolocation.clearWatch(o),p(n)},p=async l=>{if(!l)return e.toast(["Location Not Available","Tap to dismiss"],c);if(t.length!==r.length||0===t.length)return e.toast(["Location Data Error","Tap to dismiss"],c);let i={},a={};i.formKey=document.querySelector("#formKey").value,1<t.length?(i.multiTicket=[],t.forEach((e,t)=>{a.ticket_index=e,a[r[t]+"Lat"]=l.coords.latitude,a[r[t]+"Lng"]=l.coords.longitude,i.multiTicket[t]=a,a={}})):(i.ticket_index=t[0],i[r[0]+"Lat"]=l.coords.latitude,i[r[0]+"Lng"]=l.coords.longitude),await e.fetch_template({url:"./updateTicket.php",postData:i}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==t.indexOf("error"))throw new Error(t);return e.toast(["Location Updated","Tap to dismiss"],c)}).catch(t=>(console.error(t.message),e.toast([t.message,"Tap to dismiss"],c)))};if("granted"==s.state)o=navigator.geolocation.watchPosition(y,m,u);else if("prompt"==s.state)navigator.geolocation.getCurrentPosition(()=>{});else if("denied"==s.state)return!1;s.onchange=()=>{if("granted"===s.state)o=navigator.geolocation.watchPosition(y,m,u);else{if("prompt"==s.state)return!1;if("denied"==s.state)return!1}}})},getCancelThis=()=>{let t=make(["button",{type:"button",class:"cancelThis"},"Go Back"]);return t.addEventListener("click",e.cancelThis),t},e.cancelThis=t=>{let r=e.getClosest(t.target,".sortable");Array.from(r.querySelectorAll("button")).forEach(e=>{e.disabled=!1}),t.target.parentNode.innerHTML=""},getStepTicket=t=>{let r=make(["button",{type:"button",class:"stepTicket",form:t},"Confirm"]);return r.addEventListener("click",e.stepTicket),r},e.stepTicket=async t=>{t.preventDefault();let r,l={},i=!1,a=e.getClosest(t.target,".message2"),o=e.getClosest(t.target,".page").getAttribute("id"),n=make(["span",{class:"ellipsis"},"."]);if(null===a&&(a=e.getClosest(t.target,"form").querySelector(".message2")),Array.from(document.querySelectorAll("input[form="+t.target.getAttribute("form")+"], textarea[form="+t.target.getAttribute("form")+"]")).forEach(e=>{"latitude"!==e.getAttribute("name")&&"longitude"!==e.getAttribute("name")&&(!0===e.required&&""===e.value&&(i=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),l[e.getAttribute("name")]=e.value)}),l.formKey=document.querySelector("#formKey").value,i)return;a.innerHTML="",a.appendChild(n);let c=!0,s=setInterval(()=>{!0===c&&(n.innerHTML+="..",c=21>n.innerHTML.length&&1!=n.innerHTML.length),!1===c&&(n.innerHTML=n.innerHTML.substr(0,n.innerHTML.length-2),c=1===n.innerHTML.length)},500);switch(l.hasOwnProperty("pSigPrint")&&(l.printName=l.pSigPrint,delete l.pSigPrint),l.hasOwnProperty("dSigPrint")&&(l.printName=l.dSigPrint,delete l.dSigPrint),l.hasOwnProperty("d2SigPrint")&&(l.printName=l.d2SigPrint,delete l.d2SigPrint),document.querySelector(".step[form=\""+t.target.getAttribute("form")+"\"]").value){case"pickedUp":r="p";break;case"delivered":r="d";break;case"returned":r="d2";}r&&e.deliveryLocation({ticket_index:[l.ticket_index],step:[r]}),await e.fetch_template({url:"../drivers/updateStep.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(s),a.removeChild(n),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")){let r=parser.parseFromString(t,"text/html"),l=document.createDocumentFragment();Array.from(r.querySelectorAll(".result")).forEach(e=>{l.appendChild(e)}),a.appendChild(l),setTimeout(()=>{"route"===o?e.refreshRoute():"on_call"===o?e.refreshOnCall():"dispatch"===o?e.refreshDispatch():void 0},3e3)}else throw new Error(t)}).catch(t=>{console.error(t.message),clearInterval(s),a.removeChild(n),a.appendChild(displayErrorMessage(t)),setTimeout(()=>{a.innerHTML="",Array.from(e.getClosest(a,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getStepAll=()=>{let t=make(["button",{type:"button",class:"stepAll"},"Confirm"]);return t.addEventListener("click",e.stepAll),t},e.stepAll=async t=>{t.preventDefault();let r={},l=[],i={},a={step:[],ticket_index:[]},o=e.getClosest(t.target,".sortable"),n=o.querySelectorAll(".message2"),c=n[n.length-1],s=make(["span",{class:"ellipsis"},"."]),u=o.querySelector(".printName");if(!0===u.required&&""===u.value)return u.classList.add("elementError"),setTimeout(()=>{u.classList.remove("elementError")},3e3),!1;c.innerHTML="",c.appendChild(s);let y=!0,m=setInterval(()=>{!0===y&&(s.innerHTML+="..",y=21>s.innerHTML.length&&1!=s.innerHTML.length),!1===y&&(s.innerHTML=s.innerHTML.substr(0,s.innerHTML.length-2),y=1===s.innerHTML.length)},500);Array.from(o.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{if("latitude"!==e.getAttribute("name")&&"longitude"!==e.getAttribute("name")&&(i[e.getAttribute("name")]=e.value),"step"===e.getAttribute("name"))switch(e.value){case"pickedUp":a.step.push("p");break;case"delivered":a.step.push("d");break;case"returned":a.step.push("d2");}"ticket_index"===e.getAttribute("name")&&a.ticket_index.push(e.value)}),l[t]=i,i={}}),r.multiTicket=l,r.formKey=document.querySelector("#formKey").value,r.printName=u.value,r.sigImage=o.querySelector(".sigImage").value,e.deliveryLocation(a),await e.fetch_template({url:"./updateStep.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(m),c.removeChild(s),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")){let r=parser.parseFromString(t,"text/html"),l=document.createDocumentFragment();Array.from(r.querySelectorAll(".result")).forEach(e=>{l.appendChild(e)}),c.appendChild(l),setTimeout(e.refreshRoute,3e3)}else throw new Error(t)}).catch(t=>{console.error(t.message),clearInterval(m),c.removeChild(s),c.appendChild(displayErrorMessage(t)),setTimeout(()=>{c.innerHTML="",Array.from(e.getClosest(c,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getCancelTicket=(t,r)=>{let l=make(["button",{type:"button",class:`confirm${r}`,form:t},"Confirm"]);return l.addEventListener("click",e.confirmCancel),l},e.confirmCancel=async t=>{t.preventDefault();let r,l={},i=["ticket_index","notes","ticketBase","ticketNumber"],a=e.getClosest(t.target,".message2"),o=make(["span",{class:"ellipsis"},"."]);a.innerHTML="",a.appendChild(o);let n=!0,c=setInterval(()=>{!0===n&&(o.innerHTML+="..",n=21>o.innerHTML.length&&1!=o.innerHTML.length),!1===n&&(o.innerHTML=o.innerHTML.substr(0,o.innerHTML.length-2),n=1===o.innerHTML.length)},500);switch(Array.from(document.querySelectorAll("input[form="+t.target.getAttribute("form")+"], textarea[form="+t.target.getAttribute("form")+"]")).forEach(e=>{-1!==i.indexOf(e.getAttribute("name"))&&(l[e.getAttribute("name")]=e.value)}),t.target.getAttribute("class")){case"confirmDelete":l.action="delete";break;case"confirmCancelRun":l.action="cancel";break;case"confirmDeadRun":l.action="deadRun",r="p";break;case"confirmDeclined":l.action="declined",r="d";}l.formKey=document.querySelector("#formKey").value,r&&e.deliveryLocation({ticket_index:[l.ticket_index],step:[r]}),await e.fetch_template({url:"./deleteContractTicket.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(c),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")){a.removeChild(o);let r=parser.parseFromString(t,"text/html"),l=document.createDocumentFragment();Array.from(r.querySelectorAll(".result")).forEach(e=>{l.appendChild(e)}),a.appendChild(l),setTimeout(async()=>{switch(e.getClosest(a,".page").getAttribute("id")){case"route":return await e.refreshRoute();case"on_call":return await e.refreshOnCall();}},3e3)}else throw new Error(t)}).catch(t=>{console.error(t.message),clearInterval(c),a.removeChild(o),a.appendChild(displayErrorMessage(t)),setTimeout(()=>{a.innerHTML="",Array.from(e.getClosest(a,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferTicket=()=>{let t=make(["button",{type:"button",class:"confirmTransfer"},"Confirm"]);return t.addEventListener("click",e.transferTicket),t},e.transferTicket=async t=>{t.preventDefault();let r={},l=e.getClosest(t.target,".message2"),i=e.getClosest(t.target,".tickets"),a=e.getClosest(t.target,".page").getAttribute("id"),o=make(["span",{class:"ellipsis"},"."]);if(r.pendingReceiver=l.querySelector(".pendingReceiver").value,!r.pendingReceiver)return l.querySelector(".pendingReceiver").classList.add("elementError"),setTimeout(()=>{l.querySelector(".pendingReceiver").classList.remove("elementError"),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3e3),!1;l.innerHTML="",l.appendChild(o);let n=!0,c=setInterval(()=>{!0===n&&(o.innerHTML+="..",n=21>o.innerHTML.length&&1!=o.innerHTML.length),!1===n&&(o.innerHTML=o.innerHTML.substr(0,o.innerHTML.length-2),n=1===o.innerHTML.length)},500);r.ticket_index=i.querySelector(".ticket_index").value,r.transfers=i.querySelector(".transfers").value,r.notes=i.querySelector(".notes").value,r.action="transfer",r.formKey=document.querySelector("#formKey").value,r.TransferState=1,await e.fetch_template({url:"./deleteContractTicket.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(c),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")){l.removeChild(o);let e=parser.parseFromString(t,"text/html"),r=document.createDocumentFragment();Array.from(e.querySelectorAll(".result")).forEach(e=>{r.appendChild(e)}),l.appendChild(r)}else throw new Error(t)}).then(async()=>await e.refreshTransfers()).then(async()=>"route"===a?await e.refreshRoute():"on_call"===a?await e.refreshOnCall():void 0).catch(t=>{console.error(t.message),clearInterval(c),l.removeChild(o),l.appendChild(displayErrorMessage(t)),setTimeout(()=>{l.innerHTML="",Array.from(e.getClosest(l,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferGroup=()=>{let t=make(["button",{type:"button",class:"confirmAcceptTransferGroup"},"Confirm"]);return t.addEventListener("click",e.transferGroup),t},e.transferGroup=async t=>{let r=[],l={},i={},a=e.getClosest(t.target,".sortable"),o=a.querySelectorAll(".message2"),n=o[o.length-1],c=make(["span",{class:"ellipsis"},"."]);if(pendingReceiver=n.querySelector(".pendingReceiver").value,!pendingReceiver)return n.querySelector(".pendingReceiver").classList.add("elementError"),setTimeout(()=>{n.querySelector(".pendingReceiver").classList.remove("elementError"),Array.from(n.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3e3),!1;n.innerHTML="",n.appendChild(c);let s=!0,u=setInterval(()=>{!0===s&&(c.innerHTML+="..",s=21>c.innerHTML.length&&1!=c.innerHTML.length),!1===s&&(c.innerHTML=c.innerHTML.substr(0,c.innerHTML.length-2),s=1===c.innerHTML.length)},500);Array.from(a.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{l[e.getAttribute("name")]=e.value}),l.pendingReceiver=pendingReceiver,l.transferState=1,r[t]=l,l={}}),i.multiTicket=r,i.TransferState=1,i.action="transfer",i.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./deleteContractTicket.php",postData:i}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(u),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")){n.removeChild(c);let e=parser.parseFromString(t,"text/html"),r=document.createDocumentFragment();Array.from(e.querySelectorAll(".result")).forEach(e=>{r.appendChild(e)}),n.appendChild(r)}else throw new Error(t)}).then(async()=>await e.refreshTransfers()).then(async()=>await e.refreshRoute()).catch(t=>{console.error(t.message),clearInterval(u),n.removeChild(c),n.appendChild(displayErrorMessage(t)),setTimeout(()=>{n.innerHTML="",Array.from(e.getClosest(n,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferButton=t=>{let r=make(["button",{type:"button",class:`confirm${ucfirst(t)}`},"Confirm"]);return r.addEventListener("click",e.processTransfer),r},e.processTransfer=async t=>{let r,l=["confirmCancelTransfer","confirmDeclineTransfer","confirmAcceptTransfer"],i={},a=e.getClosest(t.target,".message2"),o=e.getClosest(t.target,".tickets"),n=make(["span",{class:"ellipsis"},"."]);Array.from(o.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),a.innerHTML="",a.appendChild(n);let c=!0,s=setInterval(()=>{!0===c&&(n.innerHTML+="..",c=21>n.innerHTML.length&&1!=n.innerHTML.length),!1===c&&(n.innerHTML=n.innerHTML.substr(0,n.innerHTML.length-2),c=1===n.innerHTML.length)},500);i.formKey=document.querySelector("#formKey").value,i.action="transfer",i.pendingReceiver=0,Array.from(o.querySelectorAll("input, textarea")).forEach(e=>{i[e.getAttribute("name")]=e.value});for(let e=0;e<t.target.classList.length;e++)if(l.indexOf(-1!==t.target.classList[e])){r=t.target.classList[e];break}"confirmCancelTransfer"===r?i.TransferState=2:"confirmDeclineTransfer"===r?i.TransferState=3:"confirmAcceptTransfer"===r?i.TransferState=4:void 0;await e.fetch_template({url:"./deleteContractTicket.php",postData:i}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(s),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")){a.removeChild(n);let e=parser.parseFromString(t,"text/html"),r=document.createDocumentFragment();Array.from(e.querySelectorAll(".result")).forEach(e=>{r.appendChild(e)}),a.appendChild(r)}else throw new Error(t)}).then(async()=>"0"===o.querySelector(".rNum").innerText?await e.refreshOnCall():await e.refreshRoute()).then(async()=>await e.refreshTransfers()).catch(e=>{console.error(e.message),clearInterval(s),a.removeChild(n),a.appendChild(displayErrorMessage(e)),setTimeout(()=>{a.innerHTML="",Array.from(o.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferAllButton=t=>{let r=make(["button",{type:"button",class:`confirm${ucfirst(t)}`},"Confirm"]);return r.addEventListener("click",e.processTransferAll),r},e.processTransferAll=async t=>{let r,l,a=["confirmCancelTransferGroup","confirmDeclineTransferGroup","confirmAcceptTransferGroup"],o={},n={},c=e.getClosest(t.target,".sortable"),s=c.querySelectorAll(".message2"),u=s[s.length-1],y=make(["span",{class:"ellipsis"},"."]);n.multiTicket=[],n.formKey=document.querySelector("#formKey").value,u.innerHTML="",u.appendChild(y);let m=!0,p=setInterval(()=>{!0===m&&(y.innerHTML+="..",m=21>y.innerHTML.length&&1!=y.innerHTML.length),!1===m&&(y.innerHTML=y.innerHTML.substr(0,y.innerHTML.length-2),m=1===y.innerHTML.length)},500);for(let e=0;e<t.target.classList.length;e++)if(a.indexOf(-1!==t.target.classList[e])){l=t.target.classList[e];break}"confirmCancelTransferGroup"===l?r=2:"confirmDeclineTransferGroup"===l?r=3:"confirmAcceptTransferGroup"===l?r=4:void 0;n.TransferState=r,Array.from(c.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{o[e.getAttribute("name")]=e.value}),o.transferState=r,o.action="transfer",n.multiTicket[t]=o,o={}}),await e.fetch_template({url:"./deleteContractTicket.php",postData:n}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(p),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")){u.removeChild(y);let e=parser.parseFromString(t,"text/html"),r=document.createDocumentFragment();Array.from(e.querySelectorAll(".result")).forEach(e=>{r.appendChild(e)}),u.appendChild(r)}else throw new Error(t)}).then(async()=>await e.refreshRoute()).then(async()=>await e.refreshTransfers()).catch(e=>{console.error(e.message),clearInterval(p),u.removeChild(y),u.appendChild(displayErrorMessage(e)),setTimeout(()=>{u.innerHTML="",Array.from(c.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},e.assignListeners=()=>{if(document.querySelector("#deliveryRequest")&&(assignTicketFormListeners(e.getClosest(document.querySelector("#deliveryRequest"),".page")),document.querySelector("#switchTerms").addEventListener("click",()=>{document.querySelector("#deliveryTerms").style.display="none"==document.querySelector("#deliveryTerms").style.display?"block":"none"})),document.querySelector("form[id^='dispatchForm']")&&Array.from(document.querySelectorAll("form[id^='dispatchForm'] .stepTicket")).forEach(t=>{t.removeEventListener("click",e.stepTicket),t.addEventListener("click",e.stepTicket)}),colorChange=e=>{e.target.classList.add("red"),setTimeout(()=>{e.target.classList.remove("red")},3e3)},Array.from(document.querySelectorAll("button")).forEach(e=>{e.addEventListener("click",colorChange)}),updateNotes=async t=>{let r=e.getClosest(t.target,".tickets").querySelector(".message2");postData={},postData.ticket_index=document.querySelector(".ticket_index[form='"+t.target.getAttribute("form")+"']").value,postData.notes=document.querySelector(".notes[form='"+t.target.getAttribute("form")+"']").value,postData.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./updateTicket.php",postData:postData}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")){let e=parser.parseFromString(t,"text/html");r.appendChild(e.querySelector(".result")),setTimeout(()=>{r.innerHTML=""},3500)}else throw new Error(t)}).catch(e=>{console.error(e.message),r.appendChild(displayErrorMessage(e)),setTimeout(()=>{r.innerHTML=""},5e3)})},Array.from(document.querySelectorAll(".updateNotes")).forEach(e=>{e.removeEventListener("click",updateNotes),e.addEventListener("click",updateNotes)}),Array.from(document.querySelectorAll(".dTicket")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r=e.getClosest(t.target,".page"),l=e.getClosest(t.target,".tickets"),i=l.querySelector(".message2");Array.from(r.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),i.appendChild(make(["p",`Confirm ${t.target.innerText}`])),i.appendChild(getStepTicket(t.target.getAttribute("form"))),i.appendChild(getCancelThis())})}),Array.from(document.querySelectorAll(".confirmAll")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r=e.getClosest(t.target,".page"),l=e.getClosest(t.target,".sortable"),i=l.querySelectorAll(".message2"),a=i[i.length-1];Array.from(r.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),a.appendChild(make(["p","Confirm Group Update"])),a.appendChild(getStepAll()),a.appendChild(getCancelThis())})}),Array.from(document.querySelectorAll(".cancelRun, .deadRun, .declined")).forEach(t=>{t.addEventListener("click",t=>{let r,l=["cancelRun","deadRun","declined"],i=e.getClosest(t.target,".page"),a=e.getClosest(t.target,".tickets"),o=a.querySelector(".message2"),n=t.target.getAttribute("form");Array.from(i.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(a.querySelectorAll("button")).forEach(e=>{e.disabled=!0});for(let e=0;e<l.length;e++)if(t.target.classList.contains(l[e])){r=ucfirst(l[e]);break}o.appendChild(make(["p",`Confirm ${t.target.innerText}`])),o.appendChild(getCancelTicket(n,r)),o.appendChild(getCancelThis())})}),Array.from(document.querySelectorAll(".transferTicket")).forEach(t=>{t.addEventListener("click",t=>{let r=e.getClosest(t.target,".page"),l=e.getClosest(t.target,".tickets"),i=l.querySelector(".message2");Array.from(r.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),i.appendChild(make(["p",`Confirm ${t.target.innerText}`])),i.appendChild(getTransferTicket()),i.appendChild(make(["input",{name:"pendingReceiver",class:"pendingReceiver",list:"receivers"}])),i.appendChild(getCancelThis())})}),Array.from(document.querySelectorAll(".transferGroup")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r=e.getClosest(t.target,".page"),l=e.getClosest(t.target,".sortable"),i=l.querySelectorAll(".message2"),a=i[i.length-1];Array.from(r.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),a.appendChild(make(["p","Confirm Transfer"])),a.appendChild(getTransferGroup()),a.appendChild(make(["input",{name:"pendingReceiver",class:"pendingReceiver",list:"receivers"}])),a.appendChild(getCancelThis())})}),Array.from(document.querySelectorAll(".cancelTransfer, .declineTransfer, .acceptTransfer")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r,l=["cancelTransfer","declineTransfer","acceptTransfer"],i=e.getClosest(t.target,".page"),a=e.getClosest(t.target,".tickets"),o=a.querySelector(".message2");Array.from(i.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(a.querySelectorAll("button")).forEach(e=>{e.disabled=!0});for(let e=0;e<l.length;e++)if(t.target.classList.contains(l[e])){r=ucfirst(t.target.classList[e]);break}o.appendChild(make(["p",`Confirm ${t.target.innerText}`])),o.appendChild(getTransferButton(r)),o.appendChild(getCancelThis())})}),Array.from(document.querySelectorAll(".acceptTransferGroup, .declineTransferGroup, .cancelTransferGroup")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r,l=["acceptTransferGroup","declineTransferGroup","cancelTransferGroup"],i=e.getClosest(t.target,".page"),a=e.getClosest(t.target,".sortable"),o=a.querySelectorAll(".message2"),n=o[o.length-1];Array.from(i.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")}),Array.from(a.querySelectorAll("button")).forEach(e=>{e.disabled=!0});for(let e=0;e<l.length;e++)if(t.target.classList.contains(l[e])){r=ucfirst(l[e]);break}n.appendChild(make(["p",`Confirm ${t.target.innerText}`])),n.appendChild(getTransferAllButton(r)),n.appendChild(getCancelThis())})}),document.querySelector("#ticketEditorSubmit")&&(document.querySelector("#ticketEditorSubmit").addEventListener("click",async t=>{t.preventDefault();let r=document.querySelector("#ticketEditorResultContainer"),l={},i=document.querySelector("#ticketEditor"),a=make(["span",{class:"ellipsis"},"."]);if(Array.from(i.querySelectorAll("input[name], select")).forEach(e=>{l[e.getAttribute("name")]=e.value}),l.formKey=document.querySelector("#formKey").value,!l.dispatchedTo||!l.ticketEditorSearchDate)return!1;r.innerHTML="",r.appendChild(a);let o=!0,n=setInterval(()=>{!0===o&&(a.innerHTML+="..",o=21>a.innerHTML.length&&1!=a.innerHTML.length),!1===o&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-2),o=1===a.innerHTML.length)},500);await e.fetch_template({url:"./activeTickets.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(n),r.removeChild(a),-1!==t.indexOf("Session Error"))return r.appendChild(make(["p",{class:"center"},"Select Driver &amp; Ticket Type"])),e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=parser.parseFromString(t,"text/html"),i=document.createDocumentFragment();Array.from(l.querySelectorAll(".tickets")).forEach(e=>{i.appendChild(e)}),r.appendChild(i),assignTicketEditorListener()}).catch(e=>{console.error(e.message),clearInterval(n),r.removeChild(a),r.appendChild(displayErrorMessage(e)),setTimeout(()=>{element.innerHTML="Select Driver &amp; Ticket Type"},3500)})}),document.querySelector("#clearTicketEditorResults").addEventListener("click",e=>{e.preventDefault();let t=document.querySelector("#ticketEditor"),r=new Date,l=10>r.getDate()?`0${r.getDate()}`:r.getDate(),i=r.getMonth()+1,a=10>i?`0${i}`:i;for(container=document.querySelector("#ticketEditorResultContainer"),t.querySelector(".dispatchedTo").value="",t.querySelector(".contract").value=0,t.querySelector("input.ticketEditorSearchDate").value=`${r.getFullYear()}-${a}-${l}`;container.firstChild;)container.removeChild(container.firstChild);container.appendChild(make(["p",{class:"center"},"Select Driver &amp; Ticket Type"]))})),document.querySelector("form#priceCalc")){let t=document.querySelector("form#priceCalc");t.querySelector(".dryIce").addEventListener("change",t=>{let r=e.getClosest(t.target,"td");t.target.checked?(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!1,r.querySelector(".diWeight").focus()):(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!0)}),Array.from(t.querySelectorAll("input[list]")).forEach(t=>{"Address1"===t.getAttribute("name").substr(1)&&t.addEventListener("blur",t=>{let r;Array.from(document.querySelectorAll("#addy1 option")).forEach(e=>{e.value===t.target.value&&(r=e.getAttribute("data-value"))}),"undefined"==typeof r||Array.from(document.querySelectorAll("#addy2 option")).forEach(l=>{l.getAttribute("data-value")===r&&(e.getClosest(t.target,"fieldset").querySelector("input[name='"+t.target.getAttribute("name").slice(0,-1)+"2']").value=l.value)})})}),t.querySelector(".clear").addEventListener("click",()=>{t.querySelector(".dryIce").checked=!1,e.triggerEvent(t.querySelector(".dryIce"),"change"),document.querySelector("#CalcCharge").value="0",Array.from(document.querySelectorAll("#pNotice, #dNotice, #rangeResult, #diWeightResult, #diPriceResult, #runPriceResult, #ticketPriceResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.style.display="none"}),Array.from(document.querySelectorAll("#price_calculator .elementError")).forEach(e=>e.classList.remove("elementError")),e.updateMap({mapDivID:"map2"})}),t.querySelector(".submitPriceQuery").addEventListener("click",async r=>{r.preventDefault(),Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let l=!1,i={},a=make(["span",{class:"ellipsis"},"."]);if(i.formKey=document.querySelector("#formKey").value,Array.from(t.querySelectorAll("input[name]")).forEach(e=>{e.getAttribute("list")&&!1===e.disabled&&""===e.value?(l=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3500)):!1===e.disabled&&"checkbox"!==e.type&&(i[e.getAttribute("name")]=e.value),"checkbox"===e.type&&(i[e.getAttribute("name")]=e.checked?1:0)}),1===i.dryIce&&("0"===i.diWeight||0!=i.diWeight%t.querySelector(".diWeight").getAttribute("step"))&&(l=!0,t.querySelector(".diWeight").classList.add("elementError"),t.querySelector(".ticketError").innerHTML="Dry Ice must be in increments of "+t.querySelector(".diWeight").getAttribute("step")),l)return setTimeout(()=>{Array.from(t.querySelectorAll("button, .elementError")).forEach(e=>{e.disabled=!1,e.classList.remove("elementError")}),t.querySelector(".ticketError").innerHTML=""},3500),!1;t.querySellipsisctor(".ticketError").innerHTML="",t.querySellipsisctor(".ticketError").appendChild(a);let o=!0,n=setInterval(()=>{!0===o&&(a.innerHTML+="..",o=21>a.innerHTML.length&&1!=a.innerHTML.length),!1===o&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-2),o=1===a.innerHTML.length)},500);await e.fetch_template({url:"../priceCalc.php",postData:i}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(clearInterval(n),t.querySelector(".ticketError").removeChild(a),-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,Array.from(document.querySelectorAll("#pNotice, #dNotice, #CalcError")).forEach(e=>{e.innerHTML=""});let l;try{l=JSON.parse(r)}catch(e){return document.querySelector("#CalcError").appendChild(displayErrorMessage(e)),setTimeout(()=>{document.querySelector("#CalcError").innerText=""},3500),!1}Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.remove("hide")}),document.querySelector("#rangeResult").innerText=l.rangeDisplay,document.querySelector("#diWeightResult").innerText=l.diWeight,document.querySelector("#runPriceResult").innerText=l.runPrice,document.querySelector("#diPriceResult").innerText=l.diPrice,document.querySelector("#ticketPriceResult").innerText=l.ticketPrice,15<l.pRangeTest&&20>l.pRangeTest?document.querySelector("#pNotice").innerText="Pick Up address is outside of our standard range. Please call to confirm availability.":20<l.pRangeTest&&(document.querySelector("#pNotice").innerText="Pick Up address is outside of our extended range.",Array.from(document.querySelectorAll("#runPriceResult, #ticketPriceResult, #diPriceResult, #diWeightResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.add("hide")})),15<l.dRangeTest&&20>l.dRangeTest?document.querySelector("#dNotice").innerText="Delivery address is outside of our standard range. Please call to confirm availability.":20<l.dRangeTest&&(document.querySelector("#dNotice").innerText="Delivery address is outside of our extended range.",Array.from(document.querySelectorAll("#runPriceResult, #ticketPriceResult, #diPriceResult, #diWeightResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.add("hide")})),Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!1}),e.updateMap({mapDivID:"map2",coords1:l.result1,address1:l.address1,coords2:l.result2,address2:l.address2,center:l.center})}).catch(e=>{console.error(e.message),clearInterval(n),a.parentNode.removeChild(a),t.querySelector(".ticketError").appendChild(displayErrorMessage(e)),setTimeout(()=>{t.querySelector(".ticketError").innerHTML="",Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3500)})})}document.querySelector(".PWcontainer")&&(document.querySelector(".PWcontainer .showText").addEventListener("change",t=>{Array.from(e.getClosest(t.target,"form").querySelectorAll("input.currentPw, .newPw1, .newPw2")).forEach(e=>{e.type=t.target.checked?"text":"password"})}),document.querySelector(".clearPWform").addEventListener("click",t=>{e.getClosest(t.target,"form").querySelector(".showText").checked=!1,e.triggerEvent(e.getClosest(t.target,"form").querySelector(".showText"),"change")}),Array.from(document.querySelectorAll(".newPw1, .newPw2, .currentPw")).forEach(t=>{t.addEventListener("change",t=>{let r=e.getClosest(t.target,".PWform"),l=r.querySelector(".PWsubmit"),i=r.querySelector(".currentPw").value,a=r.querySelector(".newPw1").value,o=r.querySelector(".newPw2").value,n=make(["p",{class:"error1"},["span",{class:"error"},"Error"],": Password does not meet criteria."]),c=make(["p",{class:"error1"},["span",{class:"error"},"Error"],": Password missmatch."]),s=make(["p",{class:"error1"},["span",{class:"error"},"Error"],": Password should be changed."]);if(""!==a){if(!!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^\&*\)\(\{\}\[\]\-_.=+\?\:;,])(?=.{8,}).*$/.test(a))null!==r.querySelector(".message .error1")&&r.querySelector(".message").removeChild(r.querySelector(".message .error1")),null===r.querySelector(".message p")&&(l.disabled=!1);else if(null!==r.querySelector(".message .error1"))return r.querySelector(".message").appendChild(n),l.disabled=!0,!1;""!==i&&a===i?null===r.querySelector(".message .error3")&&(r.querySelector(".message").appendChild(s),l.disabled=!0):(null!==r.querySelector(".message .error3")&&r.querySelector(".message").removeChild(r.querySelector(".message .error3")),null===r.querySelector(".message p")&&(l.disabled=!1))}else null!==r.querySelector(".message .error1")&&r.querySelector(".message").removeChild(r.querySelector(".message .error1")),null===r.querySelector(".message p")&&(l.disabled=!1);""===o?(null!==r.querySelector(".message .error2")&&r.querySelector(".message").removeChild(r.querySelector(".message .error2")),null===r.querySelector(".message p")&&(l.disabled=!1)):a===o?(null!==r.querySelector(".message .error2")&&r.querySelector(".message").removeChild(r.querySelector(".message .error2")),null===r.querySelector(".message p")&&(l.disabled=!1)):(null===r.querySelector(".message .error2")&&r.querySelector(".message").appendChild(c),l.disabled=!0)})}),Array.from(document.querySelectorAll(".PWsubmit")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r=e.getClosest(t.target,".PWform"),l={},i=make(["span",{class:"ellipsis"},"."]);r.querySellipsisctor(".message").innerHTML="",r.querySellipsisctor(".message").appendChild(i);let a=!0,o=setInterval(()=>{!0===a&&(i.innerHTML+="..",a=21>i.innerHTML.length&&1!=i.innerHTML.length),!1===a&&(i.innerHTML=i.innerHTML.substr(0,i.innerHTML.length-2),a=1===i.innerHTML.length)},500);l.formKey=document.querySelector("#formKey").value,Array.from(r.querySelectorAll("input[name]")).forEach(e=>{l[e.getAttribute("name")]=e.value}),await e.fetch_template({url:"./changePW.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(a=>{if(clearInterval(o),i.parentNode.removeChild(i),-1!==a.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let n=parser.parseFromString(a,"text/html"),c=document.createDocumentFragment();Array.from(c.querySelectorAll(".result")).forEach(e=>{c.appendChild(e)}),r.querySelector(".message").appendChild(c),setTimeout(()=>{if(Array.from(r.querySelectorAll(".currentPw, .newPw1, .newPw2")).forEach(e=>{e.value=""}),r.querySelector(".message").innerHTML="",r.querySelector(".currentPw").focus(),t.target.disabled=!1,"driver"!==l.flag&&"dispatch"!==l.flag){let r,i=e.getClosest(t.target,".page"),o=!1;switch(l.flag){case"daily":r=document.querySelector("a[data-id='change_password']"),o="!Delivery1"===l.newPw1;break;case"admin":r=document.querySelector("a[data-id='change_admin_password']"),o="!Delivery2"===l.newPw1;break;case"org":r=document.querySelector("a[data-id='change_password']"),o="3Delivery!"===l.newPw1;}-1!==a.search("Password Updated")&&(!0===o?(i.querySelector(".defaultWarning").classList.remove("hide"),r.querySelector(".PWalert").innerText="!"):(!i.querySelector(".defaultWarning").classList.contains("hide")&&i.querySelector(".defaultWarning").classList.add("hide"),r.querySelector(".PWalert").innerText=""))}},4e3)}).catch(e=>{console.error(e.message),clearInterval(o),i.parentNode.removeChild(i),r.querySelector(".message").appendChild(displayErrorMessage(e)),setTimeout(()=>{r.querySelector(".message").innerHTML="",t.target.disabled=!1},3500)})})})),document.querySelector("#invoiceQueryOptions")&&(document.querySelector("#useInvoice")&&document.querySelector("#useInvoice").addEventListener("change",t=>{document.querySelector("#invoiceNumber").disabled=!1===t.target.checked,e.getClosest(t.target,"#singleInvoiceQuery").querySelector(".dateIssuedMonth").disabled=!0===t.target.checked,e.getClosest(t.target,"#singleInvoiceQuery").querySelector(".dateIssuedMonth").required=!1===t.target.checked}),Array.from(document.querySelectorAll("#single, #multi")).forEach(e=>{e.addEventListener("click",e=>{e.target.checked||e.preventDefault()}),e.addEventListener("change",e=>{let t=[],r="single"===e.target.getAttribute("id")?"multi":"single",l=document.querySelector("#"+r).getAttribute("form");Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(r=>{r.checked&&t.push(r),r.checked=!1,r.setAttribute("form",e.target.getAttribute("form"))}),"single"==r&&(document.querySelector("#compareMembers").disabled=!0),e.target.checked&&(document.querySelector("#"+r).checked=!1),0<t.length&&(t[0].checked=!0),document.querySelector("button[form='"+e.target.getAttribute("form")+"']").disabled=!1,document.querySelector("button[form='"+l+"']").disabled=!0})}),Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(e=>{e.addEventListener("change",e=>{let t=0;Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(r=>{document.querySelector("#single").checked?r.checked=r===e.target:t+=r.checked}),document.querySelector("#compareMembers").disabled=2>t})}),document.querySelector("#single")&&e.triggerEvent(document.querySelector("#single"),"change"),Array.from(document.querySelectorAll("#singleInvoice, #rangeInvoice")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r=!1,l={},i=make(["p",{class:"center ellipsis"},"."]);if(Array.from(document.querySelectorAll("input[form='"+t.target.getAttribute("form")+"'], select[form='"+t.target.getAttribute("form")+"']")).forEach(e=>{e.required&&""===e.value&&(r=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),"[]"===e.getAttribute("name").slice(-2)?"undefined"==typeof l[e.getAttribute("name").slice(0,-2)]?"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&(l[e.getAttribute("name").slice(0,-2)]=[e.value]):!1===e.disabled&&(l[e.getAttribute("name").slice(0,-2)]=[e.value]):"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&l[e.getAttribute("name").slice(0,-2)].push(e.value):!1===e.disabled&&l[e.getAttribute("name").slice(0,-2)].push(e.value):"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&(l[e.getAttribute("name")]=e.value):!1===e.disabled&&(l[e.getAttribute("name")]=e.value)}),r)return t.target.disabled=!1,!1;clearElement(document.querySelector("#invoiceQueryResults")),document.querySelector("#invoiceQueryResults").appendChild(i);let a=!0,o=setInterval(()=>{!0===a&&(i.innerHTML+="..",a=21>i.innerHTML.length&&1!=i.innerHTML.length),!1===a&&(i.innerHTML=i.innerHTML.substr(0,i.innerHTML.length-2),a=1===i.innerHTML.length)},500);l.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./buildQuery.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(clearInterval(o),document.querySelector("#invoiceQueryResults").removeChild(i),-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=parser.parseFromString(r,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll("#invoiceChartPDFform, .bargraph, .graphKey, #invoice, .invoiceTable, p.displayHeader, .result")).forEach(e=>{a.appendChild(e)}),document.querySelector("#invoiceQueryResults").appendChild(a),t.target.disabled=!1,assignQueriedInvoiceListeners()}).catch(e=>{console.error(e.message),clearInterval(o),i.parentNode.removeChild(i),document.querySelector("#invoiceQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#invoiceQueryResults")),t.target.disabled=!1},3500)})})})),document.querySelector("#deliveryQuery")&&(Array.from(document.querySelectorAll("#deliveryQuery .orgMember")).forEach(t=>{t.addEventListener("change",t=>{e.disableButtonsTickets(),t.target.checked?(document.querySelector("#ticketNumber").value="",document.querySelector("#ticketNumber").readOnly=!0,e.triggerEvent(document.querySelector("#ticketNumber"),"change")):document.querySelector("#ticketNumber").readOnly="chart"===document.querySelector("#display").value})}),document.querySelector("#display")&&document.querySelector("#display").addEventListener("change",e=>{document.querySelector("#compareBox")&&Array.from(document.querySelectorAll("#compareBox, #compareMembersTickets")).forEach(t=>{t.disabled="tickets"===e.target.value,"tickets"===e.target.value&&(t.checked=!1)}),document.querySelector("#ticketNumber").disabled="chart"===e.target.value||"tickets"===e.target.value&&!0===document.querySelector("#allTime").checked,Array.from(document.querySelectorAll("#chargeHistory, #type")).forEach(t=>{t.disabled="chart"===e.target.value}),Array.from(document.querySelectorAll("#deliveryQuery .ticketDate, #deliveryQuery .chartDate")).forEach(t=>{"tickets"===e.target.value?(t.style.display=t.classList.contains("ticketDate")?"inline-block":"none",t.querySelector("input")&&Array.from(t.querySelectorAll("input")).forEach(e=>{e.disabled=e.classList.contains("startDateMonth")||e.classList.contains("endDateMonth"),e.value="",!1===e.disabled&&(e.disabled=document.querySelector("#allTime").checked)})):(t.style.display=t.classList.contains("ticketDate")?"none":"inline-block",t.querySelector("input")&&Array.from(t.querySelectorAll("input")).forEach(e=>{e.disabled=!e.classList.contains("startDateMonth")&&!e.classList.contains("endDateMonth"),e.value="",!1===e.disabled&&(e.disabled=document.querySelector("#allTime").checked)}))})}),document.querySelector("#allTime").addEventListener("change",t=>{let r=document.querySelector("#display")&&"chart"===document.querySelector("#display").value?".chartDate":".ticketDate";!0===t.target.checked?Array.from(e.getClosest(t.target,"form").querySelectorAll(r+" input, #ticketNumber")).forEach(e=>{e.value="",e.disabled=!0}):(Array.from(e.getClosest(t.target,"form").querySelectorAll(r+" input")).forEach(e=>{e.disabled=!1}),document.querySelector("#ticketNumber").disabled=!!document.querySelector("#display")&&"chart"===document.querySelector("#display").value)}),document.querySelector("#ticketNumber").addEventListener("blur",t=>{""===t.target.value?(Array.from(document.querySelectorAll("#deliveryQuery .startDateDate, #deliveryQuery .endDateDate, #chargeHistory, #charge, #type, #allTime, #display, #compareBox, #compareMembersTickets, #deliveryQuery .orgMember")).forEach(e=>{e.disabled=!1,e.required=e.classList.contains("startDate")||e.classList.contains("endDate")}),Array.from(document.querySelectorAll("#deliveryQuery .startDateMarker, #deliveryQuery .endDateMarker, #deliveryQuery .chargeMarker, #deliveryQuery .typeMarker, #displayMarker")).forEach(e=>{e.disabled=!0})):(document.querySelector("#display")&&(document.querySelector("#display").value="tickets",e.triggerEvent(document.querySelector("#display"),"change")),Array.from(document.querySelectorAll("#deliveryQuery .startDateDate, #deliveryQuery .endDateDate, #chargeHistory, #charge, #type, #allTime, #display, #compareBox, #compareMembersTickets, #deliveryQuery .orgMember")).forEach(e=>{e.disabled=!0,e.checked=!1,e.required=!1}),Array.from(document.querySelectorAll("#deliveryQuery .startDateMarker, #deliveryQuery .endDateMarker, #deliveryQuery .chargeMarker, #deliveryQuery .typeMarker, #displayMarker")).forEach(e=>{e.disabled=!1}))}),document.querySelector(".submitOrgTickets")?document.querySelector(".submitOrgTickets").addEventListener("click",async t=>{t.preventDefault();let r={},l=make(["p",{class:"center ellipsis"},"."]);r.formKey=document.querySelector("#formKey").value,document.querySelector("#ticketQueryResults").appendChild(l);let i=!0,a=setInterval(()=>{!0===i&&(l.innerHTML+="..",i=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===i&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),i=1===l.innerHTML.length)},500);Array.from(document.querySelectorAll("#deliveryQuery input, #deliveryQuery select")).forEach(e=>{e.disabled||e.readOnly||("[]"===e.getAttribute("name").slice(-2)?("checkbox"===e.getAttribute("type")&&e.checked||"checkbox"!==e.getAttribute("type")&&""!==e.value)&&("undefined"==typeof r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]?r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]=[e.value]:("object"==typeof r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]||"array"==typeof r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)])&&r[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)].push(e.value)):"checkbox"===e.getAttribute("type")?e.checked&&(r[e.getAttribute("name")]=e.value):r[e.getAttribute("name")]=e.value)}),await e.fetch_template({url:"./buildQuery.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(t.target.disabled=!1,clearInterval(a),l.parentNode.removeChild(l),-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let i=parser.parseFromString(r,"text/html"),o=document.createDocumentFragment();Array.from(i.querySelectorAll("#ticketPDFform, .tickets, .ticketTable, .bargraph, .graphKey, .result")).forEach(e=>{o.appendChild(e)}),clearElement(document.querySelector("#ticketQueryResults")),document.querySelector("#ticketQueryResults").appendChild(o),e.assignQueriedTicketListeners()}).catch(e=>{console.error(e.message),t.target.disabled=!1,clearInterval(a),l.parentNode.removeChild(l),document.querySelector("#ticketQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#ticketQueryResults"))},3500)})}):(document.querySelector(".clearTicketResults").addEventListener("click",()=>{clearElement(document.querySelector("#ticketQueryResults"))}),document.querySelector(".resetTicketQuery").addEventListener("click",()=>{document.querySelector("#display").value="tickets",e.triggerEvent(document.querySelector("#display"),"change"),Array.from(document.querySelectorAll("#deliveryQuery .elementError")).forEach(e=>{e.classList.remove("elementError")})}),document.querySelector(".submitTicketQuery").addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r=!1,l={},i=make(["p",{class:"center ellipsis"},"."]);if(Array.from(document.querySelectorAll("#deliveryQuery input, #deliveryQuery select")).forEach(e=>{e.disabled||("checkbox"===e.type?l[e.getAttribute("name")]=e.checked?1:0:e.value&&(l[e.getAttribute("name")]=e.value))}),l.hasOwnProperty("ticketNumber")||l.allTime?!l.ticketNumber&&!l.allTime&&(r=!0,document.querySelector("#ticketNumber").classList.add("elementError"),setTimeout(()=>{document.querySelector("#ticketNumber").classList.remove("elementError")},3500)):(!l.hasOwnProperty("startDate")||!l.startDate||!l.hasOwnProperty("endDate")||!l.endDate)&&(r=!0,Array.from(document.querySelectorAll("#deliveryQuery input[name='startDate'], #deliveryQuery input[name='endDate']")).forEach(e=>{e.value||(e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3500))})),l.formKey=document.querySelector("#formKey").value,r)return t.target.disabled=!1,!1;document.querySelector("#ticketQueryResults").appendChild(i);let a=!0,o=setInterval(()=>{!0===a&&(i.innerHTML+="..",a=21>i.innerHTML.length&&1!=i.innerHTML.length),!1===a&&(i.innerHTML=i.innerHTML.substr(0,i.innerHTML.length-2),a=1===i.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(t.target.disabled=!1,clearInterval(o),i.parentNode.removeChild(i),-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=parser.parseFromString(r,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll("#ticketPDFform, .bargraph, .graphKey, .tickets, .ticketTable, .ticketGraphContainer, .result")).forEach(e=>{a.appendChild(e)}),clearElement(document.querySelector("#ticketQueryResults")),document.querySelector("#ticketQueryResults").appendChild(a),e.assignQueriedTicketListeners()}).catch(e=>{console.error(e.message),t.target.disabled=!1,clearInterval(o),i.parentNode.removeChild(i),document.querySelector("#ticketQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#ticketQueryResults"))},3500)})}))),document.querySelector("#clientUpdateForm")&&(document.querySelector("#same").addEventListener("change",t=>{Array.from(document.querySelectorAll("input[name='BillingName'], input[name='BillingAddress1'], input[name='BillingAddress2'], input[name='BillingCountry']")).forEach(e=>{e.disabled=!0===t.target.checked,e.required=!1===t.target.checked}),Array.from(document.querySelectorAll("fieldset[name='billingInfo'] .error")).forEach(e=>{e.style.display=!0===t.target.checked?"none":"inline"}),e.getClosest(document.querySelector("input[name='BillingCountry'][form='clientUpdate']"),"tr").classList.contains("hide")&&(document.querySelector("input[name='BillingCountry'][form='clientUpdate']").value=document.querySelector("input[name='ShippingCountry'][form='clientUpdate']").value)}),document.querySelector("#enableInfoUpdate").addEventListener("change",e=>{document.querySelector("#submitInfoUpdate").disabled=!1===e.target.checked}),document.querySelector("#submitInfoUpdate").addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r={},l=!1,i=make(["span",{class:"ellipsis"},"."]);if(Array.from(document.querySelectorAll("input[form='"+t.target.getAttribute("form")+"']")).forEach(e=>{!0===e.required&&""===e.value&&(console.log(e),l=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),!1===e.disabled&&(r[e.getAttribute("name")]=e.value),"checkbox"===e.type&&(r[e.getAttribute("name")]=!0===e.checked?1:0)}),!0==l)return t.target.disabled=!1,!1;document.querySelector("#clientUpdateResult").appendChild(i);let a=!0,o=setInterval(()=>{!0===a&&(i.innerHTML+=".",a=21>i.innerHTML.length&&1!=i.innerHTML.length),!1===a&&(i.innerHTML=i.innerHTML.substr(0,i.innerHTML.length-2),a=1===i.innerHTML.length)},500);r.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./updateClientInfo.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(t.target.disabled=!1,clearInterval(o),document.querySelector("#clientUpdateResult").removeChild(i),-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=parser.parseFromString(r,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll(".result")).forEach(e=>{a.appendChild(e)}),document.querySelector("#clientUpdateResult").appendChild(a),setTimeout(()=>{clearElement(document.querySelector("#clientUpdateResult")),document.querySelector("#enableInfoUpdate").checked=!1,e.triggerEvent(document.querySelector("#enableInfoUpdate"),"change")},3500)}).catch(e=>{console.error(e.message),t.target.disabled=!1,clearInterval(o),document.querySelector("#clientUpdateResult").removeChild(i),document.querySelector("#clientUpdateResult").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#clientUpdateResult"))},3500)})}))},assignQueriedInvoiceListeners=()=>{document.querySelector("#invoicePDF")&&document.querySelector("#invoicePDF").addEventListener("click",e=>{e.preventDefault();let t,r=document.querySelector("#invoice").cloneNode(!0),l={},i=["position","top","left","right","font-size"];if(null!==document.querySelector("#invoice .vatNotice"))for(let e in t=getComputedStyle(document.querySelector("#invoice .vatNotice")),t)-1!==i.indexOf(e)&&(l[e]=t.getPropertyValue(e));r.querySelector("#invoicePDFform").remove(),Array.from(r.querySelectorAll(".vatNotice")).forEach(e=>{for(let t in e.parentNode.style.position="relative",l)e.style[t]=l[t]}),document.querySelector("#invoicePDFform input[name='content']").value=r.outerHTML,document.querySelector("#invoicePDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,document.querySelector("#invoicePDFform").submit()}),document.querySelector("#invoiceChartPDF")&&document.querySelector("#invoiceChartPDF").addEventListener("click",t=>{t.preventDefault();let r=document.querySelector("#invoiceQueryResults").cloneNode(!0);r.querySelector("#invoiceChartPDFform").remove(),Array.from(r.querySelectorAll(".invoiceQuery")).forEach(t=>{let r=e.getClosest(t,"td"),l=t.innerHTML,i=Array.from(t.classList);r.classList.add(...i),r.innerHTML=l}),document.querySelector("#invoiceChartPDFform input[name='content']").value=r.outerHTML,document.querySelector("#invoiceChartPDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,document.querySelector("#invoiceChartPDFform").submit()}),Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceQuery")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.classList.add("red"),t.target.disabled=!0,setTimeout(()=>{t.target.classList.remove("red")},3500);let r={},l=make(["p",{class:"center ellipsis"},"."]);e.getClosest(t.target,".invoiceTable").appendChild(l);let i=!0,a=setInterval(()=>{!0===i&&(l.innerHTML+="..",i=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===i&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),i=1===l.innerHTML.length)},500);Array.from(e.getClosest(t.target,"form").querySelectorAll("input")).forEach(e=>{r[e.getAttribute("name")]=e.value}),r.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./buildQuery.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(a),l.parentNode.removeChild(l),-1!==t.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let r=parser.parseFromString(t,"text/html"),i=document.createDocumentFragment();Array.from(r.querySelectorAll("#invoice, .invoiceTable, .invoiceGraphContainer, p.displayHeader, .result")).forEach(e=>{i.appendChild(e)}),document.querySelector("#invoiceQueryResults").appendChild(i)}).catch(r=>{console.log(r.message),clearInterval(a),e.getClosest(t.target,".invoiceTable").removeChild(l),e.getClosest(t.target,".invoiceTable").appendChild(displayErrorMessage(r)),setTimeout(()=>{e.getClosest(t.target,".invoiceTable").innerHTML="",t.target.disabled=!1},3500)})})}),document.querySelector("#invoiceQueryResults .invoiceTable")&&(Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceTable, #invoiceQueryResults .invoiceGraphContainer")).forEach(t=>{t.addEventListener("touchstart",()=>{e.Swipe.disable()})}),Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceTable, #invoiceQueryResults .invoiceGraphContainer")).forEach(t=>{t.addEventListener("touchend",()=>{e.Swipe.enable()})}))},e.assignQueriedTicketListeners=()=>{Array.from(document.querySelectorAll("#ticketQueryResults .invoiceQuery")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault();let r={},l=make(["p",{class:"center ellipsis"},"."]);Array.from(e.getClosest(t.target,"form").querySelectorAll("input")).forEach(e=>{r[e.getAttribute("name")]=e.value}),r.formKey=document.querySelector("#formKey").value,clearElement(document.querySelector("#invoiceQueryResults")),document.querySelector("#invoiceQueryResults").appendChild(l),e.Swipe.slide(document.querySelector("a.nav[data-id='invoice_query']").getAttribute("data-value"),300);let i=!0,a=setInterval(()=>{!0===i&&(l.innerHTML+="..",i=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===i&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),i=1===l.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(clearInterval(a),l.parentNode.removeChild(l),-1!==t.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let r=parser.parseFromString(t,"text/html"),i=document.createDocumentFragment();Array.from(r.querySelectorAll("#invoice, .result")).forEach(e=>{i.appendChild(e)}),document.querySelector("#invoiceQueryResults").appendChild(i),assignQueriedInvoiceListeners()}).catch(e=>{console.error(e.message),clearInterval(a),l.parentNode.removeChild(l),document.querySelector("#invoiceQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#invoiceQueryResults"))},3500)})})}),Array.from(document.querySelectorAll("#ticketQueryResults .sigPrint td")).forEach(e=>{e.addEventListener("click",e=>{let t=e.target.parentElement.nextElementSibling;t.style.display="none"===t.style.display||""===t.style.display?"block":"none"})}),Array.from(document.querySelectorAll("#ticketQueryResults .submitTicketQuery")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r={},l=make(["p",{class:"center ellipsis"},"."]);Array.from(e.getClosest(t.target,"form").querySelectorAll("input")).forEach(e=>{e.value&&(r[e.getAttribute("name")]=e.value)}),r.formKey=document.querySelector("#formKey").value;document.querySelector("#ticketQueryResults").appendChild(l);let i=!0,a=setInterval(()=>{!0===i&&(l.innerHTML+="..",i=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===i&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),i=1===l.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(t.target.disabled=!1,clearInterval(a),l.parentNode.removeChild(l),-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let i=parser.parseFromString(r,"text/html"),o=document.createDocumentFragment();Array.from(i.querySelectorAll(".tickets, .result")).forEach(e=>{o.appendChild(e)}),document.querySelector("#ticketQueryResults").appendChild(o),e.assignQueriedTicketListeners()}).catch(e=>{console.error(e.message),t.target.disabled=!1,clearInterval(a),l.parentNode.removeChild(l),document.querySelector("#ticketQueryResults").appendChild(displayErrorMessage(e)),setTimeout(()=>{clearElement(document.querySelector("#ticketQueryResults"))},3500)})})}),document.querySelector("#ticketPDF")&&document.querySelector("#ticketPDF").addEventListener("click",e=>{e.preventDefault();let t=document.querySelector("#ticketQueryResults").cloneNode(!0);t.querySelector("#ticketPDF").remove(),Array.from(t.querySelectorAll(".submitTicketQuery")).forEach(e=>{e.parentNode.remove()}),document.querySelector("#ticketPDFform input[name='content']").value=t.outerHTML,document.querySelector("#ticketPDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,document.querySelector("#ticketPDFform").submit()}),document.querySelector("#ticketQueryResults .bargraph")&&(document.querySelector("#ticketQueryResults .bargraph").addEventListener("touchstart",()=>{e.Swipe.disable()}),document.querySelector("#ticketQueryResults .bargraph").addEventListener("touchend",()=>{e.Swipe.enable()}))},assignTicketEditorListener=()=>{Array.from(document.querySelectorAll("#ticketEditorResultContainer button.ticketEditor")).forEach(t=>{t.getAttribute("data-assigned")||(t.setAttribute("data-assigned",1),t.addEventListener("click",async t=>{t.target.classList.add("red"),setTimeout(()=>{t.target.classList.remove("red")},3e3);let r=e.getClosest(t.target,".sortable"),l={};l.ticket_index=t.target.getAttribute("data-index"),l.ticketEditor=1,l.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./enterTicket.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(t=>{if(-1!==t.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=parser.parseFromString(t,"text/html"),i=document.createDocumentFragment();if(Array.from(r.querySelectorAll("table, hr, button.ticketEditor")).forEach(e=>{e.classList.add("hide")}),Array.from(l.querySelectorAll(".removableByEditor")).forEach(e=>{i.appendChild(e)}),r.appendChild(i),r.parentNode.querySelector("datalist"))for(;r.parentNode.querySelector("datalist");)r.parentNode.removeChild(r.parentNode.querySelector("datalist"));Array.from(l.querySelectorAll("datalist")).forEach(e=>{r.parentNode.prepend(e)}),assignTicketFormListeners(r)}).catch(e=>{console.error(e.message),r.appendChild(displayErrorMessage(e)),setTimeout(()=>{r.removeChild(message)},3500)})}))})},assignTicketFormListeners=t=>{let r=e=>{t.querySelector(".billTo").setAttribute("list",e.target.checked?"t_clients":"clients"),t.querySelector(".billTo").value="",t.querySelector("checkbox.contract")&&(t.querySelector(".contract").disabled=e.target.checked,e.target.checked&&(t.querySelector(".contract").checked=!1))};t.querySelector(".repeat")&&(t.querySelector(".repeat").removeEventListener("change",r),t.querySelector(".repeat").addEventListener("change",r));let l=t=>{let r=e.getClosest(t.target,"form");"0"===t.target.value?(r.querySelector(".emailAddress").required=!1,r.querySelector(".emailNote")&&r.querySelector(".emailNote").classList.add("hide")):(r.querySelector(".emailAddress").required=!0,r.querySelector(".emailNote")&&r.querySelector(".emailNote").classList.remove("hide"))};t.querySelector(".emailConfirm").removeEventListener("change",l),t.querySelector(".emailConfirm").addEventListener("change",l);let i=t=>{let r=e.getClosest(t.target,"fieldset");t.target.checked?(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!1,r.querySelector(".diWeight").focus(),r.querySelector(".diWeightMarker").value="0",r.querySelector(".diWeightMarker").disabled=!0):(r.querySelector(".diWeightMarker").value="0",r.querySelector(".diWeightMarker").disabled=!1,r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!0)};Array.from(t.querySelectorAll(".dryIce")).forEach(e=>{e.removeEventListener("change",i),e.addEventListener("change",i)});let a=r=>{Array.from(t.querySelectorAll(".rtMarker")).forEach(e=>{"6"===r.target.value||"7"===r.target.value?e.style.display="inline":(e.style.display="none",e.checked=!1)}),t.querySelector("input[name='d2TimeStamp']")&&(t.querySelector("input[name='d2TimeStamp']").disabled="6"!==r.target.value&&"7"!==r.target.value),"7"===r.target.value?(t.querySelector(".dedicatedNote").style.display="block",Array.from(t.querySelectorAll("input[id^='pSigReq'], input[id^='dSigReq']")).forEach(t=>{t.checked=!0,e.triggerEvent(t,"change")})):t.querySelector(".dedicatedNote").style.display="none"};Array.from(t.querySelectorAll(".charge")).forEach(e=>{e.removeEventListener("change",a),e.addEventListener("change",a)}),Array.from(t.querySelectorAll("input[type='number']")).forEach(e=>{e.addEventListener("keydown",()=>{"0"===e.value&&(e.value="")})}),Array.from(t.querySelectorAll("input[type='checkbox'][name='pSigReq'], input[type='checkbox'][name='dSigReq']")).forEach(e=>{e.addEventListener("click",e=>{"7"===t.querySelector(".charge").value&&e.preventDefault()})}),Array.from(t.querySelectorAll("input[type='checkbox'][name='pSigReq'], input[type='checkbox'][name='dSigReq'], input[type='checkbox'][name='d2SigReq']")).forEach(e=>{e.addEventListener("change",()=>{let e=t.querySelector("input[type='checkbox'][name='pSigReq']").checked,r=t.querySelector("input[type='checkbox'][name='dSigReq']").checked,l=t.querySelector("input[type='checkbox'][name='d2SigReq']").checked,i=t.querySelector(".sigNote");e||r||l?i.classList.remove("hide"):!i.classList.contains("hide")&&i.classList.add("hide")})}),Array.from(t.querySelectorAll("input[list]")).forEach(t=>{t.addEventListener("change",t=>{if(e.isTarget(t.target)){let r=[];if(Array.from(document.querySelectorAll("datalist#"+t.target.getAttribute("list")+" option")).forEach(e=>{let t=parser.parseFromString(e.innerHTML,"text/html");t.innerHTML=e.innerHTML,r.push(t.documentElement.textContent)}),""!==t.target.value&&-1===r.indexOf(t.target.value)){let r=t.target.getAttribute("placeholder")||"";return t.target.value="",t.target.classList.add("elementError"),t.target.placeholder="Selection Not On File",e.triggerEvent(t.target,"change"),void setTimeout(()=>{t.target.classList.remove("elementError"),t.target.placeholder=r},3e3)}}t.target.title=t.target.value}),"Address1"===t.getAttribute("name").substr(1)&&t.addEventListener("blur",t=>{let r;Array.from(document.querySelectorAll("#addy1 option")).forEach(e=>{e.value===t.target.value&&(r=e.getAttribute("data-value"))});"undefined"==typeof r||Array.from(document.querySelectorAll("#addy2 option")).forEach(l=>{l.getAttribute("data-value")===r&&(e.getClosest(t.target,"fieldset").querySelector("input[name='"+t.target.getAttribute("name").slice(0,-1)+"2']").value=l.value)})})}),Array.from(t.querySelectorAll("#toMe, #fromMe")).forEach(t=>{let r="deliveryField"===e.getClosest(t,"fieldset").getAttribute("id")?document.querySelector("#pickupField"):document.querySelector("#deliveryField"),l=e.getClosest(t,"fieldset");t.addEventListener("click",e=>{let t="",l=document.querySelector("input[name='ClientName'][form='javascriptVars']").value+document.querySelector("input[name='Department'][form='javascriptVars']").value+document.querySelector("input[name='ShippingAddress1'][form='javascriptVars']").value+document.querySelector("input[name='ShippingAddress2'][form='javascriptVars']").value;Array.from(r.querySelectorAll(".clientList")).forEach(e=>{t+=e.value}),t===l&&e.preventDefault()}),t.addEventListener("change",t=>{t.target.checked?(e.getClosest(t.target,"thead").querySelector(".onFile").checked=!1,e.triggerEvent(e.getClosest(t.target,"thead").querySelector(".onFile"),"change"),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!1,e.required=!1,e.readOnly=!0,e.style.display="inline"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!0,e.style.display="none"}),r.querySelector(".me").disabled=!0,l.querySelector("[id$='Client']").value=document.querySelector("input[name='ClientName'][form='javascriptVars']").value,l.querySelector("[id$='Department']").value=document.querySelector("input[name='Department'][form='javascriptVars']").value,l.querySelector("[id$='Address1']").value=document.querySelector("input[name='ShippingAddress1'][form='javascriptVars']").value,l.querySelector("[id$='Address2']").value=document.querySelector("input[name='ShippingAddress2'][form='javascriptVars']").value):(Array.from(l.querySelectorAll(".clientList")).forEach(e=>{e.readOnly=!1}),Array.from(l.querySelectorAll("[id$='Client'], [id$='Department'], [id$='Address1'], [id$='Address2']")).forEach(e=>{e.value=""}),r.querySelector(".me").disabled=!1)})}),Array.from(document.querySelectorAll(".onFile")).forEach(t=>{t.addEventListener("change",t=>{t.target.checked?(e.getClosest(t.target,"thead").querySelector(".me").checked=!1,e.triggerEvent(e.getClosest(t.target,"thead").querySelector(".me"),"change"),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!0,e.required=!1,e.readOnly=!1,e.style.display="none"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!1,e.style.display="inline"}),"onFileP"===t.target.id?document.querySelector("#toMe").disabled=!1:document.querySelector("#fromMe").disabled=!1):(Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!1,e.required="Department"!==e.getAttribute("name").substr(1),e.style.display="inline"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!0,e.style.display="none"}))})}),Array.from(document.querySelectorAll(".clientSelect")).forEach(t=>{t.addEventListener("change",t=>{let r=t.target.options[t.target.selectedIndex].getAttribute("data-value");Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{Array.from(e.options).forEach(e=>{e.selected=e.getAttribute("data-value")===r})})})}),t.querySelector(".receivedReady").addEventListener("change",r=>{Array.from(t.querySelectorAll(".readyNote, .readyDate")).forEach(t=>{t.style.display="none"===t.style.display?"inline-block":"none",t.classList.contains("readyDate")&&(!0===r.target.checked&&(t.value=""),e.triggerEvent(t,"change"),t.required=!r.target.checked)})});let o=r=>{if(!/(deliveryRequest\d+)/.test(e.getClosest(r.target,"div").id)){let e=new Date,l=new Date(r.target.value);if(e>=l){let e=make(["p",{class:"center readyError"},"Ready Time should be either \"Now\" or a time in the future."]);t.querySelector(".readyError")||t.querySelector(".ticketError").appendChild(e)}else if(t.querySelector(".readyError")){let e=t.querySelector(".readyError");e.parentNode.removeChild(e)}t.querySelector(".submitForm").disabled=null!==t.querySelector(".readyError")}};t.querySelector(".readyDate").removeEventListener("change",o),t.querySelector(".readyDate").addEventListener("change",o),t.querySelector(".cancelTicketEditor")&&t.querySelector(".cancelTicketEditor").addEventListener("click",()=>{if(t.removeChild(t.querySelector(".removableByEditor")),0===document.querySelectorAll(".cancelTicketEditor").length)for(;t.parentNode.querySelector("datalist");)t.parentNode.removeChild(t.parentNode.querySelector("datalist"));Array.from(t.querySelectorAll("table.hide, hr.hide, button.hide")).forEach(e=>{e.classList.remove("hide")})});let n=async r=>{r.preventDefault(),r.target.disabled=!0,t.querySelector(".cancelTicketEditor")&&(t.querySelector(".cancelTicketEditor").disabled=!0);let l=1,i=make(["span",{class:"ellipsis"},"."]);t.querySelector(".diWeight")&&(l=t.querySelector(".diWeight").getAttribute("step")),t.querySelector(".ticketError").innerHTML="",t.querySelector(".ticketError").appendChild(i);let a=!0,o=setInterval(()=>{!0===a&&(i.innerHTML+="..",a=21>i.innerHTML.length&&1!=i.innerHTML.length),!1===a&&(i.innerHTML=i.innerHTML.substr(0,i.innerHTML.length-2),a=1===i.innerHTML.length)},500),n=!1,c="deliveryRequest"===t.querySelector(".removableByEditor").getAttribute("id")?"":t.querySelector(".removableByEditor").getAttribute("id").match(/\d+/)[0],s=["pClient","pAddress1","pAddress2","pCountry","dClient","dAddress1","dAddress2","dCountry","dispatchedTo","billTo"],u={};return(""===c||"0"===document.querySelector("#request"+c+" input[name='contract']").value)&&s.push("requestedBy"),Array.from(t.querySelectorAll("input[form='request"+c+"'], select[form='request"+c+"'], textarea[form='request"+c+"']")).forEach(r=>{if(r.name)if("checkbox"!==r.type&&!1===r.disabled){if(-1!==s.indexOf(r.getAttribute("name"))&&""===r.value?(n=!0,r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError")},3e3)):r.classList.remove("elementError"),"deliveryRequest"===e.getClosest(r,"div").id&&"readyDate"===r.getAttribute("name")&&"none"!==r.style.display){let e=make(["p",{class:"center readyError"},"Ready Time should be either \"Now\" or a time in the future."]),l=new Date,i=new Date(r.value);(l>=i||""===r.value)&&(n=!0,!t.querySelector(".readyError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".readyError")&&e.parentNode.removeChild(e)},3e3))}if(/(deliveryRequest\d+)/.test(e.getClosest(r,"div").id)){let e=make(["p",{class:"center timingError"},"Timing Error"]);switch(r.getAttribute("name")){case"readyDate":"none"!==r.style.display&&(""===r.value&&(n=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==t.querySelector(".pTimeStamp").value&&t.querySelector(".pTimeStamp").value<r.value&&(n=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),t.querySelector(".pTimeStamp").classList.add("elementError"),setTimeout(()=>{t.querySelector(".pTimeStamp").classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==t.querySelector(".dTimeStamp").value&&t.querySelector(".dTimeStamp").value<r.value&&(n=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),t.querySelector(".dTimeStamp").classList.add("elementError"),setTimeout(()=>{t.querySelector(".dTimeStamp").classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==t.querySelector(".d2TimeStamp").value&&t.querySelector(".d2TimeStamp").value<r.value&&(n=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),t.querySelector(".d2TimeStamp").classList.add("elementError"),setTimeout(()=>{t.querySelector(".d2TimeStamp").classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)));break;case"d2TimeStamp":""!==r.value&&(""===t.querySelector(".dTimeStamp").value||t.querySelector(".dTimeStamp").value>r.value||""===t.querySelector(".pTimeStamp").value||t.querySelector(".pTimeStamp").value>r.value||""===t.querySelector(".dispatchTimeStamp").value||t.querySelector(".dispatchTimeStamp").value>r.value)&&(n=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));break;case"dTimeStamp":""!==r.value&&(""===t.querySelector(".pTimeStamp").value||t.querySelector(".pTimeStamp").value>r.value||""===t.querySelector(".dispatchTimeStamp").value||t.querySelector(".dispatchTimeStamp").value>r.value)&&(n=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));break;case"pTimeStamp":""!==r.value&&(console.log(t.querySelector(".dispatchTimeStamp").value,r.value,t.querySelector(".dispatchTimeStamp").value>r.value),(""===t.querySelector(".dispatchTimeStamp").value||t.querySelector(".dispatchTimeStamp").value>r.value)&&(n=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)));break;case"dispatchTimeStamp":""===r.value&&(n=!0,!t.querySelector(".timingError")&&t.querySelector(".ticketError").parentNode.appendChild(e),r.classList.add("elementError"),setTimeout(()=>{r.classList.remove("elementError"),t.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));}}u[r.getAttribute("name")]=r.value}else"checkbox"===r.type&&(u[r.getAttribute("name")]="repeatClient"===r.getAttribute("name")?1-r.checked:0+r.checked)}),u.formKey=document.querySelector("#formKey").value,u.mapAvailable=e.getClosest(t,".page").querySelector(".mapContainer")?1:0,1===u.dryIce&&(0!=u.diWeight%l||0==u.diWeight)&&(t.querySelector(".ticketError").innerHTML=`Dry Ice in increments of ${l} only.`,t.querySelector(".diWeight").classList.add("elementError"),n=!0,setTimeout(()=>{t.querySelector(".ticketError").innerHTML="",t.querySelector(".diWeight").classList.remove("elementError")},3500)),!0===n?(clearInterval(o),t.querySelector(".ticketError").innerHTML="",Array.from(t.querySelectorAll(".submitForm, .cancelTicketEditor")).forEach(e=>{e.disabled=!1}),!1):void(await e.fetch_template({url:"./enterTicket.php",postData:u}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(r=>{if(clearInterval(o),-1!==r.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==r.indexOf("data-value=\"error\""))throw new Error(r);else{let l=parser.parseFromString(r,"text/html"),i=l.querySelector("#deliveryConfirmation")||l.querySelector(".editorConfirmation");if(t.querySelector(".removableByEditor").innerHTML="",t.querySelector(".removableByEditor").appendChild(i),u.mapAvailable){scroll(0,0);let t={};Array.from(document.querySelectorAll("input[form='coordinates']")).forEach(e=>{t[e.getAttribute("name")]=e.value}),t.mapDivID="map",e.updateMap(t)}assignConfirmationListeners(t)}}).catch(e=>{console.error(e.message),clearInterval(o),t.removeChild(i),t.querySelector(".ticketError").appendChild(displayErrorMessage(e)),setTimeout(()=>{t.querySelector(".ticketError").innerHTML=""},3500),Array.from(t.querySelectorAll(".submitForm, .cancelTicketEditor")).forEach(e=>{e.disabled=!1})}))};t.querySelector(".submitForm").removeEventListener("click",n),t.querySelector(".submitForm").addEventListener("click",n)},assignConfirmationListeners=t=>{Array.from(t.querySelectorAll(".confirmed, .editForm")).forEach(r=>{r.addEventListener("click",async r=>{r.preventDefault();let l=r.target.getAttribute("form"),i={};i.formKey=document.querySelector("#formKey").value,i.ticketEditor=1,Array.from(t.querySelectorAll("input[form='"+r.target.getAttribute("form")+"']")).forEach(e=>{i[e.getAttribute("name")]=e.value}),r.target.classList.contains("confirmed")&&/\d/.test(r.target.getAttribute("form"))&&(i.updateTicket=1),r.target.classList.contains("editForm")&&!/\d/.test(r.target.getAttribute("form"))&&(i.ticketEditor=0),await e.fetch_template({url:"./enterTicket.php",postData:i}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(l=>{if(-1!==l.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==l.indexOf("data-value=\"error\""))throw new Error(l);if(r.target.classList.contains("editForm")){Array.from(t.querySelectorAll("datalist, .removableByEditor")).forEach(e=>{e.parentNode.removeChild(e)});let i=parser.parseFromString(l,"text/html"),a=document.createDocumentFragment(),o=document.querySelector(".subContainer");Array.from(i.querySelectorAll("datalist, div")).forEach(e=>{a.appendChild(e)}),t.appendChild(a),/\d/.test(r.target.getAttribute("form"))||(t.appendChild(o),e.updateMap({mapDivID:"map"})),assignTicketFormListeners(t)}else if(r.target.classList.contains("confirmed")){if("remove"===l){let e=make(["p",{class:"center"},"Update Successful"]);return t.appendChild(e),scrollTo(0,document.querySelector("header").offsetHeight+5),void setTimeout(()=>{document.remove(t)},3e3)}if(!e.getClosest(t,".page").querySelector(".mapContainer")){let t=document.querySelector("#ticketEditorResultContainer"),i=e.getClosest(r.target,".sortable"),a=parser.parseFromString(l,"text/html"),o=document.createDocumentFragment(),n=make(["p",{class:"center"},"Update Successful"]);i.appendChild(n),o.appendChild(a.querySelector(".sortable")),setTimeout(()=>{t.insertBefore(o,i),t.removeChild(i),assignTicketEditorListener()},3500)}else{let t=parser.parseFromString(l,"text/html");clearElement(document.querySelector("#deliveryConfirmation")),document.querySelector("#deliveryConfirmation").appendChild(t.querySelector("#deliveryRequestComplete")),setTimeout(e.refreshTicketEntry,3500)}}}).catch(e=>{console.error(e.message),ellipsis.parentNode.removeChild(ellipsis),t.querySelector(".ticketError").appendChild(displayErrorMessage(e)),setTimeout(()=>{t.querySelector(".ticketError").innerHTML=""},3500)})})})},document.addEventListener("rjdci_resolutionchange",function(){setTimeout(()=>{e.fixDeadRunButton(),e.centerForm(document.querySelector("#confirmLogin"))},500)}),document.addEventListener("rjdci_loggedout",function(){setTimeout(e.disableApp,500)}),document.addEventListener("rjdci_loggedin",function(){setTimeout(e.enableApp,500)}),document.addEventListener("DOMContentLoaded",()=>{let t=screen.width,r=screen.height;setInterval(()=>{(screen.width!==t||screen.height!==r)&&(t=screen.width,r=screen.height,e.resolutionchange&&document.dispatchEvent(e.resolutionchange))},250),e.assignLinkValues();const l=document.querySelector("header"),i=document.querySelector(".menu__header");updateNetworkStatus=()=>{navigator.onLine?(l.classList.remove("app__offline"),i.style.background="#1E88E5"):(e.toast("You are now offline.."),l.classList.add("app__offline"),i.style.background="#9E9E9E")},navigator.onLine||updateNetworkStatus(),window.addEventListener("online",updateNetworkStatus,!1),window.addEventListener("offline",updateNetworkStatus,!1);let a=document.querySelector(".header__icon"),o=document.querySelector(".menu"),n=document.querySelector(".menu__overlay"),c=document.querySelector(".fab__push");showMenu=()=>{let e=document.querySelector("#signature-pad");if(null!==e)return!1;if(document.querySelector("header").classList.contains("loggedout"))return!1;let t=document.querySelector("#newUpdate");null===t||t.classList.contains("hide")||t.classList.add("hide"),o.style.transform="translateX(0)",o.classList.add("menu--show"),n.classList.add("menu__overlay--show")},hideMenu=()=>{o.style.transform="translateX(-110%)",o.classList.remove("menu--show"),n.classList.remove("menu__overlay--show")},a.addEventListener("click",showMenu,!1),n.addEventListener("click",hideMenu,!1),Array.from(document.querySelectorAll(".menu__list li")).forEach(e=>{e.addEventListener("click",hideMenu,!1)}),null!==c&&c.addEventListener("click",hideMenu,!1),document.querySelector("#logoutLink button").addEventListener("click",t=>{t.preventDefault(),e.logout()}),document.querySelector("#confirmLogin")&&e.populatePage().then(()=>{e.assignListeners(),e.assignQueriedTicketListeners(),document.dispatchEvent(e.loaded)}),Array.from(document.querySelectorAll(".menu__list li")).forEach(t=>{t.addEventListener("click",()=>{t.querySelector("a")&&e.Swipe.slide(t.querySelector("a").getAttribute("data-value"),300)})}),document.querySelector(".header__icon").addEventListener("click",()=>{let e=document.querySelector("#sig"),t=document.querySelector("#confirmLogin");if(null!==e||0<t.offsetWidth&&0<t.offsetHeight)return!1}),document.querySelector(".refresh").addEventListener("click",()=>{location.reload()}),document.querySelector("#confirm").addEventListener("click",async t=>{t.preventDefault();let r=!1;if(Array.from(document.querySelectorAll("#login input")).forEach(e=>{"function"!==e.id&&""===e.value&&(r=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3))}),!0==r)return!1;let l=make(["span",{class:"ellipsis"},"."]),i=!0,a=setInterval(()=>{!0===i&&(l.innerHTML+="..",i=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===i&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),i=1===l.innerHTML.length)},500),o={};document.querySelector("#confirmMessage").appendChild(l),o.clientID=document.querySelector("#uid").value,o.upw=document.querySelector("#upw").value,o.mobile=document.querySelector("#mobile").value,o.noSession=1,await e.fetch_template({url:"./refreshFormKey.php"}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(`${e.status} ${e.statusText}`)}).then(async t=>(document.querySelector("#formKey").value=t,await e.fetch_template({url:"../login.php",postData:o}))).then(e=>{if("undefined"==typeof e)throw new Error(e.status+" "+e.statusText);if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(a),-1!==t.indexOf("Session Error"))throw new Error("Session Error");if(-1===t.indexOf("error")&&-1===t.indexOf("Invalid Credentials"))document.querySelector("#confirmMessage").innerHTML="User Confirmed",setTimeout(()=>{if(clearElement(document.querySelector("#confirmMessage")),document.querySelector("#confirmLogin").classList.add("hide"),""!==document.querySelector("#function").value){let t=document.querySelector("#function").value;document.querySelector("#function").value="",e[t]()}document.dispatchEvent(e.loggedin)},1e3);else throw new Error(t)}).catch(e=>{clearInterval(a),document.querySelector("#confirmMessage").innerHTML="<span class=\"error\">Error</span>: "+e.message,setTimeout(()=>{clearElement(document.querySelector("#confirmMessage"))},4e3)})}),document.querySelector("#cancel").addEventListener("click",()=>{window.location.assign("./logout")})})})(window.rjdci=window.rjdci||{});
