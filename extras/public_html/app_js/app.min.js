(function(){let e=screen.width,t=screen.height;setInterval(()=>{(screen.width!==e||screen.height!==t)&&(e=screen.width,t=screen.height,rjdci.resolutionchange&&document.dispatchEvent(rjdci.resolutionchange))},250)})(),(t=>{!function(r,t){"function"==typeof define&&define.amd?define([],function(){return r.Swipe=t(),r.Swipe}):"object"==typeof module&&module.exports?module.exports=t():r.Swipe=t()}(this,function(){function r(K,r){"use strict";function _(){v.addEventListener?(te.removeEventListener("touchstart",L,!!v.passiveEvents&&{passive:!0}),te.removeEventListener("mousedown",L,!1),te.removeEventListener("webkitTransitionEnd",L,!1),te.removeEventListener("msTransitionEnd",L,!1),te.removeEventListener("oTransitionEnd",L,!1),te.removeEventListener("otransitionend",L,!1),te.removeEventListener("transitionend",L,!1),q.removeEventListener("resize",L,!1)):q.onresize=null}function D(r){var t=r.cloneNode(!0);te.appendChild(t),t.setAttribute("data-cloned",!0),t.removeAttribute("id")}function k(l){if(null!=l)for(var t in l)r[t]=l[t];$=te.children,ee=$.length;for(var e=0;e<$.length;e++)$[e].getAttribute("data-cloned")&&ee--;if(2>$.length&&(r.continuous=!1),v.transitions&&r.continuous&&3>$.length&&(D($[0]),D($[1]),$=te.children),"right"===le)for(var a=0;a<$.length;a++)$[a].style.float="right";J=Array($.length),Z=K.getBoundingClientRect().width||K.offsetWidth,te.style.width=2*($.length*Z)+"px";for(var c,u=$.length;u--;)c=$[u],c.style.width=Z+"px",c.setAttribute("data-index",u),v.transitions&&(c.style[le]=u*-Z+"px",P(u,u<E?-Z:E<u?Z:0,0));r.continuous&&v.transitions&&(P(A(E-1),-Z,0),P(A(E+1),Z,0)),v.transitions||(te.style[le]=E*-Z+"px"),K.style.visibility="visible",_(),v.addEventListener?(v.touch&&te.addEventListener("touchstart",L,!!v.passiveEvents&&{passive:!0}),r.draggable&&te.addEventListener("mousedown",L,!1),v.transitions&&(te.addEventListener("webkitTransitionEnd",L,!1),te.addEventListener("msTransitionEnd",L,!1),te.addEventListener("oTransitionEnd",L,!1),te.addEventListener("otransitionend",L,!1),te.addEventListener("transitionend",L,!1)),q.addEventListener("resize",L,!1)):q.onresize=x}function M(){z||(r.continuous?O(E+1):E<$.length-1&&O(E+1))}function S(l,t,e){r.callback&&r.callback(l,t,e)}function F(n,t){r.transitionEnd&&r.transitionEnd(n,t)}function A(e){return($.length+e%$.length)%$.length}function U(){var e=E;return ee<=e&&(e-=ee),e}function O(l,a){if(l="number"==typeof l?l:parseInt(l,10),E!==l){if(v.transitions){var e=Math.abs(E-l)/(E-l);if(r.continuous){var s=e;(e=-J[A(l)]/Z)!==s&&(l=-e*$.length+l)}for(var i=Math.abs(E-l)-1;i--;)P(A((E<l?l:E)-i-1),Z*e,0);l=A(l),P(E,Z*e,a||re),P(l,0,a||re),r.continuous&&P(A(l-e),-Z*e,0)}else l=A(l),function(l,e,n){if(!n)return te.style[le]=e+"px";var a=+new Date,i=setInterval(function(){var o=+new Date-a;return n<o?(te.style[le]=e+"px",(V||r.autoRestart)&&N(),F(U(),$[E]),void clearInterval(i)):void(te.style[le]=(e-l)*(Math.floor(100*(o/n))/100)+l+"px")},4)}(E*-Z,l*-Z,a||re);E=l,Y(function(){S(U(),$[E],e)})}}function P(r,t,e){R(r,t,e),J[r]=t}function R(r,t,e){var n=$[r],l=n&&n.style;l&&(l.webkitTransitionDuration=l.MozTransitionDuration=l.msTransitionDuration=l.OTransitionDuration=l.transitionDuration=e+"ms",l.webkitTransform=l.msTransform=l.MozTransform=l.OTransform=l.transform="translateX("+t+"px)")}function C(){(V=r.auto||0)&&(I=setTimeout(M,V))}function W(){V=0,clearTimeout(I)}function N(){W(),C()}function B(e){return /^mouse/.test(e.type)}var Q,I,j={},G={},V=(r=r||{}).auto||0,z=!1,X=function(){},Y=function(e){setTimeout(e||X,0)},n=function(e){return!!e&&("boolean"!=typeof e.cancelable||e.cancelable)},v={addEventListener:!!q.addEventListener,passiveEvents:function(){var r=!1;try{var n=Object.defineProperty({},"passive",{get:function(){r=!0}});q.addEventListener("testEvent",null,n),q.removeEventListener("testEvent",null,n)}catch(e){r=!1}return r}(),touch:"ontouchstart"in q||q.DocumentTouch&&H instanceof DocumentTouch,transitions:function(r){var t=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var e in t)if(void 0!==r.style[t[e]])return!0;return!1}(H.createElement("swipe"))};if(K){var $,J,Z,ee,te=K.children[0],E=parseInt(r.startSlide,10)||0,re=r.speed||300;r.continuous=void 0===r.continuous||r.continuous;var i,b,ne,le=(b="direction",(i=K).currentStyle?ne=i.currentStyle[b]:q.getComputedStyle&&(ne=q.getComputedStyle(i,null).getPropertyValue(b)),"rtl"===ne?"right":"left");r.autoRestart=void 0!==r.autoRestart&&r.autoRestart;var x=function(r,n){function l(){a&&clearTimeout(a)}function e(){var i=this,t=arguments;l(),a=setTimeout(function(){a=null,r.apply(i,t)},n)}n=n||100;var a=null;return e.cancel=l,e}(k),L={handleEvent:function(e){if(!z){switch(e.type){case"mousedown":case"touchstart":this.start(e);break;case"mousemove":case"touchmove":this.move(e);break;case"mouseup":case"mouseleave":case"touchend":this.end(e);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":this.transitionEnd(e);break;case"resize":x();}r.stopPropagation&&e.stopPropagation()}},start:function(r){var t;B(r)?(t=r).preventDefault():t=r.touches[0],j={x:t.pageX,y:t.pageY,time:+new Date},Q=void 0,G={},B(r)?(te.addEventListener("mousemove",this,!1),te.addEventListener("mouseup",this,!1),te.addEventListener("mouseleave",this,!1)):(te.addEventListener("touchmove",this,!!v.passiveEvents&&{passive:!1}),te.addEventListener("touchend",this,!1))},move:function(l){var t;if(B(l))t=l;else{if(1<l.touches.length||l.scale&&1!==l.scale)return;r.disableScroll&&n(l)&&l.preventDefault(),t=l.touches[0]}G={x:t.pageX-j.x,y:t.pageY-j.y},void 0===Q&&(Q=!!(Q||Math.abs(G.x)<Math.abs(G.y))),Q||(n(l)&&l.preventDefault(),W(),r.continuous?(R(A(E-1),G.x+J[A(E-1)],0),R(E,G.x+J[E],0),R(A(E+1),G.x+J[A(E+1)],0)):(G.x/=!E&&0<G.x||E===$.length-1&&0>G.x?Math.abs(G.x)/Z+1:1,R(E-1,G.x+J[E-1],0),R(E,G.x+J[E],0),R(E+1,G.x+J[E+1],0)))},end:function(l){var t=+new Date-j.time,e=250>+t&&20<Math.abs(G.x)||Math.abs(G.x)>Z/2,n=!E&&0<G.x||E===$.length-1&&0>G.x;r.continuous&&(n=!1);var a=Math.abs(G.x)/G.x;Q||(e&&!n?(E=0>a?(r.continuous?(P(A(E-1),-Z,0),P(A(E+2),Z,0)):P(E-1,-Z,0),P(E,J[E]-Z,re),P(A(E+1),J[A(E+1)]-Z,re),A(E+1)):(r.continuous?(P(A(E+1),Z,0),P(A(E-2),-Z,0)):P(E+1,Z,0),P(E,J[E]+Z,re),P(A(E-1),J[A(E-1)]+Z,re),A(E-1)),S(U(),$[E],a)):r.continuous?(P(A(E-1),-Z,re),P(E,0,re),P(A(E+1),Z,re)):(P(E-1,-Z,re),P(E,0,re),P(E+1,Z,re))),B(l)?(te.removeEventListener("mousemove",L,!1),te.removeEventListener("mouseup",L,!1),te.removeEventListener("mouseleave",L,!1)):(te.removeEventListener("touchmove",L,!!v.passiveEvents&&{passive:!1}),te.removeEventListener("touchend",L,!1))},transitionEnd:function(e){parseInt(e.target.getAttribute("data-index"),10)===E&&((V||r.autoRestart)&&N(),F(U(),$[E]))}};return k(),C(),{setup:k,slide:function(r,t){W(),O(r,t)},prev:function(){W(),function(){z||(r.continuous?O(E-1):E&&O(E-1))}()},next:function(){W(),M()},restart:N,stop:W,getPos:U,disable:function(){W(),z=!0},enable:function(){z=!1,N()},getNumSlides:function(){return ee},kill:function(){W(),K.style.visibility="",te.style.width="",te.style[le]="";for(var r=$.length;r--;){v.transitions&&R(r,0,0);var l=$[r];if(l.getAttribute("data-cloned")){var e=l.parentElement;e.removeChild(l)}l.style.width="",l.style[le]="",l.style.webkitTransitionDuration=l.style.MozTransitionDuration=l.style.msTransitionDuration=l.style.OTransitionDuration=l.style.transitionDuration="",l.style.webkitTransform=l.style.msTransform=l.style.MozTransform=l.style.OTransform=""}_(),x.cancel()}}}}var n,q="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||this,H=q.document;return(q.jQuery||q.Zepto)&&((n=q.jQuery||q.Zepto).fn.Swipe=function(e){return this.each(function(){n(this).data("Swipe",new r(n(this)[0],e))})}),r}),!function(r,e){"undefined"==typeof module?"function"==typeof define&&"object"==typeof define.amd?define(e):this[r]=e():module.exports=e()}("domready",function(){var l,a=[],e="object"==typeof document&&document,n=e&&e.documentElement.doScroll,r=e&&(n?/^loaded|^c/:/^loaded|^i|^c/).test(e.readyState);return!r&&e&&e.addEventListener("DOMContentLoaded",l=function(){for(e.removeEventListener("DOMContentLoaded",l),r=1;l=a.shift();)l()}),function(e){r?setTimeout(e,0):a.push(e)}}),rjdciSwipe=new Swipe(document.querySelector("#slider"),{startSlide:0,speed:300,draggable:!1,continuous:!0,autoRestart:!1,disablescroll:!1,stopPropagation:!1,callback:function(){},transitionEnd:function(e,t){let r=["Route","On Call","Dispatch","Transfers","Ticket Entry"],n=new DOMParser;document.querySelector(".menu__list__active").classList.remove("menu__list__active"),Array.from(document.querySelectorAll(".page")).forEach(e=>{if(e.id===t.id?e.classList.add("active"):e.classList.remove("active"),e.id===t.id){let t=document.querySelector("a.nav[data-id='"+e.id+"']").innerHTML.split("<");if(-1!==r.indexOf(t[0])){let e=document.createElement("button"),r="refresh"+t[0].replace(/\s/g,"");if(e.setAttribute("type","button"),e.addEventListener("click",window.rjdci[r]),e.innerHTML=t[0],document.querySelector(".pageTitle").innerHTML="",document.querySelector(".pageTitle").appendChild(e),1<t.length){let e="<"+t[1]+"<"+t[2],r=n.parseFromString(e,"text/html"),l=r.querySelector("span");l&&document.querySelector(".pageTitle").appendChild(l)}}else document.querySelector(".pageTitle").innerHTML=document.querySelector("a.nav[data-id='"+e.id+"']").innerHTML;document.querySelector("a.nav[data-id='"+e.id+"']").parentNode.classList.add("menu__list__active")}}),scroll(0,0),document.dispatchEvent(rjdci.pageChange)}})})(window),function(e){e.loggedout=new Event("rjdci_loggedout"),e.loggedin=new Event("rjdci_loggedin"),e.resolutionchange=new Event("rjdci_resolutionchange"),e.loaded=new Event("rjdci_loaded"),e.pageChange=new Event("rjdci_pageChange"),e.refreshedRoute=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"route"}}),e.refreshedOnCall=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"oncall"}}),e.refreshedTransfers=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"transfers"}}),e.refreshedDispatch=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"dispatch"}}),e.refreshedTicketEntry=new CustomEvent("rjdci_refreshed",{bubbles:!0,detail:{type:()=>"ticketEntry"}}),e.triggerEvent=(e,t)=>{if(document.createEvent){let r=document.createEvent("HTMLEvents");return r.initEvent(t,!0,!0),e.dispatchEvent(r)}return e.fireEvent?e.fireEvent("on"+t):void 0};const t=new DOMParser;e.updateMap=({coords1:e,address1:t,coords2:r,address2:n,center:l,mapDivID:a})=>!1,ucfirst=e=>e.charAt(0).toUpperCase()+e.slice(1),lcfirst=e=>e.charAt(0).toLowerCase()+e.slice(1),isArray=e=>"[object Array]"===Object.prototype.toString.call(e),make=e=>{let t=e[0],r=e[1],n=document.createElement(t),l=1;if("object"==typeof r&&null!==r&&!isArray(r)){for(let e in r)n.setAttribute(e,r[e]);l=2}for(let t=l;t<e.length;t++)isArray(e[t])?n.appendChild(make(e[t])):n.appendChild(document.createTextNode(e[t]));return n};const r=make(["div",{class:"showbox"},["svg",{class:"circular",viewBox:"25 25 50 50"},["circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"}]]]);e.logout=t=>{let r=t||0,n=document.querySelector("#uid").value;return n.match(/(driver|dispatch)\d+/)?void e.fetch_template({url:"./logout",postData:{logout:1,formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error")?void document.querySelector("#logoutLink").submit():(r++,e.logout(r)))).catch(()=>(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,r++,5<r?document.querySelector("#logoutLink").submit():e.logout(r))):document.querySelector("#logoutLink").submit()};let n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];e.toast=(t,r)=>{if(!t)return;isArray(t)||(t=[t]),r=r||{},r.title=r.title||"",r.time=r.time||4e3,r.eleClass=r.eleClass||"toast__msg",r.datatime=r.datatime||new Date().getTime();let a=document.querySelector(".toast__container");toastMsg=document.createElement("div"),d=new Date(+r.datatime),mins=d.getMinutes(),toastMsg.className=r.eleClass,toastMsg.title=r.title,minutes=10>mins?`0${mins.toString()}`:mins.toString(),t.push(...[`${l[d.getDay()]} ${n[d.getMonth()]} ${d.getDate()}`,`${d.getHours()}:${minutes}`]);for(let e=0;e<t.length;e++)toastMsg.appendChild(make(["p",t[e]]));if(toastMsg.setAttribute("data-time",r.datatime),"deliveryLocation"===toastMsg.className&&toastMsg.addEventListener("click",t=>"DIV"===t.target.tagName.toUpperCase()?t.target.parentNode.removeChild(t.target):e.triggerEvent(e.getClosest(t.target,"div"),"click")),"toast__msg"!==r.eleClass){for(let e=0;e<a.children.length;e++)if(a.children[e].classList.contains(r.eleClass)){let t=a.children[e];t.parentNode.removeChild(t)}a.appendChild(toastMsg)}else a.appendChild(toastMsg);setTimeout(()=>{toastMsg.classList.contains("toast__msg")&&toastMsg.classList.add("toast__msg--hide")},r.time),setTimeout(()=>{for(let e,t=0;t<a.children.length;t++)e=a.children[t],e.classList.contains("toast__msg")&&e.parentNode.removeChild(e)},r.time+1e3)},e.getClosest=function(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),r=t.length;0<=--r&&t.item(r)!==this;);return-1<r});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null},pause=e=>new Promise(t=>setTimeout(t,e)),e.fetch_template=async({url:t,postData:r={},method:n="POST",retry:l=0})=>{if(!t)throw new Error("URL not defined");let a={method:n.toUpperCase()};0<Object.keys(r).length&&(a.headers={"Content-Type":"application/json"},a.body=JSON.stringify(r));try{return await fetch(t,a)}catch(a){if(l++,20===l)throw a;return await pause(250*l),await e.fetch_template({url:t,postData:r,method:n,retry:l})}},e.showLogin=()=>{let t=document.getElementById("confirmLogin");0<t.offsetWidth&&0<t.offsetHeight||t.classList.remove("hide"),e.centerForm(t),document.dispatchEvent(e.loggedout)},e.enableApp=()=>{document.querySelector("header").classList.remove("loggedout"),document.querySelector(".menu__header").classList.remove("loggedoutHeader"),Array.from(document.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},e.disableApp=()=>{let e=document.querySelector("header"),t=document.querySelector(".menu__header");return!(void 0===e||void 0===t||e.classList.contains("loggedout"))&&void(e.classList.add("loggedout"),t.classList.add("loggedoutHeader"),Array.from(document.querySelectorAll("button")).forEach(e=>{"confirm"!==e.id&&"cancel"!==e.id&&(e.disabled=!0)}))},e.isTarget=e=>{let t=["billTo","dispatchedTo","dispatchedByUser","shippingCountry","billingCountry","pCountry","dCountry"];for(let r=0;r<t.length;r++)if(e.classList.contains(t[r]))return!0;return!1},e.disableButtonsTickets=()=>{let e=0,t=document.querySelectorAll("#ticket_query .orgMember"),r=document.querySelector("#compareMembersTickets");for(let r=0;r<t.length;r++)!0===t[r].checked&&e++;r.disabled=!(1<e&&"chart"===document.querySelector("#display").value),!0===r.disabled&&(r.checked=!1)},e.disable_scroll=()=>{window.ontouchmove=t=>t.preventDefault()},e.enable_scroll=()=>{window.ontouchmove=()=>!0},e.fixDeadRunButton=()=>{let e=document.querySelector(".cancelRun:not(.hide)");if(!e)return;let t=e.offsetHeight;Array.from(document.querySelectorAll(".deadRun")).forEach(e=>{e.innerHTML="Dead Run",e.offsetHeight>t&&(e.innerHTML="D. Run")})},e.centerForm=e=>{let t=document.body.getBoundingClientRect(),r=t.width,n=e.getBoundingClientRect(),l=n.width;e.style.left=(r-l)/2+"px"},isStopBeforeNoon=e=>{timestamp=1e3*+e.querySelector(".timing").innerText;let t=new Date(timestamp);return 12>t.getHours()},isStopAfterNoon=e=>{timestamp=1e3*+e.querySelector(".timing").innerText;let t=new Date(timestamp);return 12<=t.getHours()},sortRoute=()=>{let e,t=document.querySelector("#route"),r=document.getElementById("overnightFlag")?document.getElementById("overnightFlag").innerText:0,n=Array.from(t.querySelectorAll(".sortable")).filter(isStopBeforeNoon),l=Array.from(t.querySelectorAll(".sortable")).filter(isStopAfterNoon);n.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1),l.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1),e="1"===r?[...l,...n]:[...n,...l];let a=document.createDocumentFragment();e.forEach(e=>{a.appendChild(e)}),t.appendChild(a)},e.refreshRoute=async()=>{let n=r.cloneNode(!0);document.querySelector("#route").innerHTML="",document.querySelector("#route").appendChild(n),scrollTo(0,0),await e.fetch_template({url:"./refreshRoute.php",postData:{formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(-1!==r.indexOf("Session Error"))return document.querySelector("#function").value="refreshRoute",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==r.indexOf("error"))throw new Error(r);let l=t.parseFromString(r,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll(".sortable, .result, #overnightFlag")).forEach(e=>{a.appendChild(e)}),setTimeout(()=>{document.querySelector("#route").removeChild(n),document.querySelector("#route").appendChild(a),e.assignListeners(),e.fixDeadRunButton(),sortRoute(),document.dispatchEvent(e.refreshedRoute)},2e3)}).catch(e=>{document.querySelector("#route").appendChild(make(["p",{class:"center"},["span",{class:"error"},"Error"],`: ${e.message}`]))})},countOnCallTickets=e=>{let t=Array.from(document.querySelectorAll("#on_call .tickets")).length;t>e&&(document.querySelector(".alert").classList.add("onCallAlert"),document.querySelector(".alert").innerHTML="!",document.querySelector("#newUpdate").classList.remove("hide")),0===t&&document.querySelector(".alert").classList.remove("onCallAlert");let r=document.querySelector(".alert").getAttribute("class").split(/\s+/);1===r.length&&(document.querySelector(".alert").innerHTML=""),Array.from(document.querySelectorAll(".ticketCount")).forEach(e=>{e.innerHTML=t})},sortOnCall=()=>{let e=document.querySelector("#on_call"),t=Array.from(e.querySelectorAll(".sortable"));t.sort((e,t)=>e.querySelector(".timing").textContent>t.querySelector(".timing").textContent?1:-1);let r=document.createDocumentFragment();t.forEach(e=>{r.appendChild(e)}),e.appendChild(r)},e.refreshOnCall=async()=>{let n=document.querySelector(".ticketCount").innerHTML,l=r.cloneNode(!0);document.querySelector("#on_call").innerHTML="",document.querySelector("#on_call").appendChild(l),scrollTo(0,0),await e.fetch_template({url:"./refreshOnCall.php",postData:{formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(-1!==r.indexOf("Session Error"))return document.querySelector("#function").value="refreshOnCall",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==r.indexOf("error"))throw new Error(r);let a=t.parseFromString(r,"text/html"),i=document.createDocumentFragment();Array.from(a.querySelectorAll(".sortable, .result")).forEach(e=>{i.appendChild(e)}),setTimeout(()=>{document.querySelector("#on_call").removeChild(l),document.querySelector("#on_call").appendChild(i),e.assignListeners(),e.fixDeadRunButton(),sortOnCall(),countOnCallTickets(n),document.dispatchEvent(e.refreshedOnCall)},2e3)}).catch(e=>{console.error(e.message),document.querySelector("#on_call").appendChild(make(["p",{class:"center"},["span",{class:"error"},"Error"],`: ${e.message}`]))})},countInitOnCall=()=>{let e=Array.from(document.querySelectorAll("#on_call .tickets")).length;Array.from(document.querySelectorAll(".ticketCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("onCallAlert"),document.querySelector(".alert").innerHTML="!")},e.refreshTicketEntry=async()=>{let n=document.querySelector("#deliveryRequest"),l=n.parentNode;target=l.querySelector(".subContainer"),localSpinner=r.cloneNode(!0),l.removeChild(target),l.removeChild(n),l.appendChild(localSpinner),scrollTo(0,0),await e.fetch_template({url:"./refreshTicketForm.php",postData:{edit:1,formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(-1!==r.indexOf("Session Error"))return document.querySelector("#function").value="refreshTicketForm",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==r.indexOf("error"))throw new Error(r);let n=t.parseFromString(r,"text/html"),a=document.createDocumentFragment();Array.from(n.querySelectorAll("#deliveryRequest")).forEach(e=>{a.appendChild(e)}),setTimeout(()=>{l.removeChild(localSpinner),l.appendChild(a),l.appendChild(target),e.assignListeners(),document.dispatchEvent(e.refreshedTicketEntry)},2e3)}).catch(e=>{l.innerHTML="",l.appendChild(make(["p",{class:"center"},["span",{class:"error"},"Error"],`: ${e.message}`])),target.classList.remove("hide")})},e.countDispatch=e=>{let t=document.querySelector("#dispatch .tickets")?Array.from(document.querySelectorAll("#dispatch .tickets")).length:0,r=document.querySelector(".alert");t>e&&(r.classList.add("dispatchAlert"),r.innerHTML="!"),0===t&&r.classList.remove("dispatchAlert"),1===r.classList.length&&(r.innerHTML=""),Array.from(document.querySelectorAll(".dispatchCount")).forEach(e=>{e.innerHTML=t})},e.refreshDispatch=async()=>{let n=+document.querySelector(".dispatchCount").innerHTML-1,l=r.cloneNode(!0);document.querySelector("#dispatch").innerHTML="",document.querySelector("#dispatch").appendChild(l),scrollTo(0,0),await e.fetch_template({url:"./refreshDispatch.php",postData:{formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(-1!==r.indexOf("Session Error"))return document.querySelector("#function").value="refreshDispatch",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==r.indexOf("error"))throw new Error(r);let a=t.parseFromString(r,"text/html"),i=document.createDocumentFragment();Array.from(a.querySelectorAll(".sortable, .result")).forEach(e=>{i.appendChild(e)}),setTimeout(()=>{document.querySelector("#dispatch").removeChild(l),document.querySelector("#dispatch").appendChild(i),e.assignListeners(),e.countDispatch(n),Array.from(document.querySelectorAll("#dispatch .dTicket")).forEach(t=>{t.removeEventListener("click",e.stepTicket),t.addEventListener("click",e.stepTicket)}),document.dispatchEvent(e.refreshedDispatch)},2e3)}).catch(e=>{document.querySelector("#dispatch").innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>"})},countInitDispatch=()=>{let e=Array.from(document.querySelectorAll("#dispatch .tickets")).length;Array.from(document.querySelectorAll(".dispatchCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("dispatchAlert"),document.querySelector(".alert").innerHTML="!")},countTransferTickets=e=>{let t=Array.from(document.querySelectorAll("#transfers .sortable")).length,r=document.querySelector(".alert");t>e&&(r.classList.add("transfersAlert"),r.innerHTML="!",document.querySelector("#newUpdate").classList.remove("hide")),0===t&&r.classList.remove("transfersAlert"),1===r.classList.length&&(r.innerHTML=""),Array.from(document.querySelectorAll(".transfersCount")).forEach(e=>{e.innerHTML=t})},e.refreshTransfers=async()=>{let n=document.querySelector(".transfersCount").innerHTML,l=r.cloneNode(!0);document.querySelector("#transfers").innerHTML="",document.querySelector("#transfers").appendChild(l),scrollTo(0,0),await e.fetch_template({url:"./refreshTransfers.php",postData:{formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(-1!==r.indexOf("Session Error"))return document.querySelector("#function").value="refreshTransfers",e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==r.indexOf("error"))throw new Error(r);let a=t.parseFromString(r,"text/html"),i=document.createDocumentFragment();Array.from(a.querySelectorAll(".sortable, .result")).forEach(e=>{i.appendChild(e)}),setTimeout(()=>{document.querySelector("#transfers").removeChild(l),document.querySelector("#transfers").appendChild(i),e.assignListeners(),countTransferTickets(n),document.dispatchEvent(e.refreshedTransfers)},2e3)}).catch(e=>{document.querySelector("#transfers").innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>"})},countInitTransfers=()=>{let e=Array.from(document.querySelectorAll("#transfers .sortable")).length;Array.from(document.querySelectorAll(".transfersCount")).forEach(t=>{t.innerHTML=e}),0<e&&(document.querySelector(".alert").classList.add("transfersAlert"),document.querySelector(".alert").innerHTML="!")},e.assignLinkValues=()=>{let e=document.getElementsByClassName("nav"),r=["Route","On Call","Dispatch","Transfers","Ticket Entry"];for(let n=0;n<e.length;n++)if(e[n].setAttribute("data-value",n),0==n){let l=e[n].innerHTML.split("<");if(-1!==r.indexOf(l[0])){let e=document.createElement("button"),r="refresh"+l[0].replace(/\s/g,"");if(e.setAttribute("type","button"),e.addEventListener("click",window.rjdci[r]),e.innerHTML=l[0],document.querySelector(".pageTitle").innerHTML="",document.querySelector(".pageTitle").appendChild(e),1<l.length){let e="<"+l[1]+"<"+l[2],r=t.parseFromString(e,"text/html"),n=r.querySelector("span");n&&document.querySelector(".pageTitle").appendChild(n)}}else document.querySelector(".pageTitle").innerHTML=e[n].innerHTML}},e.populatePage=async()=>{let t=[];Array.from(document.querySelectorAll(".page")).forEach(e=>{e.getAttribute("data-function")!==void 0&&""!==e.getAttribute("data-function")&&t.push(e.getAttribute("data-function"))}),await e.fetch_template({url:"./initApp.php",postData:{functions:t,formKey:document.querySelector("#formKey").value}}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(-1!==t.indexOf("Session Error"))return document.getElementById("function").value="populatePage",e.showLogin();document.getElementById("formKey").value=+document.getElementById("formKey").value+1;let r;try{r=JSON.parse(t)}catch(e){throw e.message=e.message+"\n"+t,e}for(let e=0;e<r.length;e++)document.querySelectorAll(".page").forEach(t=>{+t.getAttribute("data-index")===e&&(t.innerHTML=r[e])});scrollTo(0,0),null!==document.getElementById("route")&&sortRoute(),null!==document.getElementById("on_call")&&(sortOnCall(),countInitOnCall()),null!==document.getElementsByClassName("deadRun")&&e.fixDeadRunButton(),null!==document.getElementById("dispatch")&&countInitDispatch(),null!==document.getElementById("transfers")&&countInitTransfers()}).catch(e=>{Array.from(document.querySelectorAll(".page")).forEach(t=>{t.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>"})})},e.deliveryLocation=({ticket_index:t=[],step:r=[]})=>{if("undefined"==typeof navigator.permissions||"undefined"==typeof navigator.geolocation)return e.toast("Location Not Available");let n=0,l=0,a=5,i=null,o=!1,s={};s.title="Updating Location",s.eleClass="deliveryLocation",e.toast(["Updating Location","Do not","disable screen"],s),navigator.permissions.query({name:"geolocation"}).then(c=>{let u={enableHighAccuracy:!0,timeout:25e3,maximumAge:0},m=e=>{if(console.log(e),n++,o=1<n?o&&o.coords.accuracy<e.coords.accuracy?o:e:e,n>a||2<n&&o.coords.accuracy<10)return navigator.geolocation.clearWatch(i),p(o)},y=t=>{if(l++,e.toast(["Location Not Available",t.message,"Tap to dismiss"],s),n>a||l>a)return navigator.geolocation.clearWatch(i),p(o)},p=async n=>{if(!n)return e.toast(["Location Not Available","Tap to dismiss"],s);if(t.length!==r.length||0===t.length)return e.toast(["Location Data Error","Tap to dismiss"],s);let l={},a={};l.formKey=document.querySelector("#formKey").value,1<t.length?(l.multiTicket=[],t.forEach((e,t)=>{a.ticket_index=e,a[r[t]+"Lat"]=n.coords.latitude,a[r[t]+"Lng"]=n.coords.longitude,l.multiTicket[t]=a,a={}})):(l.ticket_index=t[0],l[r[0]+"Lat"]=n.coords.latitude,l[r[0]+"Lng"]=n.coords.longitude),await e.fetch_template({url:"./updateTicket.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(-1!==t.indexOf("Session Error"))throw new Error("Session Error");if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==t.indexOf("error"))throw new Error(t);return e.toast(["Location Updated","Tap to dismiss"],s)}).catch(t=>(console.error(t.message),e.toast([t.message,"Tap to dismiss"],s)))};if("granted"==c.state)i=navigator.geolocation.watchPosition(m,y,u);else if("prompt"==c.state)navigator.geolocation.getCurrentPosition(()=>{});else if("denied"==c.state)return!1;c.onchange=()=>{if("granted"===c.state)i=navigator.geolocation.watchPosition(m,y,u);else{if("prompt"==c.state)return!1;if("denied"==c.state)return!1}}})},getCancelThis=()=>{let t=document.createElement("button");return t.type="button",t.innerHTML="Go Back",t.classList.add("cancelThis"),t.addEventListener("click",e.cancelThis),t},e.cancelThis=t=>{let r=e.getClosest(t.target,".sortable");Array.from(r.querySelectorAll("button")).forEach(e=>{e.disabled=!1}),t.target.parentNode.innerHTML=""},getStepTicket=t=>{let r=document.createElement("button");return r.type="button",r.innerHTML="Confirm",r.classList.add("stepTicket"),r.setAttribute("form",t),r.addEventListener("click",e.stepTicket),r},e.stepTicket=async t=>{t.preventDefault();let r={},n=!1,l="",a=e.getClosest(t.target,".message2"),i=e.getClosest(t.target,".page").getAttribute("id"),o=document.createElement("span");if(null===a&&(a=e.getClosest(t.target,"form").querySelector(".message2")),Array.from(document.querySelectorAll("input[form="+t.target.getAttribute("form")+"], textarea[form="+t.target.getAttribute("form")+"]")).forEach(e=>{"latitude"!==e.getAttribute("name")&&"longitude"!==e.getAttribute("name")&&(!0===e.required&&""===e.value&&(n=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),r[e.getAttribute("name")]=e.value)}),r.formKey=document.querySelector("#formKey").value,n)return;o.classList.add("ellipsis"),o.innerHTML=".",a.innerHTML="",a.appendChild(o);let s=!0,c=setInterval(()=>{!0===s&&(o.innerHTML+="..",s=21>o.innerHTML.length&&1!=o.innerHTML.length),!1===s&&(o.innerHTML=o.innerHTML.substr(0,o.innerHTML.length-2),s=1===o.innerHTML.length)},500);switch(r.hasOwnProperty("pSigPrint")&&(r.printName=r.pSigPrint,delete r.pSigPrint),r.hasOwnProperty("dSigPrint")&&(r.printName=r.dSigPrint,delete r.dSigPrint),r.hasOwnProperty("d2SigPrint")&&(r.printName=r.d2SigPrint,delete r.d2SigPrint),document.querySelector(".step[form=\""+t.target.getAttribute("form")+"\"]").value){case"pickedUp":l="p";break;case"delivered":l="d";break;case"returned":l="d2";}l&&e.deliveryLocation({ticket_index:[r.ticket_index],step:[l]}),await e.fetch_template({url:"./updateStep.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(c),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error"))a.innerHTML=t,setTimeout(()=>{"route"===i?e.refreshRoute():"on_call"===i?e.refreshOnCall():"dispatch"===i?e.refreshDispatch():void 0},3e3);else throw new Error(t)}).catch(t=>{console.error(t.message),clearInterval(c),a.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+t.message+"</p>",setTimeout(()=>{a.innerHTML="",Array.from(e.getClosest(a,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getStepAll=()=>{let t=document.createElement("button");return t.type="button",t.innerHTML="Confirm",t.classList.add("stepAll"),t.addEventListener("click",e.stepAll),t},e.stepAll=async t=>{t.preventDefault();let r={},n=[],l={},a={step:[],ticket_index:[]},i=e.getClosest(t.target,".message2"),o=e.getClosest(t.target,".sortable"),s=document.createElement("span"),c=o.querySelector(".printName");if(!0===c.required&&""===c.value)return c.classList.add("elementError"),setTimeout(()=>{c.classList.remove("elementError")},3e3),!1;s.classList.add("ellipsis"),s.innerHTML=".",i.innerHTML="",i.appendChild(s);let u=!0,m=setInterval(()=>{!0===u&&(s.innerHTML+="..",u=21>s.innerHTML.length&&1!=s.innerHTML.length),!1===u&&(s.innerHTML=s.innerHTML.substr(0,s.innerHTML.length-2),u=1===s.innerHTML.length)},500);Array.from(o.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{if("latitude"!==e.getAttribute("name")&&"longitude"!==e.getAttribute("name")&&(l[e.getAttribute("name")]=e.value),"step"===e.getAttribute("name"))switch(e.value){case"pickedUp":a.step.push("p");break;case"delivered":a.step.push("d");break;case"returned":a.step.push("d2");}"ticket_index"===e.getAttribute("name")&&a.ticket_index.push(e.value)}),n[t]=l,l={}}),r.multiTicket=n,r.formKey=document.querySelector("#formKey").value,r.printName=c.value,r.sigImage=o.querySelector(".sigImage").value,e.deliveryLocation(a),await e.fetch_template({url:"./updateStep.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(m),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error"))i.innerHTML=t,setTimeout(e.refreshRoute,3e3);else throw new Error(t)}).catch(t=>{console.error(t.message),clearInterval(m),i.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+t.message+"</p>",setTimeout(()=>{i.innerHTML="",Array.from(e.getClosest(i,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getCancelTicket=(t,r)=>{let n=document.createElement("button");return n.type="button",n.innerHTML="Confirm",n.classList.add("confirm"+r),n.setAttribute("form",t),n.addEventListener("click",e.confirmCancel),n},e.confirmCancel=async t=>{t.preventDefault();let r={},n=["ticket_index","notes","ticketBase"],l=e.getClosest(t.target,".message2"),a="",i=document.createElement("span");i.classList.add("ellipsis"),i.innerHTML=".",l.innerHTML="",l.appendChild(i);let o=!0,s=setInterval(()=>{!0===o&&(i.innerHTML+="..",o=21>i.innerHTML.length&&1!=i.innerHTML.length),!1===o&&(i.innerHTML=i.innerHTML.substr(0,i.innerHTML.length-2),o=1===i.innerHTML.length)},500);switch(Array.from(document.querySelectorAll("input[form="+t.target.getAttribute("form")+"], textarea[form="+t.target.getAttribute("form")+"]")).forEach(e=>{-1!==n.indexOf(e.getAttribute("name"))&&(r[e.getAttribute("name")]=e.value)}),t.target.getAttribute("class")){case"confirmDelete":r.action="delete";break;case"confirmCancelRun":r.action="cancel";break;case"confirmDeadRun":r.action="deadRun",a="p";break;case"confirmDeclined":r.action="declined",a="d";}r.formKey=document.querySelector("#formKey").value,a&&e.deliveryLocation({ticket_index:[r.ticket_index],step:[a]}),await e.fetch_template({url:"./deleteContractTicket.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(s),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error"))l.innerHTML=t,setTimeout(async()=>{switch(e.getClosest(l,".page").getAttribute("id")){case"route":return await e.refreshRoute();case"on_call":return await e.refreshOnCall();}},3e3);else throw new Error(t)}).catch(t=>{console.error(t.message),clearInterval(s),l.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+t.message+"</p>",setTimeout(()=>{l.innerHTML="",Array.from(e.getClosest(l,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferTicket=t=>{let r=document.createElement("button");return r.type="button",r.innerHTML="Confirm",r.classList.add("confirmTransfer"),r.setAttribute("form",t),r.addEventListener("click",e.transferTicket),r},e.transferTicket=async t=>{t.preventDefault();let r={},n=e.getClosest(t.target,".message2"),l=e.getClosest(t.target,".tickets"),a=e.getClosest(t.target,".page").getAttribute("id"),i=document.createElement("span");if(i.classList.add("ellipsis"),i.innerHTML=".",r.pendingReceiver=n.querySelector(".pendingReceiver").value,!r.pendingReceiver)return n.querySelector(".pendingReceiver").classList.add("elementError"),setTimeout(()=>{n.querySelector(".pendingReceiver").classList.remove("elementError"),Array.from(n.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3e3),!1;n.innerHTML="",n.appendChild(i);let o=!0,s=setInterval(()=>{!0===o&&(i.innerHTML+="..",o=21>i.innerHTML.length&&1!=i.innerHTML.length),!1===o&&(i.innerHTML=i.innerHTML.substr(0,i.innerHTML.length-2),o=1===i.innerHTML.length)},500);r.ticket_index=l.querySelector(".ticket_index").value,r.transfers=l.querySelector(".transfers").value,r.notes=l.querySelector(".notes").value,r.action="transfer",r.formKey=document.querySelector("#formKey").value,r.TransferState=1,await e.fetch_template({url:"./deleteContractTicket.php",postData:r}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(s),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error"))return n.innerHTML=t;throw new Error(t)}).then(async()=>await e.refreshTransfers()).then(async()=>"route"===a?await e.refreshRoute():"on_call"===a?await e.refreshOnCall():void 0).catch(t=>{console.error(t.message),clearInterval(s),n.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+t.message+"</p>",setTimeout(()=>{n.innerHTML="",Array.from(e.getClosest(n,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferGroup=t=>{let r=document.createElement("button");return r.type="button",r.innerHTML="Confirm",r.classList.add("confirmTransferGroup"),r.setAttribute("form",t),r.addEventListener("click",e.transferGroup),r},e.transferGroup=async t=>{let r=[],n={},l={},a=e.getClosest(t.target,".message2"),i=e.getClosest(t.target,".sortable"),o=document.createElement("span");if(o.classList.add("ellipsis"),o.innerHTML=".",pendingReceiver=a.querySelector(".pendingReceiver").value,!pendingReceiver)return a.querySelector(".pendingReceiver").classList.add("elementError"),setTimeout(()=>{a.querySelector(".pendingReceiver").classList.remove("elementError"),Array.from(a.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3e3),!1;a.innerHTML="",a.appendChild(o);let s=!0,c=setInterval(()=>{!0===s&&(o.innerHTML+="..",s=21>o.innerHTML.length&&1!=o.innerHTML.length),!1===s&&(o.innerHTML=o.innerHTML.substr(0,o.innerHTML.length-2),s=1===o.innerHTML.length)},500);Array.from(i.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{n[e.getAttribute("name")]=e.value}),n.pendingReceiver=pendingReceiver,n.transferState=1,r[t]=n,n={}}),l.multiTicket=r,l.TransferState=1,l.action="transfer",l.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./deleteContractTicket.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(c),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error"))return a.innerHTML=t;throw new Error(t)}).then(async()=>await e.refreshTransfers()).then(async()=>await e.refreshRoute()).catch(t=>{console.error(t.message),clearInterval(c),a.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+t.message+"</p>",setTimeout(()=>{a.innerHTML="",Array.from(e.getClosest(a,".sortable").querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferButton=e=>{let t=document.createElement("button");return t.type="button",t.innerHTML="Confirm",t.classList.add("confirm"+ucfirst(e)),t.addEventListener("click",processTransfer),t},e.processTransfer=async t=>{let r,n=["confirmCancelTransfer","confirmDeclineTransfer","confirmAcceptTransfer"],l={},a=e.getClosest(t.target,".message2"),i=e.getClosest(t.target,".tickets"),o=document.createElement("span");o.classList.add("ellipsis"),o.innerHTML=".",Array.from(i.querySelectorAll("button")).forEach(e=>{e.disabled=!0}),a.innerHTML="",a.appendChild(o);let s=!0,c=setInterval(()=>{!0===s&&(o.innerHTML+="..",s=21>o.innerHTML.length&&1!=o.innerHTML.length),!1===s&&(o.innerHTML=o.innerHTML.substr(0,o.innerHTML.length-2),s=1===o.innerHTML.length)},500);l.formKey=document.querySelector("#formKey").value,l.action="transfer",l.pendingReceiver=0,Array.from(i.querySelectorAll("input, textarea")).forEach(e=>{l[e.getAttribute("name")]=e.value});for(let e=0;e<t.target.classList.length;e++)if(n.indexOf(-1!==t.target.classList[e])){r=t.target.classList[e];break}"confirmCancelTransfer"===r?l.TransferState=2:"confirmDeclineTransfer"===r?l.TransferState=3:"confirmAcceptTransfer"===r?l.TransferState=4:void 0;await e.fetch_template({url:"./deleteContractTicket.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(c),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error"))return a.innerHTML=t;throw new Error(t)}).then(async()=>"0"===i.querySelector(".rNum").innerText?await e.refreshOnCall():await e.refreshRoute()).then(async()=>await e.refreshTransfers()).catch(e=>{console.error(e.message),clearInterval(c),a.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{a.innerHTML="",Array.from(i.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},getTransferAllButton=t=>{let r=document.createElement("button");return r.type="button",r.innerHTML="Confirm",r.classList.add("confirm"+ucfirst(t)),r.addEventListener("click",e.processTransferAll),r},e.processTransferAll=async t=>{let r,n,l=["confirmCancelTransferGroup","confirmDeclineTransferGroup","confirmAcceptTransferGroup"],a={},i={},o=e.getClosest(t.target,".message2"),s=e.getClosest(t.target,".sortable"),c=document.createElement("span");i.multiTicket=[],i.formKey=document.querySelector("#formKey").value,c.classList.add("ellipsis"),c.innerHTML=".",o.innerHTML="",o.appendChild(c);let u=!0,m=setInterval(()=>{!0===u&&(c.innerHTML+="..",u=21>c.innerHTML.length&&1!=c.innerHTML.length),!1===u&&(c.innerHTML=c.innerHTML.substr(0,c.innerHTML.length-2),u=1===c.innerHTML.length)},500);for(let e=0;e<t.target.classList.length;e++)if(l.indexOf(-1!==t.target.classList[e])){n=t.target.classList[e];break}"confirmCancelTransferGroup"===n?r=2:"confirmDeclineTransferGroup"===n?r=3:"confirmAcceptTransferGroup"===n?r=4:void 0;i.TransferState=r,Array.from(s.querySelectorAll(".routeStop")).forEach((e,t)=>{Array.from(document.querySelectorAll("input[form='"+e.getAttribute("id")+"'], textarea[form='"+e.getAttribute("id")+"']")).forEach(e=>{a[e.getAttribute("name")]=e.value}),a.transferState=r,a.action="transfer",i.multiTicket[t]=a,a={}}),await e.fetch_template({url:"./deleteContractTicket.php",postData:i}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(t=>{if(clearInterval(m),-1!==t.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===t.indexOf("error"))return o.innerHTML=t;throw new Error(t)}).then(async()=>await e.refreshRoute()).then(async()=>await e.refreshTransfers()).catch(e=>{console.error(e.message),clearInterval(m),o.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{o.innerHTML="",Array.from(s.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},5e3)})},e.assignListeners=()=>{document.querySelector("#deliveryRequest")&&assignTicketFormListeners(e.getClosest(document.querySelector("#deliveryRequest"),".page")),document.querySelector("form[id^='dispatchForm']")&&Array.from(document.querySelectorAll("form[id^='dispatchForm'] .stepTicket")).forEach(t=>{t.removeEventListener("click",e.stepTicket),t.addEventListener("click",e.stepTicket)});let r=e=>{e.target.classList.add("red"),setTimeout(()=>{e.target.classList.remove("red")},3e3)};Array.from(document.querySelectorAll("button")).forEach(e=>{e.addEventListener("click",r)});let n=async r=>{let n=e.getClosest(r.target,".tickets").querySelector(".message2");postData={},postData.ticket_index=document.querySelector(".ticket_index[form='"+r.target.getAttribute("form")+"']").value,postData.notes=document.querySelector(".notes[form='"+r.target.getAttribute("form")+"']").value,postData.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./updateTicket.php",postData:postData}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(-1!==r.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1===r.indexOf("error")){let e=t.parseFromString(r,"text/html");n.appendChild(e.querySelector(".result")),setTimeout(()=>{n.innerHTML=""},3500)}else throw new Error(r)}).catch(e=>{console.error(e.message),n.innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{n.innerHTML=""},5e3)})};if(Array.from(document.querySelectorAll(".updateNotes")).forEach(e=>{e.removeEventListener("click",n),e.addEventListener("click",n)}),Array.from(document.querySelectorAll(".dTicket")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r=e.getClosest(t.target,".page");Array.from(r.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")});let n=e.getClosest(t.target,".tickets");Array.from(n.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let l=n.querySelector(".message2"),a=getCancelThis(),i=getStepTicket(t.target.getAttribute("form"));l.innerHTML="Confirm "+t.target.innerText+":<br>",l.appendChild(i),l.appendChild(a)})}),Array.from(document.querySelectorAll(".confirmAll")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r=e.getClosest(t.target,".page");Array.from(r.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")});let n=e.getClosest(t.target,".sortable");Array.from(n.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let l=n.querySelector("p.message2"),a=getCancelThis(),i=getStepAll();l.innerHTML="Confirm Group Update:<br>",l.appendChild(i),l.appendChild(a)})}),Array.from(document.querySelectorAll(".cancelRun, .deadRun, .declined")).forEach(t=>{t.addEventListener("click",t=>{let r=["cancelRun","deadRun","declined"],n=e.getClosest(t.target,".page");Array.from(n.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")});let l=e.getClosest(t.target,".tickets");Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let a,i=l.querySelector(".message2"),o=getCancelThis(),s=l.querySelector(".dTicket").getAttribute("form");if(1===t.target.classList.length)a=getCancelTicket(s,ucfirst(t.target.getAttribute("class")));else for(let e=0;e<t.target.classList.length;e++)if(r.indexOf(-1!==t.target.classList[e])){a=getCancelTicket(s,ucfirst(t.target.classList[e]));break}i.innerHTML="Confirm "+t.target.innerText+":<br>",i.appendChild(a),i.appendChild(o)})}),Array.from(document.querySelectorAll(".transferTicket")).forEach(t=>{t.addEventListener("click",t=>{let r=e.getClosest(t.target,".page");Array.from(r.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")});let n=e.getClosest(t.target,".tickets");Array.from(n.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let l=n.querySelector(".message2"),a=getCancelThis(),i=getTransferTicket(t.target.getAttribute("form"));l.innerHTML="Confirm "+t.target.innerText+":<br>",l.appendChild(i);let o=document.createElement("input");o.setAttribute("name","pendingReceiver"),o.setAttribute("list","receivers"),o.classList.add("pendingReceiver"),l.appendChild(o),l.appendChild(a)})}),Array.from(document.querySelectorAll(".transferGroup")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r=e.getClosest(t.target,".page");Array.from(r.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")});let n=e.getClosest(t.target,".sortable");Array.from(n.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let l=n.querySelector("p.message2"),a=getCancelThis(),i=getTransferGroup();l.innerHTML="Confirm Transfer:<br>";let o=document.createElement("input");o.setAttribute("name","pendingReceiver"),o.setAttribute("list","receivers"),o.classList.add("pendingReceiver"),l.appendChild(i),l.appendChild(o),l.appendChild(a)})}),Array.from(document.querySelectorAll(".cancelTransfer, .declineTransfer, .acceptTransfer")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r=["cancelTransfer","declineTransfer","acceptTransfer"],n=e.getClosest(t.target,".page");Array.from(n.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")});let l=e.getClosest(t.target,".tickets");Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let a,i=l.querySelector(".message2"),o=getCancelThis();if(1===t.target.classList.length)a=getTransferButton(t.target.getAttribute("class"));else for(let e=0;e<t.target.classList.length;e++)if(r.indexOf(-1!==t.target.classList[e])){a=getTransferButton(t.target.classList[e]);break}i.innerHTML="Confirm "+t.target.innerText+":<br>",i.appendChild(a),i.appendChild(o)})}),Array.from(document.querySelectorAll(".acceptTransferGroup, .declineTransferGroup, .cancelTransferGroup")).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let r=["acceptTransferGroup","declineTransferGroup","cancelTransferGroup"],n=e.getClosest(t.target,".page");Array.from(n.querySelectorAll(".cancelThis")).forEach(t=>{e.triggerEvent(t,"click")});let l=e.getClosest(t.target,".sortable");Array.from(l.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let a,i=l.querySelector("p.message2"),o=getCancelThis();if(1===t.target.classList.length)a=getTransferAllButton(ucfirst(t.target.getAttribute("class")));else{for(let e=0;e<t.target.classList.length;e++)if(r.indexOf(-1!==t.target.classList[e])){a=getTransferAllButton(ucfirst(t.target.classList[e]));break}}i.innerHTML="Confirm "+t.target.innerText+":<br>",i.appendChild(a),i.appendChild(o)})}),document.querySelector("#ticketEditorSubmit")&&(document.querySelector("#ticketEditorSubmit").addEventListener("click",async r=>{r.preventDefault();let n=document.querySelector("#ticketEditorResultContainer"),l={},a=document.querySelector("#ticketEditor");if(Array.from(a.querySelectorAll("input[name], select")).forEach(e=>{l[e.getAttribute("name")]=e.value}),l.formKey=document.querySelector("#formKey").value,!l.dispatchedTo||!l.ticketEditorSearchDate)return!1;let i=document.createElement("span");i.classList.add("ellipsis"),i.innerHTML=".",n.innerHTML="",n.appendChild(i);let o=!0,s=setInterval(()=>{!0===o&&(i.innerHTML+="..",o=21>i.innerHTML.length&&1!=i.innerHTML.length),!1===o&&(i.innerHTML=i.innerHTML.substr(0,i.innerHTML.length-2),o=1===i.innerHTML.length)},500);await e.fetch_template({url:"./activeTickets.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(clearInterval(s),n.innerHTML=-1===r.indexOf("Session Error")?"":"<p class=\"center\">Select Driver &amp; Ticket Type</p>",-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=t.parseFromString(r,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll(".tickets")).forEach(e=>{a.appendChild(e)}),n.appendChild(a),assignTicketEditorListener()}).catch(e=>{console.error(e.message),clearInterval(s);let t=document.createElement("p");t.classList.add("center"),n.innerHTML="",n.appendChild(t),t.innerHTML="<span class=\"error\">Error</span>: "+e.message,setTimeout(()=>{t.innerHTML="Select Driver &amp; Ticket Type"},3500)})}),document.querySelector("#clearTicketEditorResults").addEventListener("click",e=>{e.preventDefault();let t=document.querySelector("#ticketEditor"),r=new Date,n=10>r.getDate()?`0${r.getDate()}`:r.getDate(),l=r.getMonth()+1,a=10>l?`0${l}`:l;t.querySelector(".dispatchedTo").value="",t.querySelector(".contract").value=0,t.querySelector("input.ticketEditorSearchDate").value=`${r.getFullYear()}-${a}-${n}`,document.querySelector("#ticketEditorResultContainer").innerHTML="<p class=\"center\">Select Driver &amp; Ticket Type</p>"})),document.querySelector("form#priceCalc")){let t=document.querySelector("form#priceCalc");t.querySelector(".dryIce").addEventListener("change",t=>{let r=e.getClosest(t.target,"td");t.target.checked?(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!1,r.querySelector(".diWeight").focus()):(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!0)}),Array.from(t.querySelectorAll("input[list]")).forEach(t=>{"Address1"===t.getAttribute("name").substr(1)&&t.addEventListener("blur",t=>{let r;Array.from(document.querySelectorAll("#addy1 option")).forEach(e=>{e.value===t.target.value&&(r=e.getAttribute("data-value"))}),"undefined"==typeof r||Array.from(document.querySelectorAll("#addy2 option")).forEach(n=>{n.getAttribute("data-value")===r&&(e.getClosest(t.target,"fieldset").querySelector("input[name='"+t.target.getAttribute("name").slice(0,-1)+"2']").value=n.value)})})}),t.querySelector(".clear").addEventListener("click",()=>{t.querySelector(".dryIce").checked=!1,e.triggerEvent(t.querySelector(".dryIce"),"change"),document.querySelector("#CalcCharge").value="0",Array.from(document.querySelectorAll("#pNotice, #dNotice, #rangeResult, #diWeightResult, #diPriceResult, #runPriceResult, #ticketPriceResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.style.display="none"}),Array.from(document.querySelectorAll("#price_calculator .elementError")).forEach(e=>e.classList.remove("elementError")),e.updateMap({mapDivID:"map2"})}),t.querySelector(".submitPriceQuery").addEventListener("click",async r=>{r.preventDefault(),Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!0});let n=!1,l={},a=document.createElement("span");a.classList.add("ellipsis"),a.innerHTML=".",t.querySelector(".ticketError").innerHTML="",t.querySelector(".ticketError").appendChild(a);let i=!0,o=setInterval(()=>{!0===i&&(a.innerHTML+="..",i=21>a.innerHTML.length&&1!=a.innerHTML.length),!1===i&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-2),i=1===a.innerHTML.length)},500);return l.formKey=document.querySelector("#formKey").value,Array.from(t.querySelectorAll("input[name]")).forEach(e=>{e.getAttribute("list")&&!1===e.disabled&&""===e.value?(n=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3500)):!1===e.disabled&&"checkbox"!==e.type&&(l[e.getAttribute("name")]=e.value),"checkbox"===e.type&&(l[e.getAttribute("name")]=e.checked?1:0)}),1===l.dryIce&&("0"===l.diWeight||0!=l.diWeight%t.querySelector(".diWeight").getAttribute("step"))&&(n=!0,t.querySelector(".diWeight").classList.add("elementError"),t.querySelector(".ticketError").innerHTML="Dry Ice must be in increments of "+t.querySelector(".diWeight").getAttribute("step")),n?(clearInterval(o),setTimeout(()=>{Array.from(t.querySelectorAll("button, .elementError")).forEach(e=>{e.disabled=!1,e.classList.remove("elementError")}),t.querySelector(".ticketError").innerHTML=""},3500),!1):void(await e.fetch_template({url:"../priceCalc.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(clearInterval(o),t.querySelector(".ticketError").innerHTML="",-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,Array.from(document.querySelectorAll("#pNotice, #dNotice, #CalcError")).forEach(e=>{e.innerHTML=""});let n;try{n=JSON.parse(r)}catch(e){return document.querySelector("#CalcError").innerHTML=e.message,setTimeout(()=>{document.querySelector("#CalcError").innerText=""},3500),!1}Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.remove("hide")}),document.querySelector("#rangeResult").innerText=n.rangeDisplay,document.querySelector("#diWeightResult").innerText=n.diWeight,document.querySelector("#runPriceResult").innerText=n.runPrice,document.querySelector("#diPriceResult").innerText=n.diPrice,document.querySelector("#ticketPriceResult").innerText=n.ticketPrice,15<n.pRangeTest&&20>n.pRangeTest?document.querySelector("#pNotice").innerText="Pick Up address is outside of our standard range. Please call to confirm availability.":20<n.pRangeTest&&(document.querySelector("#pNotice").innerText="Pick Up address is outside of our extended range.",Array.from(document.querySelectorAll("#runPriceResult, #ticketPriceResult, #diPriceResult, #diWeightResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.add("hide")})),15<n.dRangeTest&&20>n.dRangeTest?document.querySelector("#dNotice").innerText="Delivery address is outside of our standard range. Please call to confirm availability.":20<n.dRangeTest&&(document.querySelector("#dNotice").innerText="Delivery address is outside of our extended range.",Array.from(document.querySelectorAll("#runPriceResult, #ticketPriceResult, #diPriceResult, #diWeightResult")).forEach(e=>{e.innerText=""}),Array.from(document.querySelectorAll("#priceResult .currencySymbol, #priceResult .weightMarker")).forEach(e=>{e.classList.add("hide")})),Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!1}),e.updateMap({mapDivID:"map2",coords1:n.result1,address1:n.address1,coords2:n.result2,address2:n.address2,center:n.center})}).catch(e=>{console.error(e.message),clearInterval(o),t.querySelector(".ticketError").innerHTML="<span class=\"error\">Error</span>: "+e.message,setTimeout(()=>{t.querySelector(".ticketError").innerHTML="",Array.from(t.querySelectorAll("button")).forEach(e=>{e.disabled=!1})},3500)}))})}document.querySelector(".PWcontainer")&&(document.querySelector(".PWcontainer .showText").addEventListener("change",t=>{Array.from(e.getClosest(t.target,"form").querySelectorAll("input.currentPw, .newPw1, .newPw2")).forEach(e=>{e.type=t.target.checked?"text":"password"})}),document.querySelector(".clearPWform").addEventListener("click",t=>{e.getClosest(t.target,"form").querySelector(".showText").checked=!1,e.triggerEvent(e.getClosest(t.target,"form").querySelector(".showText"),"change")}),Array.from(document.querySelectorAll(".newPw1, .newPw2, .currentPw")).forEach(t=>{t.addEventListener("change",t=>{let r=e.getClosest(t.target,".PWform"),n=r.querySelector(".PWsubmit"),l=r.querySelector(".currentPw").value,a=r.querySelector(".newPw1").value,i=r.querySelector(".newPw2").value,o=document.createElement("p"),s=document.createElement("p"),c=document.createElement("p");if(o.classList.add("error1"),o.innerHTML="<span class=\"error\">Error</span>: Password does not meet criteria.",s.classList.add("error2"),s.innerHTML="<span class=\"error\">Error</span>: Password missmatch.",c.classList.add("error3"),c.innerHTML="<span class=\"error\">Error:</span> Password should be changed.",""!==a){if(!!/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^\&*\)\(\{\}\[\]\-_.=+\?\:;,])(?=.{8,}).*$/.test(a))null!==r.querySelector(".message .error1")&&r.querySelector(".message").removeChild(r.querySelector(".message .error1")),null===r.querySelector(".message p")&&(n.disabled=!1);else if(null!==r.querySelector(".message .error1"))return r.querySelector(".message").appendChild(o),n.disabled=!0,!1;""!==l&&a===l?null===r.querySelector(".message .error3")&&(r.querySelector(".message").appendChild(c),n.disabled=!0):(null!==r.querySelector(".message .error3")&&r.querySelector(".message").removeChild(r.querySelector(".message .error3")),null===r.querySelector(".message p")&&(n.disabled=!1))}else null!==r.querySelector(".message .error1")&&r.querySelector(".message").removeChild(r.querySelector(".message .error1")),null===r.querySelector(".message p")&&(n.disabled=!1);""===i?(null!==r.querySelector(".message .error2")&&r.querySelector(".message").removeChild(r.querySelector(".message .error2")),null===r.querySelector(".message p")&&(n.disabled=!1)):a===i?(null!==r.querySelector(".message .error2")&&r.querySelector(".message").removeChild(r.querySelector(".message .error2")),null===r.querySelector(".message p")&&(n.disabled=!1)):(null===r.querySelector(".message .error2")&&r.querySelector(".message").appendChild(s),n.disabled=!0)})}),Array.from(document.querySelectorAll(".PWsubmit")).forEach(t=>{t.addEventListener("click",async t=>{t.preventDefault(),t.target.disabled=!0;let r=e.getClosest(t.target,".PWform"),n={},l=document.createElement("span");l.classList.add("ellipsis"),l.innerHTML=".",r.querySelector(".message").innerHTML="",r.querySelector(".message").appendChild(l);let a=!0,i=setInterval(()=>{!0===a&&(l.innerHTML+="..",a=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===a&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),a=1===l.innerHTML.length)},500);n.formKey=document.querySelector("#formKey").value,Array.from(r.querySelectorAll("input[name]")).forEach(e=>{n[e.getAttribute("name")]=e.value}),await e.fetch_template({url:"./changePW.php",postData:n}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(l=>(clearInterval(i),-1===l.indexOf("Session Error")?void(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,r.querySelector(".message").innerHTML=l,setTimeout(()=>{if(Array.from(r.querySelectorAll(".currentPw, .newPw1, .newPw2")).forEach(e=>{e.value=""}),r.querySelector(".message").innerHTML="",r.querySelector(".currentPw").focus(),t.target.disabled=!1,"driver"!==n.flag&&"dispatch"!==n.flag){let r,a=e.getClosest(t.target,".page"),i=!1;switch(n.flag){case"daily":r=document.querySelector("a[data-id='change_password']"),i="!Delivery1"===n.newPw1;break;case"admin":r=document.querySelector("a[data-id='change_admin_password']"),i="!Delivery2"===n.newPw1;break;case"org":r=document.querySelector("a[data-id='change_password']"),i="3Delivery!"===n.newPw1;}-1!==l.search("Password Updated")&&(!0===i?(a.querySelector(".defaultWarning").classList.remove("hide"),r.querySelector(".PWalert").innerText="!"):(!a.querySelector(".defaultWarning").classList.contains("hide")&&a.querySelector(".defaultWarning").classList.add("hide"),r.querySelector(".PWalert").innerText=""))}},4e3)):e.showLogin())).catch(e=>{console.error(e.message),clearInterval(i),r.querySelector(".message").innerHTML="<span class=\"error\">Error</span>: "+e.message,setTimeout(()=>{r.querySelector(".message").innerHTML="",t.target.disabled=!1},3500)})})})),document.querySelector("#invoiceQueryOptions")&&(document.querySelector("#useInvoice")&&document.querySelector("#useInvoice").addEventListener("change",t=>{document.querySelector("#invoiceNumber").disabled=!1===t.target.checked,e.getClosest(t.target,"#singleInvoiceQuery").querySelector(".dateIssuedMonth").disabled=!0===t.target.checked,e.getClosest(t.target,"#singleInvoiceQuery").querySelector(".dateIssuedMonth").required=!1===t.target.checked}),Array.from(document.querySelectorAll("#single, #multi")).forEach(e=>{e.addEventListener("click",e=>{e.target.checked||e.preventDefault()}),e.addEventListener("change",e=>{let t=[];Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(r=>{r.checked&&t.push(r),r.checked=!1,r.setAttribute("form",e.target.getAttribute("form"))});let r="single"===e.target.getAttribute("id")?"multi":"single",n=document.querySelector("#"+r).getAttribute("form");"single"==r&&(document.querySelector("#compareMembers").disabled=!0),e.target.checked&&(document.querySelector("#"+r).checked=!1),0<t.length&&(t[0].checked=!0),document.querySelector("button[form='"+e.target.getAttribute("form")+"']").disabled=!1,document.querySelector("button[form='"+n+"']").disabled=!0})}),Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(e=>{e.addEventListener("change",e=>{let t=0;Array.from(document.querySelectorAll("#invoiceQueryOptions .orgMember")).forEach(r=>{document.querySelector("#single").checked?r.checked=r===e.target:t+=r.checked}),document.querySelector("#compareMembers").disabled=2>t})}),document.querySelector("#single")&&e.triggerEvent(document.querySelector("#single"),"change"),Array.from(document.querySelectorAll("#singleInvoice, #rangeInvoice")).forEach(r=>{r.addEventListener("click",async r=>{r.preventDefault(),r.target.disabled=!0;let n=!1,l={},a=document.createElement("span"),i=document.createElement("p");i.classList.add("center"),a.innerHTML=".",i.appendChild(a),document.querySelector("#invoiceQueryResults").innerHTML="",document.querySelector("#invoiceQueryResults").appendChild(i);let o=!0,s=setInterval(()=>{!0===o&&(a.innerHTML+="..",o=21>a.innerHTML.length&&1!=a.innerHTML.length),!1===o&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-2),o=1===a.innerHTML.length)},500);return Array.from(document.querySelectorAll("input[form='"+r.target.getAttribute("form")+"'], select[form='"+r.target.getAttribute("form")+"']")).forEach(e=>{e.required&&""===e.value&&(n=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),"[]"===e.getAttribute("name").slice(-2)?"undefined"==typeof l[e.getAttribute("name").slice(0,-2)]?"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&(l[e.getAttribute("name").slice(0,-2)]=[e.value]):!1===e.disabled&&(l[e.getAttribute("name").slice(0,-2)]=[e.value]):"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&l[e.getAttribute("name").slice(0,-2)].push(e.value):!1===e.disabled&&l[e.getAttribute("name").slice(0,-2)].push(e.value):"checkbox"===e.type?!0===e.checked&&!1===e.disabled&&(l[e.getAttribute("name")]=e.value):!1===e.disabled&&(l[e.getAttribute("name")]=e.value)}),n?(clearInterval(s),document.querySelector("#invoiceQueryResults").removeChild(i),r.target.disabled=!1,!1):void(l.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./buildQuery.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(n=>{if(clearInterval(s),document.querySelector("#invoiceQueryResults").removeChild(i),-1!==n.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=t.parseFromString(n,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll("#invoiceChartPDFform, .bargraph, .graphKey, #invoice, .invoiceTable, p.displayHeader, .result")).forEach(e=>{a.appendChild(e)}),document.querySelector("#invoiceQueryResults").appendChild(a),r.target.disabled=!1,assignQueriedInvoiceListeners()}).catch(e=>{console.error(e.message),clearInterval(s),document.querySelector("#invoiceQueryResults").innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{document.querySelector("#invoiceQueryResults").innerHTML="",r.target.disabled=!1},3500)}))})})),document.querySelector("#deliveryQuery")&&(Array.from(document.querySelectorAll("#deliveryQuery .orgMember")).forEach(t=>{t.addEventListener("change",t=>{e.disableButtonsTickets(),t.target.checked?(document.querySelector("#ticketNumber").value="",document.querySelector("#ticketNumber").readOnly=!0,e.triggerEvent(document.querySelector("#ticketNumber"),"change")):document.querySelector("#ticketNumber").readOnly="chart"===document.querySelector("#display").value})}),document.querySelector("#display")&&document.querySelector("#display").addEventListener("change",e=>{document.querySelector("#compareBox")&&Array.from(document.querySelectorAll("#compareBox, #compareMembersTickets")).forEach(t=>{t.disabled="tickets"===e.target.value,"tickets"===e.target.value&&(t.checked=!1)}),document.querySelector("#ticketNumber").disabled="chart"===e.target.value||"tickets"===e.target.value&&!0===document.querySelector("#allTime").checked,Array.from(document.querySelectorAll("#chargeHistory, #type")).forEach(t=>{t.disabled="chart"===e.target.value}),Array.from(document.querySelectorAll("#deliveryQuery .ticketDate, #deliveryQuery .chartDate")).forEach(t=>{"tickets"===e.target.value?(t.style.display=t.classList.contains("ticketDate")?"inline-block":"none",t.querySelector("input")&&Array.from(t.querySelectorAll("input")).forEach(e=>{e.disabled=e.classList.contains("startDateMonth")||e.classList.contains("endDateMonth"),e.value="",!1===e.disabled&&(e.disabled=document.querySelector("#allTime").checked)})):(t.style.display=t.classList.contains("ticketDate")?"none":"inline-block",t.querySelector("input")&&Array.from(t.querySelectorAll("input")).forEach(e=>{e.disabled=!e.classList.contains("startDateMonth")&&!e.classList.contains("endDateMonth"),e.value="",!1===e.disabled&&(e.disabled=document.querySelector("#allTime").checked)}))})}),document.querySelector("#allTime").addEventListener("change",t=>{let r=document.querySelector("#display")&&"chart"===document.querySelector("#display").value?".chartDate":".ticketDate";!0===t.target.checked?Array.from(e.getClosest(t.target,"form").querySelectorAll(r+" input, #ticketNumber")).forEach(e=>{e.value="",e.disabled=!0}):(Array.from(e.getClosest(t.target,"form").querySelectorAll(r+" input")).forEach(e=>{e.disabled=!1}),document.querySelector("#ticketNumber").disabled=!!document.querySelector("#display")&&"chart"===document.querySelector("#display").value)}),document.querySelector("#ticketNumber").addEventListener("blur",t=>{""===t.target.value?(Array.from(document.querySelectorAll("#deliveryQuery .startDateDate, #deliveryQuery .endDateDate, #chargeHistory, #charge, #type, #allTime, #display, #compareBox, #compareMembersTickets, #deliveryQuery .orgMember")).forEach(e=>{e.disabled=!1,e.required=e.classList.contains("startDate")||e.classList.contains("endDate")}),Array.from(document.querySelectorAll("#deliveryQuery .startDateMarker, #deliveryQuery .endDateMarker, #deliveryQuery .chargeMarker, #deliveryQuery .typeMarker, #displayMarker")).forEach(e=>{e.disabled=!0})):(document.querySelector("#display")&&(document.querySelector("#display").value="tickets",e.triggerEvent(document.querySelector("#display"),"change")),Array.from(document.querySelectorAll("#deliveryQuery .startDateDate, #deliveryQuery .endDateDate, #chargeHistory, #charge, #type, #allTime, #display, #compareBox, #compareMembersTickets, #deliveryQuery .orgMember")).forEach(e=>{e.disabled=!0,e.checked=!1,e.required=!1}),Array.from(document.querySelectorAll("#deliveryQuery .startDateMarker, #deliveryQuery .endDateMarker, #deliveryQuery .chargeMarker, #deliveryQuery .typeMarker, #displayMarker")).forEach(e=>{e.disabled=!1}))}),document.querySelector(".submitOrgTickets")?document.querySelector(".submitOrgTickets").addEventListener("click",async r=>{r.preventDefault();let n={},l=document.createElement("span"),a=document.createElement("p");n.formKey=document.querySelector("#formKey").value,a.classList.add("center"),l.innerHTML=".",a.appendChild(l),document.querySelector("#ticketQueryResults").appendChild(a);let i=!0,o=setInterval(()=>{!0===i&&(l.innerHTML+="..",i=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===i&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),i=1===l.innerHTML.length)},500);Array.from(document.querySelectorAll("#deliveryQuery input, #deliveryQuery select")).forEach(e=>{e.disabled||e.readOnly||("[]"===e.getAttribute("name").slice(-2)?("checkbox"===e.getAttribute("type")&&e.checked||"checkbox"!==e.getAttribute("type")&&""!==e.value)&&("undefined"==typeof n[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]?n[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]=[e.value]:("object"==typeof n[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)]||"array"==typeof n[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)])&&n[e.getAttribute("name").slice(0,e.getAttribute("name").length-2)].push(e.value)):"checkbox"===e.getAttribute("type")?e.checked&&(n[e.getAttribute("name")]=e.value):n[e.getAttribute("name")]=e.value)}),await e.fetch_template({url:"./buildQuery.php",postData:n}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(n=>{if(r.target.disabled=!1,clearInterval(o),-1!==n.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=t.parseFromString(n,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll("#ticketPDFform, .tickets, .ticketTable, .bargraph, .graphKey, .result")).forEach(e=>{a.appendChild(e)}),document.querySelector("#ticketQueryResults").innerHTML="",document.querySelector("#ticketQueryResults").appendChild(a),e.assignQueriedTicketListeners()}).catch(e=>{console.error(e.message),r.target.disabled=!1,clearInterval(o),document.querySelector("#ticketQueryResults").innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{document.querySelector("#ticketQueryResults").innerHTML=""},3500)})}):(document.querySelector(".clearTicketResults").addEventListener("click",()=>{document.querySelector("#ticketQueryResults").innerHTML=""}),document.querySelector(".resetTicketQuery").addEventListener("click",()=>{document.querySelector("#display").value="tickets",e.triggerEvent(document.querySelector("#display"),"change"),Array.from(document.querySelectorAll("#deliveryQuery .elementError")).forEach(e=>{e.classList.remove("elementError")})}),document.querySelector(".submitTicketQuery").addEventListener("click",async r=>{r.preventDefault(),r.target.disabled=!0;let n=!1,l={},a=document.createElement("span"),i=document.createElement("p");if(i.classList.add("center"),a.innerHTML=".",i.appendChild(a),Array.from(document.querySelectorAll("#deliveryQuery input, #deliveryQuery select")).forEach(e=>{e.disabled||("checkbox"===e.type?l[e.getAttribute("name")]=e.checked?1:0:e.value&&(l[e.getAttribute("name")]=e.value))}),l.hasOwnProperty("ticketNumber")||l.allTime?!l.ticketNumber&&!l.allTime&&(n=!0,document.querySelector("#ticketNumber").classList.add("elementError"),setTimeout(()=>{document.querySelector("#ticketNumber").classList.remove("elementError")},3500)):(!l.hasOwnProperty("startDate")||!l.startDate||!l.hasOwnProperty("endDate")||!l.endDate)&&(n=!0,Array.from(document.querySelectorAll("#deliveryQuery input[name='startDate'], #deliveryQuery input[name='endDate']")).forEach(e=>{e.value||(e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3500))})),l.formKey=document.querySelector("#formKey").value,n)return r.target.disabled=!1,!1;document.querySelector("#ticketQueryResults").appendChild(i);let o=!0,s=setInterval(()=>{!0===o&&(a.innerHTML+="..",o=21>a.innerHTML.length&&1!=a.innerHTML.length),!1===o&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-2),o=1===a.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(n=>{if(r.target.disabled=!1,clearInterval(s),-1!==n.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=t.parseFromString(n,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll("#ticketPDFform, .bargraph, .graphKey, .tickets, .ticketTable, .ticketGraphContainer, .result")).forEach(e=>{a.appendChild(e)}),document.querySelector("#ticketQueryResults").innerHTML="",document.querySelector("#ticketQueryResults").appendChild(a),e.assignQueriedTicketListeners()}).catch(e=>{console.error(e.message),r.target.disabled=!1,clearInterval(s),document.querySelector("#ticketQueryResults").innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{document.querySelector("#ticketQueryResults").innerHTML=""},3500)})}))),document.querySelector("#clientUpdateForm")&&(document.querySelector("#same").addEventListener("change",t=>{Array.from(document.querySelectorAll("input[name='BillingName'], input[name='BillingAddress1'], input[name='BillingAddress2'], input[name='BillingCountry']")).forEach(e=>{e.disabled=!0===t.target.checked,e.required=!1===t.target.checked}),Array.from(document.querySelectorAll("fieldset[name='billingInfo'] .error")).forEach(e=>{e.style.display=!0===t.target.checked?"none":"inline"}),e.getClosest(document.querySelector("input[name='BillingCountry'][form='clientUpdate']"),"tr").classList.contains("hide")&&(document.querySelector("input[name='BillingCountry'][form='clientUpdate']").value=document.querySelector("input[name='ShippingCountry'][form='clientUpdate']").value)}),document.querySelector("#enableInfoUpdate").addEventListener("change",e=>{document.querySelector("#submitInfoUpdate").disabled=!1===e.target.checked}),document.querySelector("#submitInfoUpdate").addEventListener("click",async r=>{r.preventDefault(),r.target.disabled=!0;let n={},l=!1,a=document.createElement("span");a.classList.add("ellipsis"),a.innerHTML=".",document.querySelector("#clientUpdateResult").appendChild(a);let i=!0,o=setInterval(()=>{!0===i&&(a.innerHTML+=".",i=21>a.innerHTML.length&&1!=a.innerHTML.length),!1===i&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-2),i=1===a.innerHTML.length)},500);return Array.from(document.querySelectorAll("input[form='"+r.target.getAttribute("form")+"']")).forEach(e=>{!0===e.required&&""===e.value&&(console.log(e),l=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3)),!1===e.disabled&&(n[e.getAttribute("name")]=e.value),"checkbox"===e.type&&(n[e.getAttribute("name")]=!0===e.checked?1:0)}),!0==l?(clearInterval(o),r.target.disabled=!1,document.querySelector("#clientUpdateResult").removeChild(a),!1):void(n.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./updateClientInfo.php",postData:n}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(n=>{if(r.target.disabled=!1,clearInterval(o),-1!==n.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=t.parseFromString(n,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll(".result")).forEach(e=>{a.appendChild(e)}),document.querySelector("#clientUpdateResult").innerHTML="",document.querySelector("#clientUpdateResult").appendChild(a),setTimeout(()=>{document.querySelector("#clientUpdateResult").innerHTML="",document.querySelector("#enableInfoUpdate").checked=!1,e.triggerEvent(document.querySelector("#enableInfoUpdate"),"change")},3500)}).catch(e=>{console.error(e.message),r.target.disabled=!1,clearInterval(o),document.querySelector("#clientUpdateResult").innerHTML="<span class=\"error\">Error</span>: "+e.message,setTimeout(()=>{document.querySelector("#clientUpdateResult").innerHTML=""},3500)}))}))},assignQueriedInvoiceListeners=()=>{document.querySelector("#invoicePDF")&&document.querySelector("#invoicePDF").addEventListener("click",e=>{e.preventDefault();let t,r=document.querySelector("#invoice").cloneNode(!0),n={},l=["position","top","left","right","font-size"];if(null!==document.querySelector("#invoice .vatNotice"))for(let e in t=getComputedStyle(document.querySelector("#invoice .vatNotice")),t)-1!==l.indexOf(e)&&(n[e]=t.getPropertyValue(e));r.querySelector("#invoicePDFform").remove(),Array.from(r.querySelectorAll(".vatNotice")).forEach(e=>{for(let t in e.parentNode.style.position="relative",n)e.style[t]=n[t]}),document.querySelector("#invoicePDFform input[name='content']").value=r.outerHTML,document.querySelector("#invoicePDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,document.querySelector("#invoicePDFform").submit()}),document.querySelector("#invoiceChartPDF")&&document.querySelector("#invoiceChartPDF").addEventListener("click",t=>{t.preventDefault();let r=document.querySelector("#invoiceQueryResults").cloneNode(!0);r.querySelector("#invoiceChartPDFform").remove(),Array.from(r.querySelectorAll(".invoiceQuery")).forEach(t=>{let r=e.getClosest(t,"td"),n=t.innerHTML,l=Array.from(t.classList);r.classList.add(...l),r.innerHTML=n}),document.querySelector("#invoiceChartPDFform input[name='content']").value=r.outerHTML,document.querySelector("#invoiceChartPDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,document.querySelector("#invoiceChartPDFform").submit()}),Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceQuery")).forEach(r=>{r.addEventListener("click",async r=>{r.preventDefault(),r.target.classList.add("red"),r.target.disabled=!0,setTimeout(()=>{r.target.classList.remove("red")},3500);let n={},l=document.createElement("p");l.classList.add("center"),l.innerHTML=".",e.getClosest(r.target,".invoiceTable").appendChild(l);let a=!0,i=setInterval(()=>{!0===a&&(l.innerHTML+="..",a=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===a&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),a=1===l.innerHTML.length)},500);Array.from(e.getClosest(r.target,"form").querySelectorAll("input")).forEach(e=>{n[e.getAttribute("name")]=e.value}),n.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./buildQuery.php",postData:n}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let n=t.parseFromString(r,"text/html"),l=document.createDocumentFragment();Array.from(n.querySelectorAll("#invoice, .invoiceTable, .invoiceGraphContainer, p.displayHeader, .result")).forEach(e=>{l.appendChild(e)}),document.querySelector("#invoiceQueryResults").innerHTML="",document.querySelector("#invoiceQueryResults").appendChild(l)}).catch(t=>{console.log(t.message),clearInterval(i),e.getClosest(r.target,".invoiceTable").removeChild(l),errorMessage=document.createElement("p"),errorMessage.classList.add("center"),errorMessage.innerHTML="<span class=\"error\">Error</span>: "+t.message,e.getClosest(r.target,".invoiceTable").appendChild(errorMessage),setTimeout(()=>{e.getClosest(r.target,".invoiceTable").removeChild(errorMessage),r.target.disabled=!1},3500)})})}),document.querySelector("#invoiceQueryResults .invoiceTable")&&(Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceTable, #invoiceQueryResults .invoiceGraphContainer")).forEach(e=>{e.addEventListener("touchstart",()=>{rjdciSwipe.disable()})}),Array.from(document.querySelectorAll("#invoiceQueryResults .invoiceTable, #invoiceQueryResults .invoiceGraphContainer")).forEach(e=>{e.addEventListener("touchend",()=>{rjdciSwipe.enable()})}))},e.assignQueriedTicketListeners=()=>{Array.from(document.querySelectorAll("#ticketQueryResults .invoiceQuery")).forEach(r=>{r.addEventListener("click",async r=>{r.preventDefault();let n={};Array.from(e.getClosest(r.target,"form").querySelectorAll("input")).forEach(e=>{n[e.getAttribute("name")]=e.value}),n.formKey=document.querySelector("#formKey").value,document.querySelector("#invoiceQueryResults").innerHTML="<p class=\"center\"><span class=\"ellipsis\">.</span></p>",rjdciSwipe.slide(document.querySelector("a.nav[data-id='invoice_query']").getAttribute("data-value"),300);let l=!0,a=document.querySelector("#invoiceQueryResults .ellipsis"),i=setInterval(()=>{!0===l&&(a.innerHTML+="..",l=21>a.innerHTML.length&&1!=a.innerHTML.length),!1===l&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-2),l=1===a.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:n}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(clearInterval(i),-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let n=t.parseFromString(r,"text/html"),l=document.createDocumentFragment();Array.from(n.querySelectorAll("#invoice, .result")).forEach(e=>{l.appendChild(e)}),document.querySelector("#invoiceQueryResults").innerHTML="",document.querySelector("#invoiceQueryResults").appendChild(l),assignQueriedInvoiceListeners()}).catch(e=>{console.error(e.message),clearInterval(i),document.querySelector("#invoiceQueryResults").innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{document.querySelector("#invoiceQueryResults").innerHTML=""},3500)})})}),Array.from(document.querySelectorAll("#ticketQueryResults .sigPrint td")).forEach(e=>{e.addEventListener("click",e=>{let t=e.target.parentElement.nextElementSibling;t.style.display="none"===t.style.display||""===t.style.display?"block":"none"})}),Array.from(document.querySelectorAll("#ticketQueryResults .submitTicketQuery")).forEach(r=>{r.addEventListener("click",async r=>{r.preventDefault(),r.target.disabled=!0;let n={},l=document.createElement("span"),a=document.createElement("p");a.classList.add("center"),l.innerHTML=".",a.appendChild(l),Array.from(e.getClosest(r.target,"form").querySelectorAll("input")).forEach(e=>{e.value&&(n[e.getAttribute("name")]=e.value)}),n.formKey=document.querySelector("#formKey").value;document.querySelector("#ticketQueryResults").appendChild(a);let i=!0,o=setInterval(()=>{!0===i&&(l.innerHTML+="..",i=21>l.innerHTML.length&&1!=l.innerHTML.length),!1===i&&(l.innerHTML=l.innerHTML.substr(0,l.innerHTML.length-2),i=1===l.innerHTML.length)},500);await e.fetch_template({url:"./buildQuery.php",postData:n}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(n=>{if(r.target.disabled=!1,clearInterval(o),-1!==n.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=t.parseFromString(n,"text/html"),a=document.createDocumentFragment();Array.from(l.querySelectorAll(".tickets, .result")).forEach(e=>{a.appendChild(e)}),document.querySelector("#ticketQueryResults").innerHTML="",document.querySelector("#ticketQueryResults").appendChild(a),e.assignQueriedTicketListeners()}).catch(e=>{console.error(e.message),r.target.disabled=!1,clearInterval(o),document.querySelector("#ticketQueryResults").innerHTML="<p class=\"center\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{document.querySelector("#ticketQueryResults").innerHTML=""},3500)})})}),document.querySelector("#ticketPDF")&&document.querySelector("#ticketPDF").addEventListener("click",e=>{e.preventDefault();let t=document.querySelector("#ticketQueryResults").cloneNode(!0);t.querySelector("#ticketPDF").remove(),Array.from(t.querySelectorAll(".submitTicketQuery")).forEach(e=>{e.parentNode.remove()}),document.querySelector("#ticketPDFform input[name='content']").value=t.outerHTML,document.querySelector("#ticketPDFform input[name='formKey']").value=document.querySelector("#formKey").value,document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,document.querySelector("#ticketPDFform").submit()}),document.querySelector("#ticketQueryResults .bargraph")&&(document.querySelector("#ticketQueryResults .bargraph").addEventListener("touchstart",()=>{rjdciSwipe.disable()}),document.querySelector("#ticketQueryResults .bargraph").addEventListener("touchend",()=>{rjdciSwipe.enable()}))},assignTicketEditorListener=()=>{Array.from(document.querySelectorAll("#ticketEditorResultContainer button.ticketEditor")).forEach(r=>{r.getAttribute("data-assigned")||(r.setAttribute("data-assigned",1),r.addEventListener("click",async r=>{r.target.classList.add("red"),setTimeout(()=>{r.target.classList.remove("red")},3e3);let n=e.getClosest(r.target,".sortable"),l={};l.ticket_index=r.target.getAttribute("data-index"),l.ticketEditor=1,l.formKey=document.querySelector("#formKey").value,await e.fetch_template({url:"./enterTicket.php",postData:l}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(r=>{if(-1!==r.indexOf("Session Error"))return e.showLogin();document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1;let l=t.parseFromString(r,"text/html"),a=document.createDocumentFragment();if(Array.from(n.querySelectorAll("table, hr, button.ticketEditor")).forEach(e=>{e.classList.add("hide")}),Array.from(l.querySelectorAll(".removableByEditor")).forEach(e=>{a.appendChild(e)}),n.appendChild(a),n.parentNode.querySelector("datalist"))for(;n.parentNode.querySelector("datalist");)n.parentNode.removeChild(n.parentNode.querySelector("datalist"));Array.from(l.querySelectorAll("datalist")).forEach(e=>{n.parentNode.prepend(e)}),assignTicketFormListeners(n)}).catch(e=>{console.error(e.message);let t=document.createElement("p");t.classList.add("center"),t.innerHTML="<span class=\"error\">Error</span>: "+e.message,n.appendChild(t),setTimeout(()=>{n.removeChild(t)},3500)})}))})},assignTicketFormListeners=r=>{let n=e=>{r.querySelector(".billTo").setAttribute("list",e.target.checked?"t_clients":"clients"),r.querySelector(".billTo").value="",r.querySelector("checkbox.contract")&&(r.querySelector(".contract").disabled=e.target.checked,e.target.checked&&(r.querySelector(".contract").checked=!1))};r.querySelector(".repeat")&&(r.querySelector(".repeat").removeEventListener("change",n),r.querySelector(".repeat").addEventListener("change",n));let l=t=>{let r=e.getClosest(t.target,"form");"0"===t.target.value?(r.querySelector(".emailAddress").required=!1,r.querySelector(".emailNote")&&r.querySelector(".emailNote").classList.add("hide")):(r.querySelector(".emailAddress").required=!0,r.querySelector(".emailNote")&&r.querySelector(".emailNote").classList.remove("hide"))};r.querySelector(".emailConfirm").removeEventListener("change",l),r.querySelector(".emailConfirm").addEventListener("change",l);let a=t=>{let r=e.getClosest(t.target,"fieldset");t.target.checked?(r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!1,r.querySelector(".diWeight").focus(),r.querySelector(".diWeightMarker").value="0",r.querySelector(".diWeightMarker").disabled=!0):(r.querySelector(".diWeightMarker").value="0",r.querySelector(".diWeightMarker").disabled=!1,r.querySelector(".diWeight").value="0",r.querySelector(".diWeight").disabled=!0)};Array.from(r.querySelectorAll(".dryIce")).forEach(e=>{e.removeEventListener("change",a),e.addEventListener("change",a)});let i=t=>{Array.from(r.querySelectorAll(".rtMarker")).forEach(e=>{"6"===t.target.value||"7"===t.target.value?e.style.display="inline":(e.style.display="none",e.checked=!1)}),r.querySelector("input[name='d2TimeStamp']")&&(r.querySelector("input[name='d2TimeStamp']").disabled="6"!==t.target.value&&"7"!==t.target.value),"7"===t.target.value?(r.querySelector(".dedicatedNote").style.display="block",Array.from(r.querySelectorAll("input[id^='pSigReq'], input[id^='dSigReq']")).forEach(t=>{t.checked=!0,e.triggerEvent(t,"change")})):r.querySelector(".dedicatedNote").style.display="none"};Array.from(r.querySelectorAll(".charge")).forEach(e=>{e.removeEventListener("change",i),e.addEventListener("change",i)}),Array.from(r.querySelectorAll("input[type='number']")).forEach(e=>{e.addEventListener("keydown",()=>{"0"===e.value&&(e.value="")})}),Array.from(r.querySelectorAll("input[type='checkbox'][name='pSigReq'], input[type='checkbox'][name='dSigReq']")).forEach(e=>{e.addEventListener("click",e=>{"7"===r.querySelector(".charge").value&&e.preventDefault()})}),Array.from(r.querySelectorAll("input[type='checkbox'][name='pSigReq'], input[type='checkbox'][name='dSigReq'], input[type='checkbox'][name='d2SigReq']")).forEach(e=>{e.addEventListener("change",()=>{let e=r.querySelector("input[type='checkbox'][name='pSigReq']").checked,t=r.querySelector("input[type='checkbox'][name='dSigReq']").checked,n=r.querySelector("input[type='checkbox'][name='d2SigReq']").checked,l=r.querySelector(".sigNote");e||t||n?l.classList.remove("hide"):!l.classList.contains("hide")&&l.classList.add("hide")})}),Array.from(r.querySelectorAll("input[list]")).forEach(t=>{t.addEventListener("change",t=>{if(e.isTarget(t.target)){let r=[];if(Array.from(document.querySelectorAll("datalist#"+t.target.getAttribute("list")+" option")).forEach(e=>{let t=new DOMParser().parseFromString(e.innerHTML,"text/html");t.innerHTML=e.innerHTML,r.push(t.documentElement.textContent)}),""!==t.target.value&&-1===r.indexOf(t.target.value)){let r=t.target.getAttribute("placeholder")||"";return t.target.value="",t.target.classList.add("elementError"),t.target.placeholder="Selection Not On File",e.triggerEvent(t.target,"change"),void setTimeout(()=>{t.target.classList.remove("elementError"),t.target.placeholder=r},3e3)}}t.target.title=t.target.value}),"Address1"===t.getAttribute("name").substr(1)&&t.addEventListener("blur",t=>{let r;Array.from(document.querySelectorAll("#addy1 option")).forEach(e=>{e.value===t.target.value&&(r=e.getAttribute("data-value"))});"undefined"==typeof r||Array.from(document.querySelectorAll("#addy2 option")).forEach(n=>{n.getAttribute("data-value")===r&&(e.getClosest(t.target,"fieldset").querySelector("input[name='"+t.target.getAttribute("name").slice(0,-1)+"2']").value=n.value)})})}),Array.from(r.querySelectorAll("#toMe, #fromMe")).forEach(t=>{t.addEventListener("click",t=>{let r="deliveryField"===e.getClosest(t.target,"fieldset").getAttribute("id")?document.querySelector("#pickupField"):document.querySelector("#deliveryField"),n="";Array.from(r.querySelectorAll(".clientList")).forEach(e=>{n+=e.value});let l=document.querySelector("input[name='ClientName'][form='javascriptVars']").value+document.querySelector("input[name='Department'][form='javascriptVars']").value+document.querySelector("input[name='ShippingAddress1'][form='javascriptVars']").value+document.querySelector("input[name='ShippingAddress2'][form='javascriptVars']").value;n===l&&t.preventDefault()}),t.addEventListener("change",t=>{let r="deliveryField"===e.getClosest(t.target,"fieldset").getAttribute("id")?document.querySelector("#pickupField"):document.querySelector("#deliveryField");t.target.checked?(e.getClosest(t.target,"thead").querySelector(".onFile").checked=!1,e.triggerEvent(e.getClosest(t.target,"thead").querySelector(".onFile"),"change"),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!1,e.required=!1,e.readOnly=!0,e.style.display="inline"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!0,e.style.display="none"}),r.querySelector(".me").disabled=!0,e.getClosest(t.target,"fieldset").querySelector("[id$='Client']").value=document.querySelector("input[name='ClientName'][form='javascriptVars']").value,e.getClosest(t.target,"fieldset").querySelector("[id$='Department']").value=document.querySelector("input[name='Department'][form='javascriptVars']").value,e.getClosest(t.target,"fieldset").querySelector("[id$='Address1']").value=document.querySelector("input[name='ShippingAddress1'][form='javascriptVars']").value,e.getClosest(t.target,"fieldset").querySelector("[id$='Address2']").value=document.querySelector("input[name='ShippingAddress2'][form='javascriptVars']").value):(Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.readOnly=!1}),r.querySelector(".me").disabled=!1)})}),Array.from(document.querySelectorAll(".onFile")).forEach(t=>{t.addEventListener("change",t=>{t.target.checked?(e.getClosest(t.target,"thead").querySelector(".me").checked=!1,Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!0,e.required=!1,e.readOnly=!1,e.style.display="none"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!1,e.style.display="inline"}),"onFileP"===t.target.id?document.querySelector("#toMe").disabled=!1:document.querySelector("#fromMe").disabled=!1):(Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientList")).forEach(e=>{e.disabled=!1,e.required="Department"!==e.getAttribute("name").substr(1),e.style.display="inline"}),Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{e.disabled=!0,e.style.display="none"}))})}),Array.from(document.querySelectorAll(".clientSelect")).forEach(t=>{t.addEventListener("change",t=>{let r=t.target.options[t.target.selectedIndex].getAttribute("data-value");Array.from(e.getClosest(t.target,"fieldset").querySelectorAll(".clientSelect")).forEach(e=>{Array.from(e.options).forEach(e=>{e.selected=e.getAttribute("data-value")===r})})})}),r.querySelector(".receivedReady").addEventListener("change",t=>{Array.from(r.querySelectorAll(".readyNote, .readyDate")).forEach(r=>{r.style.display="none"===r.style.display?"inline-block":"none",r.classList.contains("readyDate")&&(!0===t.target.checked&&(r.value=""),e.triggerEvent(r,"change"),r.required=!t.target.checked)})});let o=t=>{if(!/(deliveryRequest\d+)/.test(e.getClosest(t.target,"div").id)){let e=new Date,n=new Date(t.target.value);if(e>=n){let e=document.createElement("p");e.classList.add("readyError"),e.innerHTML="Ready Time should be either \"Now\" or a time in the future.",r.querySelector(".readyError")||r.querySelector(".ticketError").appendChild(e)}else if(r.querySelector(".readyError")){let e=r.querySelector(".readyError");e.parentNode.removeChild(e)}r.querySelector(".submitForm").disabled=null!==r.querySelector(".readyError")}};r.querySelector(".readyDate").removeEventListener("change",o),r.querySelector(".readyDate").addEventListener("change",o),r.querySelector(".cancelTicketEditor")&&r.querySelector(".cancelTicketEditor").addEventListener("click",()=>{if(r.removeChild(r.querySelector(".removableByEditor")),0===document.querySelectorAll(".cancelTicketEditor").length)for(;r.parentNode.querySelector("datalist");)r.parentNode.removeChild(r.parentNode.querySelector("datalist"));Array.from(r.querySelectorAll("table.hide, hr.hide, button.hide")).forEach(e=>{e.classList.remove("hide")})});let s=async n=>{n.preventDefault(),n.target.disabled=!0,r.querySelector(".cancelTicketEditor")&&(r.querySelector(".cancelTicketEditor").disabled=!0);let l=1,a=document.createElement("span");r.querySelector(".diWeight")&&(l=r.querySelector(".diWeight").getAttribute("step")),a.classList.add("ellipsis"),a.innerHTML=".",r.querySelector(".ticketError").innerHTML="",r.querySelector(".ticketError").appendChild(a);let i=!0,o=setInterval(()=>{!0===i&&(a.innerHTML+="..",i=21>a.innerHTML.length&&1!=a.innerHTML.length),!1===i&&(a.innerHTML=a.innerHTML.substr(0,a.innerHTML.length-2),i=1===a.innerHTML.length)},500),s=!1,c="deliveryRequest"===r.querySelector(".removableByEditor").getAttribute("id")?"":r.querySelector(".removableByEditor").getAttribute("id").match(/\d+/)[0],u=["pClient","pAddress1","pAddress2","pCountry","dClient","dAddress1","dAddress2","dCountry","dispatchedTo","billTo"],m={};return(""===c||"0"===document.querySelector("#request"+c+" input[name='contract']").value)&&u.push("requestedBy"),Array.from(r.querySelectorAll("input[form='request"+c+"'], select[form='request"+c+"'], textarea[form='request"+c+"']")).forEach(t=>{if(t.name)if("checkbox"!==t.type&&!1===t.disabled){if(-1!==u.indexOf(t.getAttribute("name"))&&""===t.value?(s=!0,t.classList.add("elementError"),setTimeout(()=>{t.classList.remove("elementError")},3e3)):t.classList.remove("elementError"),"deliveryRequest"===e.getClosest(t,"div").id&&"readyDate"===t.getAttribute("name")&&"none"!==t.style.display){let e=document.createElement("p");e.classList.add("readyError"),e.classList.add("center"),e.innerHTML="Ready Time should be either \"Now\" or a time in the future.",d1=new Date,d2=new Date(t.value),(d1>=d2||""===t.value)&&(s=!0,!r.querySelector(".readyError")&&r.querySelector(".ticketError").parentNode.appendChild(e),t.classList.add("elementError"),setTimeout(()=>{t.classList.remove("elementError"),r.querySelector(".readyError")&&e.parentNode.removeChild(e)},3e3))}if(/(deliveryRequest\d+)/.test(e.getClosest(t,"div").id)){let e=document.createElement("p");switch(e.classList.add("timingError"),e.classList.add("center"),e.innerHTML="Timing Error",t.getAttribute("name")){case"readyDate":"none"!==t.style.display&&(""===t.value&&(s=!0,!r.querySelector(".timingError")&&r.querySelector(".ticketError").parentNode.appendChild(e),t.classList.add("elementError"),setTimeout(()=>{t.classList.remove("elementError"),r.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==r.querySelector(".pTimeStamp").value&&r.querySelector(".pTimeStamp").value<t.value&&(s=!0,!r.querySelector(".timingError")&&r.querySelector(".ticketError").parentNode.appendChild(e),r.querySelector(".pTimeStamp").classList.add("elementError"),setTimeout(()=>{r.querySelector(".pTimeStamp").classList.remove("elementError"),r.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==r.querySelector(".dTimeStamp").value&&r.querySelector(".dTimeStamp").value<t.value&&(s=!0,!r.querySelector(".timingError")&&r.querySelector(".ticketError").parentNode.appendChild(e),r.querySelector(".dTimeStamp").classList.add("elementError"),setTimeout(()=>{r.querySelector(".dTimeStamp").classList.remove("elementError"),r.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)),""!==r.querySelector(".d2TimeStamp").value&&r.querySelector(".d2TimeStamp").value<t.value&&(s=!0,!r.querySelector(".timingError")&&r.querySelector(".ticketError").parentNode.appendChild(e),r.querySelector(".d2TimeStamp").classList.add("elementError"),setTimeout(()=>{r.querySelector(".d2TimeStamp").classList.remove("elementError"),r.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)));break;case"d2TimeStamp":""!==t.value&&(""===r.querySelector(".dTimeStamp").value||r.querySelector(".dTimeStamp").value>t.value||""===r.querySelector(".pTimeStamp").value||r.querySelector(".pTimeStamp").value>t.value||""===r.querySelector(".dispatchTimeStamp").value||r.querySelector(".dispatchTimeStamp").value>t.value)&&(s=!0,!r.querySelector(".timingError")&&r.querySelector(".ticketError").parentNode.appendChild(e),t.classList.add("elementError"),setTimeout(()=>{t.classList.remove("elementError"),r.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));break;case"dTimeStamp":""!==t.value&&(""===r.querySelector(".pTimeStamp").value||r.querySelector(".pTimeStamp").value>t.value||""===r.querySelector(".dispatchTimeStamp").value||r.querySelector(".dispatchTimeStamp").value>t.value)&&(s=!0,!r.querySelector(".timingError")&&r.querySelector(".ticketError").parentNode.appendChild(e),t.classList.add("elementError"),setTimeout(()=>{t.classList.remove("elementError"),r.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));break;case"pTimeStamp":""!==t.value&&(console.log(r.querySelector(".dispatchTimeStamp").value,t.value,r.querySelector(".dispatchTimeStamp").value>t.value),(""===r.querySelector(".dispatchTimeStamp").value||r.querySelector(".dispatchTimeStamp").value>t.value)&&(s=!0,!r.querySelector(".timingError")&&r.querySelector(".ticketError").parentNode.appendChild(e),t.classList.add("elementError"),setTimeout(()=>{t.classList.remove("elementError"),r.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3)));break;case"dispatchTimeStamp":""===t.value&&(s=!0,!r.querySelector(".timingError")&&r.querySelector(".ticketError").parentNode.appendChild(e),t.classList.add("elementError"),setTimeout(()=>{t.classList.remove("elementError"),r.querySelector(".timingError")&&e.parentNode.removeChild(e)},3e3));}}m[t.getAttribute("name")]=t.value}else"checkbox"===t.type&&(m[t.getAttribute("name")]="repeatClient"===t.getAttribute("name")?1-t.checked:0+t.checked)}),m.formKey=document.querySelector("#formKey").value,m.mapAvailable=e.getClosest(r,".page").querySelector(".mapContainer")?1:0,1===m.dryIce&&(0!=m.diWeight%l||0==m.diWeight)&&(r.querySelector(".ticketError").innerHTML=`Dry Ice in increments of ${l} only.`,r.querySelector(".diWeight").classList.add("elementError"),s=!0,setTimeout(()=>{r.querySelector(".ticketError").innerHTML="",r.querySelector(".diWeight").classList.remove("elementError")},3500)),!0===s?(clearInterval(o),r.querySelector(".ticketError").innerHTML="",Array.from(r.querySelectorAll(".submitForm, .cancelTicketEditor")).forEach(e=>{e.disabled=!1}),!1):void(await e.fetch_template({url:"./enterTicket.php",postData:m}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(n=>{if(clearInterval(o),-1!==n.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==n.indexOf("data-value=\"error\""))throw r.querySelector(".ticketError").innerHTML=n,Array.from(r.querySelectorAll(".submitForm, .cancelTicketEditor")).forEach(e=>{e.disabled=!1}),new Error(n);else{let l=t.parseFromString(n,"text/html"),a=l.querySelector("#deliveryConfirmation")||l.querySelector(".editorConfirmation");if(r.querySelector(".removableByEditor").innerHTML="",r.querySelector(".removableByEditor").appendChild(a),m.mapAvailable){scroll(0,0);let t={};Array.from(document.querySelectorAll("input[form='coordinates']")).forEach(e=>{t[e.getAttribute("name")]=e.value}),t.mapDivID="map",e.updateMap(t)}assignConfirmationListeners(r)}}).catch(e=>{console.error(e.message),clearInterval(o),r.querySelector(".ticketError").innerHTML="<span class=\"error\">Error</span>: "+e.message,setTimeout(()=>{r.querySelector(".ticketError").innerHTML=""},3500),Array.from(r.querySelectorAll(".submitForm, .cancelTicketEditor")).forEach(e=>{e.disabled=!1})}))};r.querySelector(".submitForm").removeEventListener("click",s),r.querySelector(".submitForm").addEventListener("click",s)},assignConfirmationListeners=r=>{Array.from(r.querySelectorAll(".confirmed, .editForm")).forEach(n=>{n.addEventListener("click",async n=>{n.preventDefault();let l=n.target.getAttribute("form"),a={};a.formKey=document.querySelector("#formKey").value,a.ticketEditor=1,Array.from(r.querySelectorAll("input[form='"+n.target.getAttribute("form")+"']")).forEach(e=>{a[e.getAttribute("name")]=e.value}),n.target.classList.contains("confirmed")&&/\d/.test(n.target.getAttribute("form"))&&(a.updateTicket=1),n.target.classList.contains("editForm")&&!/\d/.test(n.target.getAttribute("form"))&&(a.ticketEditor=0),await e.fetch_template({url:"./enterTicket.php",postData:a}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(l=>{if(-1!==l.indexOf("Session Error"))return e.showLogin();if(document.querySelector("#formKey").value=+document.querySelector("#formKey").value+1,-1!==l.indexOf("data-value=\"error\""))throw new Error(l);if(n.target.classList.contains("editForm")){Array.from(r.querySelectorAll("datalist, .removableByEditor")).forEach(e=>{e.parentNode.removeChild(e)});let a=t.parseFromString(l,"text/html"),i=document.createDocumentFragment(),o=document.querySelector(".subContainer");Array.from(a.querySelectorAll("datalist, div")).forEach(e=>{i.appendChild(e)}),r.appendChild(i),/\d/.test(n.target.getAttribute("form"))||(r.appendChild(o),e.updateMap({mapDivID:"map"})),assignTicketFormListeners(r)}else if(n.target.classList.contains("confirmed")){if("remove"===l){let e=document.createElement("p");return e.classList.add("center"),e.innerHTML="Update Successful",r.appendChild(e),scrollTo(0,document.querySelector("header").offsetHeight+5),void setTimeout(()=>{document.remove(r)},3e3)}if(!e.getClosest(r,".page").querySelector(".mapContainer")){let r=document.querySelector("#ticketEditorResultContainer"),a=e.getClosest(n.target,".sortable"),i=t.parseFromString(l,"text/html"),o=document.createDocumentFragment(),s=document.createElement("p");s.classList.add("center"),s.innerHTML="Update Successful",a.appendChild(s),o.appendChild(i.querySelector(".sortable")),setTimeout(()=>{r.insertBefore(o,a),r.removeChild(a),assignTicketEditorListener()},3500)}else{let r=t.parseFromString(l,"text/html");document.querySelector("#deliveryConfirmation").innerHTML="",document.querySelector("#deliveryConfirmation").appendChild(r.querySelector("#deliveryRequestComplete")),setTimeout(e.refreshTicketEntry,3500)}}}).catch(e=>{console.error(e.message),r.querySelector(".ticketError").innerHTML="<p class=\"ceneter\"><span class=\"error\">Error</span>: "+e.message+"</p>",setTimeout(()=>{r.querySelector(".ticketError").innerHTML=""},3500)})})})}}(window.rjdci=window.rjdci||{}),(()=>{function e(){navigator.onLine?(r.classList.remove("app__offline"),n.style.background="#1E88E5"):(rjdci.toast("You are now offline.."),r.classList.add("app__offline"),n.style.background="#9E9E9E")}function t(){a.style.transform="translateX(-110%)",a.classList.remove("menu--show"),i.classList.remove("menu__overlay--show")}document.addEventListener("rjdci_resolutionchange",function(){setTimeout(()=>{rjdci.fixDeadRunButton(),rjdci.centerForm(document.querySelector("#confirmLogin"))},500)}),document.addEventListener("rjdci_loggedout",function(){setTimeout(rjdci.disableApp,500)}),document.addEventListener("rjdci_loggedin",function(){setTimeout(rjdci.enableApp,500)});const r=document.querySelector("header"),n=document.querySelector(".menu__header");document.addEventListener("DOMContentLoaded",function(){navigator.onLine||e(),window.addEventListener("online",e,!1),window.addEventListener("offline",e,!1)});let l=document.querySelector(".header__icon"),a=document.querySelector(".menu"),i=document.querySelector(".menu__overlay"),o=document.querySelector(".fab__push");l.addEventListener("click",function(){let e=document.querySelector("#signature-pad");if(null!==e)return!1;if(document.querySelector("header").classList.contains("loggedout"))return!1;let t=document.querySelector("#newUpdate");null===t||t.classList.contains("hide")||t.classList.add("hide"),a.style.transform="translateX(0)",a.classList.add("menu--show"),i.classList.add("menu__overlay--show")},!1),i.addEventListener("click",t,!1),Array.from(document.querySelectorAll(".menu__list li")).forEach(e=>{e.addEventListener("click",t,!1)}),null!==o&&o.addEventListener("click",t,!1),domready(()=>{rjdci.assignLinkValues(),document.querySelector("#logoutLink button").addEventListener("click",e=>{e.preventDefault(),rjdci.logout()}),document.querySelector("#confirmLogin")&&rjdci.populatePage().then(()=>{rjdci.assignListeners(),rjdci.assignQueriedTicketListeners(),document.dispatchEvent(rjdci.loaded)}),Array.from(document.querySelectorAll(".menu__list li")).forEach(e=>{e.addEventListener("click",()=>{e.querySelector("a")&&rjdciSwipe.slide(e.querySelector("a").getAttribute("data-value"),300)})}),document.querySelector(".header__icon").addEventListener("click",()=>{let e=document.querySelector("#sig"),t=document.querySelector("#confirmLogin");if(null!==e||0<t.offsetWidth&&0<t.offsetHeight)return!1}),document.querySelector(".refresh").addEventListener("click",()=>{location.reload()}),document.querySelector("#confirm").addEventListener("click",async e=>{e.preventDefault();let t=!1;if(Array.from(document.querySelectorAll("#login input")).forEach(e=>{"function"!==e.id&&""===e.value&&(t=!0,e.classList.add("elementError"),setTimeout(()=>{e.classList.remove("elementError")},3e3))}),!0==t)return!1;let r=document.createElement("span");r.classList.add("ellipsis"),r.innerHTML=".",document.querySelector("#confirmMessage").appendChild(r);let n=!0,l=setInterval(()=>{!0===n&&(r.innerHTML+="..",n=21>r.innerHTML.length&&1!=r.innerHTML.length),!1===n&&(r.innerHTML=r.innerHTML.substr(0,r.innerHTML.length-2),n=1===r.innerHTML.length)},500),a={};a.clientID=document.querySelector("#uid").value,a.upw=document.querySelector("#upw").value,a.mobile=document.querySelector("#mobile").value,a.noSession=1,await rjdci.fetch_template({url:"./refreshFormKey.php"}).then(e=>{if("undefined"==typeof e)throw new Error("Result Undefined");if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(async e=>(document.querySelector("#formKey").value=e,await rjdci.fetch_template({url:"../login.php",postData:a}))).then(e=>{if("undefined"==typeof e)throw new Error(e.status+" "+e.statusText);if(e.ok)return e.text();throw new Error(e.status+" "+e.statusText)}).then(e=>{if(clearInterval(l),-1!==e.indexOf("Session Error"))throw new Error("Session Error");if(-1===e.indexOf("error")&&-1===e.indexOf("Invalid Credentials"))document.querySelector("#confirmMessage").innerHTML="User Confirmed",setTimeout(()=>{if(document.querySelector("#confirmMessage").innerHTML="",document.querySelector("#confirmLogin").classList.add("hide"),""!==document.querySelector("#function").value){let e=document.querySelector("#function").value;document.querySelector("#function").value="",rjdci[e]()}document.dispatchEvent(rjdci.loggedin)},1e3);else throw new Error(e)}).catch(e=>{clearInterval(l),document.querySelector("#confirmMessage").innerHTML="<span class=\"error\">Error</span>: "+e.message,setTimeout(()=>{document.querySelector("#confirmMessage").innerHTML=""},4e3)})}),document.querySelector("#cancel").addEventListener("click",()=>{window.location.assign("./logout")})})})();
